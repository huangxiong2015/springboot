<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
	<%-- <link rel="stylesheet" href="${ctx}/css/app/goods.css"> --%>
	<title>物料管理</title>
	<style>
	/* 物料信息 */
	.condition_inquery {
	    background-color: #c11f2e;
	    color: #fff;
	    padding: 6px 17px;
	    font-size: 14px;
	    border-radius: 3px;
	}
	.mt9{
		margin-top:9px;
	}
	.add_btn{
		display:inline-block;
		padding:8px 19px;
		cursor:pointer;
		border:solid 1px #ddd;
		border-radius: 3px;
	}
	.add_btn:hover{
		color:#b1191a;
		border-color:#b1191a;
	}
	.item_page .showpages {
	    height: 120px;
	    margin-bottom: 30px;
	}
	.mr15{
		margin-right:15px;
	}
	#kkpager .pageBtnWrap .spanDot{
		cursor: auto;
	}
	</style>

	
</head>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper ms-controller" ms-controller="list" >

	<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->
	  	    	   
	   <!-- 物料信息 -->
	   <div class="content-wrapper" >
			<section class="content-header">
				<a href="javascript:;" class="header_tab pitch_tab">物料管理</a>
			</section>			
			<section class="content container-fluid">
				<div class="row mt20" id=searchFrom>
					<div class="col-xs-3 col_bt pb10 ">
						<label>型号：</label>						
						<input class="col_input_4" maxlength="50" style="width:65%;" type="text" name="id" ms-duplex="@partNo" ms-attr="{value:@partNo}" >
					</div>																																																			
					<div class="col-xs-2 mt9">
						<a href="javascript:;" class="condition_inquery" ms-click="@searchData">
							<span ><i class="icon-sousuo mr5"></i>查询</span>
						</a>
					</div>
					<a href="${ctx }/basicMaterial/upload.htm" class="add_btn r mr15"><em class="icon-plus b mr5"></em>新增</a>														
				</div>			
				<!-- 表格 -->
				<div class="row mt20">
					<div class="col-xs-12" id="result_table">
						<table class="table">
							<thead>
								<tr>
									<th width="4%">序号</th>
									<th width="18%">物料型号</th>
									<th width="16%">制造商</th>
									<th width="16%">大类</th>
									<th width="16%">小类</th>
									<th width="16%">次小类</th>									
									<th width="7%">状态</th>
									<th width="7%">操作</th>								
								</tr>
							</thead>
							<tbody >
								<tr ms-if="@initShow">
									<td colspan=8><img src="${ctx }/images/loading.gif"></td>
								</tr>
								<tr ms-if="@dataList.list.length==0">
									<td colspan=8 style="padding:20px">暂无数据</td>
								</tr>								
								<tr :for="($index,ele) in @dataList.list" ms-if="@dataList.list.length!==0">
									<td :text="$index+1"></td>
									<td :text="ele.manufacturerPartNumber?ele.manufacturerPartNumber:'--'" :attr="{title:ele.manufacturerPartNumber?ele.manufacturerPartNumber:''}"></td>
									<td :text="ele.manufacturer?ele.manufacturer:'--'" :attr="{title:ele.manufacturer?ele.manufacturer:''}"></td>
									<td><span :for="item in ele.categories" :if="item.cateLevel==1" :text="item.cateLevel==1?item.cateName:'--'" :attr="{title:item.cateName?item.cateName:''}"></span></td>
									<td><span :for="item in ele.categories" :if="item.cateLevel==2" :text="item.cateName?item.cateName:'--'" :attr="{title:item.cateName?item.cateName:''}"></span></td>
									<td><span :for="item in ele.categories" :if="item.cateLevel==3" :text="item.cateName?item.cateName:'--'" :attr="{title:item.cateName?item.cateName:''}"></span></td>									
									<td>有效</td>
									<td><a target="_blank" :attr="{href:'${ctx}/basicMaterial/detail.htm?id='+ele.id}">详情</a></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</section>
			<div class="item_page pl30" ms-if="!@initShow && @dataList.list.length!==0">
				<div class="l showpages">
		            <span class="l mr5">每页显示数量</span>
		            <div class="show_number_extrude l">
		            	<span class="spn" :text="@pageSize?@pageSize:'20'">10</span><i class="icon-down"></i><i class="icon-upward dn"></i>
		                <div class="show_number_cont">
		                    <ul>
		                        <li :click="@changeSize(10);"><a href="javascript:;">10</a></li>
		                        <li :click="@changeSize(20);"><a href="javascript:;">20</a></li>
		                        <li :click="@changeSize(50);"><a href="javascript:;">50</a></li>
		                        <li :click="@changeSize(100);"><a href="javascript:;">100</a></li>
		                    </ul>
		                </div>
		        	</div>
				</div>
				<!-- 分页 -->
				<div id="pager" class="r">
					  <div id="kkpager"></div>
				</div>
				<input type="hidden" value="" id="total">
				<input type="hidden" value="" id="pageSize">
			
			</div>
		</div>
		
	   
	   
	   
	      
	<script type="text/javascript">
			var selectCatid = "239,298";
	</script>
	<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->

</div>	    
<!-- ./wrapper -->


 <script>

 	var page = getQueryString('page'),size = getQueryString('size'),partNo = decodeURIComponent(getQueryString('partNo'));
 	var materialList = avalon.define({
 		$id:'list',
 		dataList:[],
 		pageSize:size,
 		partNo:partNo,
 		initShow:true,
 		searchData:function(){
 			location.href =location.pathname + '?partNo=' + encodeURIComponent(materialList.partNo);
 		},
 		changeSize:function(size){
 			if(materialList.partNo){
 				location.href =location.pathname + '?partNo=' + encodeURIComponent(materialList.partNo) + '&size=' + size;
 			}else{
 				location.href = location.pathname + '?size=' + size;
 			}			
 		}
 	}) 	
 	$.aAjax({
 		url:ykyUrl.product + '/v1/products/stand',
 		type:'GET',
 		data:{
 			keyword:materialList.partNo,
 			page:page,
 			pageSize:size
 		},
 		success:function(data){
 			materialList.initShow = false;
 			materialList.dataList=data;
 		 	setPageOption(data);
 			var seachPar = GetRequestWithout(window.location.search,"page");
 			loadPage(window.location.pathname+(seachPar? seachPar : ""));
 		},
 		error:function(data){
 			console.log('error');
 		}
 	})
 	
 	//最多显示200页
 	function loadPage(url)
	{
		var totalRecords= $("#total").val();//总记录数
		var size= $("#pageSize").val();//每页条数
		var sendUrl="?page=";
		var t = url.indexOf('?'); 
		if (t >= 0)sendUrl="&page=";
	var totalRecords = totalRecords;//总数量
	var totalPage = Math.ceil(totalRecords / size);//总页数
	var pageNo = getParameter('page');
			if (!pageNo) {
				pageNo = 1;
			}
			if(totalPage>200){
				totalPage = 200
			}
			kkpager.generPageHtml({
				pno : pageNo,
				total : totalPage,//总页码
				totalRecords : totalRecords,//总数据条数
				hrefFormer : 'pager_test',//链接前部
				hrefLatter : '.html', //链接尾部
				getLink : function(n) {
					var ss = (parseInt(n));
					return url +sendUrl + ss;
				}
			});
	}
 	
 </script>
</body>
</html>