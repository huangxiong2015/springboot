<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<!-- jQuery 1.11.3 -->
  <c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
  <title>快递管理</title>

 <style type="text/css">
 	.condition_inquery{background-color:#4788bf;color:#fff;padding:10px 10px;font-size:14px;border-radius:3px;}
	.col_bt_time input{width:37%;}
  	.col_bt label,.col_bt_time label{text-align:right;}
  	.col_input_2{width:12%;}
  	.col_input_3{width:15%;}
  	.mr25{margin-right:25px;}
  	.table img{width: 32px;height: 32px;}
  	.ui-selectmenu-button.ui-button {width: 14%;margin: 0px;margin-top: -3px;height: 30px;line-height: 30px;}
  	#status-button{width: 16%;}
  	.content-wrapper .content-header .pitch_tab{border-top: 0px;}
  	.item_page .showpages {height: 120px;margin-bottom: 30px;}

  	.up_skin_class .y_prompt_content {width: 330px;margin-top: 25px;}
  	.operation {margin-bottom: 20px;}
  	.w340{width: 340px;height: 100px;padding: 5px 10px;resize: none;}

  	.table td a{padding-right: 0px;}
  	.lh25{line-height:25px;}
  	.titleClass span{display: inline-block;width: 100%;}

  	.ms-controller{visibility: hidden;}
  	.col_bt{height:32px;}
  	.bred{border-color:#b1191a;}
  	.ui-widget.ui-widget-content{word-wrap: break-word;}
 </style>
  <link rel="stylesheet" href="${ctx}/js/credenceUpload/credenceUpload.css?20161229" />
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

	<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->

	  <!-- 右边内容显示 -->
	  <div class="content-wrapper ms-controller"  ms-controller=list>
		<!-- Content Header (Page header) -->
		<section class="content-header">
			<a href="#" class="header_tab pitch_tab">快递管理</a>
			<input type="hidden" id="orderId" value="237" />
		</section>
	    <!-- Main content -->
		<section class="content container-fluid">
			<div class="row mt20">
				<div class="r mr25">
					<a href="${ctx}/shipmentlist/create.htm" class="btn btn-sm btn-success pull-right">
						<i class="fa fa-plus"></i> 新增
					</a>
				</div>

			</div>

			<!-- 表格 -->
			<div class="row mt20">
				<div class="col-xs-12">
                    <table class="table">
                        <thead>
                            <tr>
                                <th width="50px">序号</th>
                                <th>创建时间</th>
                                <th>修改时间</th>
                                <th>公司名称</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr :if="@isfirst || !@list.length" >
								<td colspan="6" style="padding:20px" id="loadingData" ms-html="@isLoading">数据加载中</td>
							</tr>
                            <tr ms-for="($index, el) in @list">
                                <td>{{$index + 1}}</td>
                                <td ms-attr="{title:typeof(el.createdDate) == 'undefined' ? '' : el.createdDate}">{{@toHtml(el.createdDate)}}</td>
                                <td ms-attr="{title:typeof(el.lastUpdateDate) == 'undefined' ? '' : el.lastUpdateDate}">{{@toHtml(el.lastUpdateDate)}}</td>
                                <td ms-attr="{title:el.partyGroup.groupName}">{{el.partyGroup.groupName}}</td>
                                <td class="titleClass">
                                    <span ms-attr="{title:'停用'}" :if="el.partyStatus == 'PARTY_DISABLED'">停用</span>
                                    <span ms-attr="{title:'启用'}" :if="el.partyStatus == 'PARTY_ENABLED'">启用</span>
                                </td>
                                <td>
									<span :if="el.partyStatus == 'PARTY_DISABLED'" >
										<a class=" lh25" href="javascript:;" ms-click="@changeStatus(el, $event,el.id,el.partyStatus)">启用</a>
									</span>
                                    <span :if="el.partyStatus == 'PARTY_ENABLED'" >
										<a class=" lh25" href="javascript:;" ms-click="@changeStatus(el, $event,el.id,el.partyStatus)">停用</a>
									</span>
									<a class=" lh25" ms-attr="{href:'${ctx}/shipmentlist/create.htm?roleType=CARRIER&partyId='+el.id}" target="_blank">详情</a>
								</td>
                            </tr>
                        </tbody>
                    </table>
				</div>
			</div>
		</section>
		<!-- /.content -->
	  </div>


	<script type="text/javascript">
		var selectCatid = "857134796873138176,857135120568549376";
	</script>
	<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->

<script src="${ctx}/js/lib/plupload-2.1.2/js/plupload.full.min.js"></script>
<script src="${ctx}/js/credenceUpload/credenceUpload.js?a=20170109"></script>
<script src="${ctx}/js/credenceUpload/oss_credence.js?b=20170100600"></script>
<script src="${ctx}/js/lib/jquery.validate.js"></script>
<script src="${ctx}/js/common/add.validate.js"></script>

</div>
	<script type="text/javascript">

	 var showList = avalon.define({
 	    $id: "list",
 	    list: [],
 	    toHtml: function(data){
			if(data=='undefined' || !data){
				return "--";
			}else{
				return data;
			}
		},
 	   	isLoading:"数据加载中...",
 	    changeStatus:function(el,e,id,status){
 	    	var type = "";
 	    	if(status === "PARTY_DISABLED"){
 	    		type = "启用"
 	    	}else{
 	    		type = "停用"
 	    	}
 	    	var _html = "<img class='y_prompt_box'  src='${ctx}/js/lib/layer/skin/default/y_warning.png' />"+
 	    				"<div class='y_prompt_content' ><span class='sp1'>确认要"+type+"吗？</span>"+
 	    				"</div>";
 	    	var _title = " ";

 	    	var l = layer.confirm(_html, {
				offset: "auto",
				btn: ['确      认', '取      消'], //按钮
				title: _title,
				area: ['550px', '280px'],
				move: false,
				skin: "up_skin_class",
				yes:function(){
					var pamars = {
		 	    			partyId: id,
		 	    			status: status === "PARTY_DISABLED"? "PARTY_ENABLED": "PARTY_DISABLED"
		 	    	};
					$.aAjax({
						//url: ykyUrl.transaction+"/v1/orders/"+id+"/status",+ statusId
						url:  ykyUrl.party + "/v1/party/logistics/status",
						type:"PUT",
						data: JSON.stringify(pamars),
			 	  	    success: function(data){
			 	  	    	layer.close(l);
			 	  	    	location.reload()
			 	  	    },
			 	  	    error:function(e){
			 	  	    	layer.closeAll('loading');
			 	  	    	console.log("系统错误，请联系系统管理员："+e);
			 	  	    }
					});
				}
			})
 	    }
 	})

	listUrl = ykyUrl.party+"/v1/party/allparty";
    var parmars = {
         "roleType": "CARRIER"
     };

	/* 快递列表数据 */
 	 $.aAjax({
	     url: listUrl,
	     type:"PUT",
         data:JSON.stringify(parmars),
	     success: function(data) {
             console.log(data);

	    	 if( data.length == 0)
		    	 	showList.isLoading = "暂无数据";

	    	 showList.list=data;
	    	 showList.isfirst = false;
	    	 loadPage(window.location.pathname+GetRequestWithout(window.location.search,"page"));

	     },
	     error:function(e){
  	    	layer.closeAll('loading');
	  	    console.log("系统错误，请联系系统管理员："+e);
		}
	})

</script>

</body>
</html>
