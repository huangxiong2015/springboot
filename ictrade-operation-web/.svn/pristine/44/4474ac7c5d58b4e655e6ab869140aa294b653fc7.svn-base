var vm ='';
$(function(){  
	  var fileTemp = $('#fileTemp').html(),dat={ t : 0};

	  vm = new Vue({
	        el: '#manufacturer-add',
	        data: { 
	        	manufacturerData:{
	        		logo:'' ,
	        		brandName:'' 
	        		
	        	},
	        	//isShow: true,
	  			brandid : getQueryString('id'),
	  			inNum : 0,
	  			len : 0
	        },
	        watch : {
	        	/*isShow : function(val){
	        		if(val==true){
	            		$('#uploadBtn').hide();  
	        		}
	            	else{
		        		$('#uploadBtn').show();  
	            	}
	        	},*/
	        	"manufacturerData.desc" : function(val){
	        		this.inNum = val.length;
	        	}
	        }
	   });
	  var brandid = getQueryString('id');
	  if(brandid){
		  syncData(ykyUrl.product + "/v1/products/brands/" + brandid , "get", null, function (data, err) {
	          if (data) { 
	        	  vm.manufacturerData = $.extend({},  vm.manufacturerData, data);
	              $('.c-btn').removeAttr('disabled');
	              dat.t= data.brandAlias.length;
	          } 
	      });
	  }
	  
	//checkAbledButton();
	//验证
    formValidate('#manu-from', {}, function () {
        //序列化form表单数据
        var formArry = $('#manu-from').serializeObject(); 
        if(brandid){
            syncData(ykyUrl.product + "/v1/products/manufacturers/" + brandid, "put", formArry, function (data, err) {
                if (data) {
                    layer.msg('更新成功！');  
              	  	history.go(-1);
                }
            });
        }else{
        	 syncData(ykyUrl.product + "/v1/products/manufacturers", "post", formArry, function (data, err) {
                 if (data) {
                     layer.msg('创建成功！');
                     window.location.href=ykyUrl._this + "/manufacturer.htm";
                 }
             });
        }
    });

    $('.del_logo').on('click', function(){
    	vm.manufacturerData.logo ='';
    }); 
  /*  $('.logo-box').mouseover(function(){
    	vm.isShow = false;
    }); 
    $('.logo-box').mouseout(function(){
    	vm.isShow = true;
    }); */ 
    
    //添加控件
    $('#addControl').click(function(){ 
    	var $control=$('.act-control-box .form-group');
    	if($control.length < 2000){
	        $('.act-control-box').append(applyTpl(fileTemp, dat));
	        dat.t++; 
        } 
    	vm.len = $('.act-control-box .form-group').length;
    	
    });   
    var uploader = createUploader({
			buttonId: "uploadBtn", 
			uploadType: "ent.logo", 
			url:  ykyUrl.webres,
			types: "jpg,png,jpeg,gif",
			fileSize: "5mb",
			isImage: true, 
			init:{
				FileUploaded : function(up, file, info) { 
		            layer.close(index);
					if (info.status == 200 || info.status == 203) {
						console.log(_fileUrl);
						console.log(file); 
						vm.manufacturerData.logo = _fileUrl;
						//vm.isShow = true; 
					} else {
						layer.msg("上传文件失败,请重新上传！",{icon:2,offset:120}); 
					}
					up.files=[];
				}
			}
	    }); 
    uploader.init(); 
    
   $('.btn-concle').on('click', function(){
	  history.go(-1);
   });
});

//删除控件
function delField(obj){
	if($('.act-control-box .form-group').length ==1){
		$(obj).parents('.form-group').find('.form-control').val('');
	}else{ 
	    $(obj).parents('.form-group').remove();
	}
}; 