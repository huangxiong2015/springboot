var vm = new Vue(
{
	el : '#freeShipping',
	data : {
		formData:{
            url:'',    //form提交请求接口，可选
            id:'seachForm',
            data: '',            //初始化数据
            columnCount: 3,
            fields:[            //配置控件
                {
                    keyname: "名称",           //控件文本
                    type: "text",             //控件类型
                    key: "title",          //控件名
                    name: "title"         //控件name
                },{
             		keyname: "更新时间",
                    type: "daterange",   		// 区间类型
                    startkey: "updateDateStart",   // lastUpdateDate
                    endkey: "updateDateEnd",  		// end id
                    startname: "updateDateStart",  // star name
                    endname: "updateDateEnd" , 		// end name
                    dateRange:{},
                    
                  },{
                    keyname: "创建人",           //控件文本
                    type: "text",             //控件类型
                    key: "creatorName",          //控件名
                    name: "creatorName" 
                }, {
                    keyname: "状态",           //控件文本
                    type: "select",             //控件类型
                    key: "status",          //控件名
                    name: "strategyStatus",         //控件name
                    options: [{
                        value: '',
                        text: '全部'
                    }/*,{
                        value: 'PUBLISHED',
                        text: '进行中'
                    }*/,{
                        value: 'START',
                        text: '启用'
                    },{
                        value: 'HOLD',
                        text: '停用'
                    }/*,{
                        value: 'END',
                        text: '已结束'
                    }*/]
                }
            ],
            buttons:[{
                "text": '查询',
                "type": 'submit',
                "id": '',
                "name": '',
                "inputClass": 'btn btn-danger',
                "callback": {
                    action: 'on-search'
                }
            }]
        },
		url : ykyUrl.product + "/v1/strategy", //访问数据接口 
		queryParams : { //请求接口参数 
			page : 1, //当前页
			pageSize : 10, //分页参数
			defaultStatus : true, //监测参数变化标识
			strategyType:'FREE_DERIVERY'
		},
		gridColumns : [ //表格列
		{
			key: 'index', 
			name: '序号', 
			align:'center'
		},
		{
			key : 'title',
			align : 'center',
			name : '名称',
			cutstring: true,
			default : '-'
		},
		{
			key : 'createdDate',
			align : 'center',
			cutstring: true,
			name : '有效时间',
			default : '-',
			width: '300px',
			render:function(h, params){
				var startData = params.row.startDate,
					endDate = params.row.endDate;
				str = startData + ' ~ ' + endDate;
				return h('span', {}, str)
			}
		},
		{
			key : 'updatedTimeMillis',
			align : 'center',
			cutstring: true,
			name : '更新时间',
			default : '-'
		},
		{
			key : 'creatorName',
			align : 'center',
			cutstring: true,
			name : '创建人',
			default : '-'
		},
		{
            key : 'statusShow',
            align : 'center',
            name : '状态',
            align : 'center',
            width: '120px',
            text : {
            	PUBLISHED : {
                    'value' : '进行中'
                },
                START : {
                    'value' : '启用'
                },
                HOLD : {
                    'value' : '停用'
                },
                END : {
                	'value' : '已结束'
                }
            }
        },
		{
            key : 'operate',
            name : '操作',
            align : 'center',
            items : [ {
                className : 'btn-edit',
                text : '启用',
                show: "'{strategyStatus}' !== 'PUBLISHED' && '{strategyStatus}' !== 'START'",
                callback: {
                	confirm: {
                		title : '启用',
						content : '确认启用？'
                	},
                	action: 'changStauts',
                	params: ['{id}','START']
                }
            },{
                className : 'btn-edit',
                text : '停用',
                show: "'{strategyStatus}' == 'PUBLISHED' || '{strategyStatus}' == 'START'",
                callback: {
                	confirm: {
                		title : '停用',
						content : '确认停用？'
                	},
                	action: 'changStauts',
                	params: ['{id}','HOLD']
                }
            },{
                className : 'btn-edit',
                text : '编辑',
                show: "'{strategyStatus}' !== 'PUBLISHED' && '{strategyStatus}' !== 'START'",
                href : ykyUrl._this + '/freeShipping/edit/{id}.htm',
            },{
                className : 'btn-detail',
                text : '详情',
                show: "'{strategyStatus}' !== 'HOLD' && '{strategyStatus}' !== 'END'",
                href : ykyUrl._this + '/freeShipping/detail/{id}.htm',
                target : "_blank"
            }/*,{
                className : 'btn-delete',
                text : '删除',
                show: "'{strategyStatus}' !== 'PUBLISHED' && '{strategyStatus}' !== 'START'",
                callback: {
                	confirm: {
                		title : '删除',
						content : '确认删除？'
                	},
                	action: 'delFunc',
                	params: ['{id}']
                }
            }*/]
		}],
		pageflag : true, //是否显示分页
		showTotal: true, //显示列表总数
		refresh : false
	//重载 

	},
	methods : {
		//搜索方法
		onSearchClick : function(data) {
			var that = this;
			var qModel = data;
			this.queryParams.size = 10;
			this.queryParams.page = 1;
			this.queryParams.defaultStatus = !this.queryParams.defaultStatus;
			for ( var i in qModel) {
				that.queryParams[i] = qModel[i];
			}
			LS.set("queryParams",JSON.stringify(that.queryParams));
		}
	}
});
//删除供应商
function delFunc(index, params) {
	syncData(ykyUrl.product + '/v1/strategy/' + params[0], 'DELETE', null , function (res , err) {//页面加载前调用方法
		if(err == null){
			vm.refresh = !vm.refresh;
		}
    });
	
}
 function changStauts(index, params){
	 var data = {
			 id:params[0],
			 strategyStatus:params[1]
	 }
	 var str = params[1] == 'START' ? '启用成功！' : '停用成功！';
	 syncData(ykyUrl.product + '/v1/strategy/' + params[0] + '/' + params[1], 'PUT', null, function(res, err){
		 if(err == null){
			 layer.msg(str);
			 vm.refresh = !vm.refresh;
		 }
	 })	
 }