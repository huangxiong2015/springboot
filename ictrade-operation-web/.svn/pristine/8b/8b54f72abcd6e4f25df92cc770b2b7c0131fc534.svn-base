<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<!-- jQuery 1.11.3 -->
<script src="${ctx}/js/lib/jquery-1.11.3.min.js"></script>
  <c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
  <link rel="stylesheet" href="${ctx}/js/lib/zTree/zTreeStyle.css"/>
  <link rel="stylesheet" href="${ctx}/css/app/helpMaintain.css"/>
  <title>运营后台</title>
</head>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

	<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->
	  
	  <!-- 右边内容显示 -->
	  <div class="content-wrapper" >
		<section class="content-header">
			<a href="#" class="header_tab pitch_tab">模块维护</a>
		</section>
		<section class="content container-fluid">
			<div class="tree_area"> <!-- style="position:absolute;padding: 5px;margin: 20px;width: 300px;height: 565px;border: 1px solid #d2d2d2;" -->
				<p style="background-color: #f8f8f8;line-height:36px;padding-left:10px;color:#333;font-size:14px;">帮助中心类目视图</p>
				<div>
				   <ul id="treeDemo" class="ztree"></ul>
				</div>
			</div>
			<div class="h_content_area ms-controller" :controller="list"> 
				<p style="background-color: #f8f8f8;line-height:36px;padding-left:10px;color:#333;font-size:14px;">维护子类目</p>
				<div class="load_complete" style="margin:20px;">
					<p class="mb20 f16">
						<span>帮助中心</span>
					    <em class="dn">></em><span id="pathName1"></span>
						<em class="dn">></em><span id="pathName2"></span>
						<em class="dn">></em><span id="pathName3"></span>
						<a href="javascript:void(0);;" class="r new_btn" :if="!@newContentBtn" :click="@editMenu()">新增</a>
						<a href="javascript:void(0);" class="r new_btn" :if="@newContentBtn" :click="@newContent">新增</a>						
					</p>					
					<table cellspacing="0" cellpadding="0" class="f14 g3" style="width:100%;" :if="!@newContentBtn">
			    		<thead>
				    		<tr>
				    			<th style="width:15%;">类目名称</th>
				    			<th style="width:11%;">表现形式</th>
				    			<th style="width:13%;">创建时间</th>
				    			<th style="width:13%;">最后一次编辑时间</th>
				    			<th style="width:14%;">操作人</th>
				    			<th style="width:13%;">操作</th>				    			
				    		</tr>			    			
			    		</thead>
			    		<tbody>
			    			<tr class="show_list" :for="(index,ele) in @childrenList">
				    			<td :text="ele.menuName"></td>
				    			<td>
				    				<span :if="ele.level!==2">--</span>
				    				<span :if="ele.level==2">
					    				<em :if="ele.styleTypeId==''">无</em>
					    				<em :if="ele.styleTypeId=='SLIDER'">流程图</em>
					    				<em :if="ele.styleTypeId=='TAB'">Tab标签</em>
					    			</span>				    				
				    			</td>
				    			<td :text="ele.createdDate"></td>
				    			<td :text="ele.lastUpdateDate"></td>
				    			<td :text="ele.creatorName">王小三</td>
				    			<td><a href="javascript:void(0);" class="m_delete_icon" :click="@editMenu(ele)"></a><a href="javascript:void(0);" class="m_edit_icon ml10" :click="@deleteMenu(ele.menuId)"></a></td>		    			
			    			</tr>			    			
			    		</tbody>	    		
	    			</table>	    			
	    			<table cellspacing="0" cellpadding="0" class="f14 g3" style="width:100%;" :if="@newContentBtn">
			    		<thead>
				    		<tr>
				    			<th style="width:17%;">更新时间</th>
				    			<th style="width:11%;">发布时间</th>
				    			<th style="width:11%;">创建人</th>
				    			<th style="width:11%;">状态</th>
				    			<th style="width:14%;">操作</th>				    							    			
				    		</tr>			    			
			    		</thead>
			    		<tbody>
			    			<tr :for="(index,ele) in @contentList">
				    			<td :text="ele.lastUpdateDate"></td>
				    			<td :text="ele.status=='PUBLISHED'?ele.publishDate:'--'"></td>
				    			<td :text="ele.author"></td>
				    			<td>
				    				<span :if="ele.status=='DRAFT'">待发布<a class="ml10 g_blue" :click="@editStatus('PUBLISHED',ele.newsId)">发布</a></span>
				    				<span :if="ele.status=='PUBLISHED'">已发布<a class="ml10 g_blue" :click="@editStatus('HOLD',ele.newsId)">停用</a></span>
				    				<span :if="ele.status=='HOLD'">停用<a class="ml10 g_blue" :click="@editStatus('PUBLISHED',ele.newsId)">发布</a></span>
				    			</td>
				    			<td>
				    				<a href="javascript:void(0);" class="m_preview_icon" :click="@preveiwContent(ele)"></a>
				    				<a href="javascript:void(0);" class="m_delete_icon ml10" :if="ele.status!=='PUBLISHED'" :click="@editContent(ele.newsId)"></a>
				    				<a href="javascript:void(0);" class="m_edit_icon ml10" :if="ele.status!=='PUBLISHED'" :click="@deleteContent(ele.newsId,'DELETED')"></a>
				    			</td>		    			
			    			</tr>			    			
			    		</tbody>	    		
	    			</table>
	    			<div class="new_save f14 bdc mt10" :if="!@newContentBtn" >
	    			 <p style="background-color: #f8f8f8;height:30px;line-height:30px" class="pl20 g3"><span :if="@editStatusTip">新增</span><span :if="!@editStatusTip">编辑</span>分类</p>
	    			 <p class="mt20 pl20">
		    			 <span class="g3">分类名称：</span>
		    			 <input maxlength="5" type="text" id="menuName" style="width:200px;height:25px;line-height:25px;":duplex="@menuData.menuName" :focus="@focusNewMenu">
	    			 </p>
	    			 <p class="mt20 pl20" :if="@activeMenu.level==1">
		    			 <span class="g3">表现形式：</span>
		    			 <select :duplex="@menuData.styleTypeId" style="width:200px;height:25px;line-height:25px;border:1px solid #e2e2e2;border-radius:3px;">
		    			 	<option value="">无</option>
		    			 	<option value="SLIDER">流程图</option>
		    			 	<option value="TAB">Tab标签</option>
		    			 </select>
	    			 </p>
	    			 <!-- <p class="mt20 pl20" :if="@activeMenu.level==2 && @activeMenu.styleTypeId=='SLIDER'">
		    			 <span class="g3">icon展示：</span>
		    			 <select :duplex="@menuData.menuLogoUrl" style="width:200px;height:25px;line-height:25px;border:1px solid #e2e2e2;border-radius:3px;">
		    			 	<option value="i_user">i_user</option>
		    			 	<option value="i_goods">i_goods</option>
		    			 	<option value="i_search">i_search</option>
		    			 	<option value="i_dollar">i_dollar</option>
		    			 	<option value="i_voyage">i_voyage</option>
		    			 	<option value="i_order">i_order</option>
		    			 	<option value="i_stick">i_stick</option>
		    			 	<option value="i_rmb">i_rmb</option>
		    			 	<option value="i_shoppingCart">i_shoppingCart</option>
		    			 	<option value="i_searchOrder">i_searchOrder</option>
		    			 	<option value="i_paySafe">i_paySafe</option>
		    			 	<option value="i_partList">i_partList</option>
		    			 	<option value="i_sumList">i_sumList</option>
		    			 	<option value="i_inventory">i_inventory</option>
		    			 	<option value="i_recordList">i_recordList</option>
		    			 </select>
		    			 <em class="dib icon_sy" :class="@menuData.menuLogoUrl"></em>
	    			 </p> -->
	    			 <p class="mt20 mb20 pl20"><a :click="@saveData" class="edit_btn">保存</a><a class="edit_btn" :click="@editMenu()">取消</a></p>
	    			</div>
				</div>
			</div>
		</section>
		<script type="text/javascript">
			var selectCatid = "242,297";
		</script>
	<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->
</div>	    
</body>
<script type="text/javascript" src="${ctx}/js/lib/zTree/jquery.ztree.all.js"></script>
<script>
//var database = 'http://192.168.1.253:27081/v1/menus';
var database = ykyUrl.database + '/v1/menus';
var zTreeObj,zNodes,treeObj;
var activeMenuId = getQueryString("activeMenuId");

//判断流程条数显示隐藏新增按钮
function checkBtn(){
	var length = $(".show_list").length;
	if(length >= 7){
		$(".new_btn").hide();
		$(".new_save").hide();
	}else{
		$(".new_btn").show();
		$(".new_save").show();
	}
};
$(window).load(function(){
	if(maintain.activeMenu.styleTypeId === "SLIDER"){
		//checkBtn();
	}
});
var deepCopy = function(source) { 
	 var result={};
	 for (var key in source) {		 	
	       result[key] = typeof source[key]==='object'? deepCopy(source[key]) : source[key];		 
	    } 
	    return result; 
	}

var setting = {//zTree配置
		 data : {
				key : {
					name : "menuName"
				},
				simpleData : {
					enable : true,
					idKey : "menuId",
					pIdKey : "parentMenuId",
					rootPId : -1
				}
				
			},
		   	edit:{
		   		enable:true,
		   		showRemoveBtn:false,//是否显示删除按钮
		   		showRenameBtn:false,//是否显示编辑名称按钮
		   		drag:{
		   			isCopy:false,//是否允许复制节点
		   			isMove:true,//是否允许移动节点
		   			prev: true,
					next: true,
		   			inner:false//是否允许成为目标节点的子节点
		   		}
		   	},
		   	view:{
		   		//selectedMulti:false//是否允许同时选中多个节点
		   	},
		   	callback:{
		   		onClick:zTreeOnClick,//点击事件回调
		   		beforeDrag: zTreeBeforeDrag,//被拖拽之前的事件回调  
		   		beforeDrop:zTreeBeforeDrop,//拽操作结束之前的事件回调
		   		onDrop: zTreeOnDrop//拖拽操作结束的事件回调		   		  
		   	}
	   };
var pathList;
function getPathList(list){//面包屑数据填充
	if(pathList[1]){
		 $("#pathName1").text(pathList[1].menuName);
		 $("#pathName1").prev().removeClass("dn");
	 }else{
		 $("#pathName1").text("");
		 $("#pathName1").prev().addClass("dn");
	 }
	 if(pathList[2]){
		 $("#pathName2").text(pathList[2].menuName);
		 $("#pathName2").prev().removeClass("dn");
	 }else{
		 $("#pathName2").text("");
		 $("#pathName2").prev().addClass("dn");
	 }
	 if(pathList[3]){
		 $("#pathName3").text(pathList[3].menuName);
		 $("#pathName3").prev().removeClass("dn");
	 }else{
		 $("#pathName3").text("");
		 $("#pathName3").prev().addClass("dn");
	 }
}
function zTreeOnClick(event, treeId, treeNode, clickFlag) {//点击事件回调
	$("#menuName").blur();
	 maintain.menuData = menuTep;
	 maintain.editMenuDetail = [];
	 maintain.clickMenu(treeNode.menuId,treeNode.level);
	 maintain.editStatusTip = true;	 
	 pathList = treeNode.getPath();
	 getPathList(pathList);
	 //treeObj.expandNode(treeNode)
};
function zTreeBeforeDrag(treeId, treeNodes) {//被拖拽之前的事件回调  
	$("#menuName").blur();
	 maintain.menuData = menuTep;
	 maintain.editMenuDetail = [];
	 maintain.clickMenu(treeNodes[0].menuId,treeNodes[0].level);
	 maintain.editStatusTip = true;
	 pathList = treeNodes[0].getPath();
	 getPathList(pathList);
} 
function zTreeBeforeDrop(treeId, treeNodes, targetNode, moveType) {//拽操作结束之前的事件回调
	if(treeNodes[0].level!==targetNode.level)
			 return false;
	
	if(treeNodes[0].level==targetNode.level && treeNodes[0].parentMenuId !== targetNode.parentMenuId)
  		 return false;    	
         
	
}
function zTreeOnDrop(event, treeId, treeNodes, targetNode, moveType) {//拖拽操作结束的事件回调
	 maintain.menuData.menuId = maintain.activeMenu.menuId;
	 maintain.menuData.menuName = maintain.activeMenu.menuName;
	 maintain.menuData.orderSeq = targetNode?targetNode.orderSeq:maintain.activeMenu.orderSeq;
	 maintain.menuData.menuStatus = 'ACTIVE';
	 maintain.menuData.styleTypeId = maintain.activeMenu.styleTypeId;
	 maintain.menuData.parentMenuId = maintain.activeMenu.parentMenuId;
	 //maintain.editMenuDetail = [];
	 $.aAjax({
		 url: database + '/' + treeNodes[0].menuId,
		 type: 'PUT',
		 data: JSON.stringify(maintain.menuData.$model),
		 success:function(data){
			 //location.reload();
			 location.href =  '${ctx}/helpMaintain.htm?activeMenuId='+ maintain.activeMenu.menuId;
			 },
		error:function(data){
			console.log("error");
			}
	 })
	};
	 
    
   
var menuTep = {
        "menuId": "",        
        "menuName": "",
        "orderSeq": "1",
        "menuUrl": "",
        "menuStatus": "",
        "menuTypeId": "HELP_CENTER",
        "styleTypeId": "",
        "parentMenuId": "",
        "menuLogoUrl": "i_user"
      };

var maintain = avalon.define({
	$id:"list",
	dataList:[],
	childrenList:[],
	contentList:[],
	activeMenu:[],
	menuData:{},
	editMenuDetail:[],
	newContentBtn:false,
	editStatusTip:true,
	clickMenu:function(id,level){//选中菜单
		maintain.childrenList = [];
		maintain.contentList = [];
		$.each(this.dataList,function(idx,ele){
			if(ele.parentMenuId == id){
				ele.level = Number(level)+1;
				maintain.childrenList.push(ele)
			}
			if(ele.menuId == id){
				ele.level = level;
				maintain.activeMenu = ele;
			}
		})
		if((level==2&&maintain.activeMenu.styleTypeId=="")||level==3){
			maintain.newContentBtn = true;
		}else{
			maintain.newContentBtn = false;
		}
		/* 获取文案内容列表 */
		if(maintain.childrenList.length==0&&level>1&&maintain.activeMenu.styleTypeId==""){
			$.aAjax({
				 url:ykyUrl.product + '/v1/news',
				 type:'GET',
				 data:{
					 categoryTypeIdStr:'HELP',
					 categoryId:id
				 },
				 success:function(data){
					 //var list = JSON.parse(data);
					 maintain.contentList = data.list;
				 },
				 error:function(data){
					 console.log("error");
				 }
			 })
		}
	},
	editMenu:function(ele){//新增、编辑菜单信息
		 $("#menuName").blur();
		 if(ele){
			 $("#menuName").focus();
			 maintain.editMenuDetail = ele;
			 maintain.focusNewMenu(ele);
		 }else{
			 maintain.editMenuDetail = [];
			 $("#menuName").focus();			 
			 maintain.focusNewMenu();
		 }
		 if(maintain.activeMenu.styleTypeId === "SLIDER"){
				//checkBtn();
			}
	 },
	 focusNewMenu:function(ele){
		 if(ele.menuName){//编辑
			 $("#menuName").focus();
			 maintain.editStatusTip = false;
			 maintain.menuData.menuId = ele.menuId;
			 maintain.menuData.menuName = ele.menuName;
			 maintain.menuData.orderSeq = ele.orderSeq;
			 maintain.menuData.menuStatus = ele.menuStatus;
			 maintain.menuData.styleTypeId = ele.styleTypeId;
			 maintain.menuData.parentMenuId = ele.parentMenuId?ele.parentMenuId:maintain.activeMenu.menuId;
			 maintain.menuData.menuLogoUrl = ele.menuLogoUrl;			 
		 }else if(maintain.editMenuDetail.menuName){
			 $("#menuName").focus();
			 maintain.editStatusTip = false;
			 maintain.menuData.menuId = maintain.editMenuDetail.menuId;
			 maintain.menuData.menuName = maintain.editMenuDetail.menuName;
			 maintain.menuData.orderSeq = maintain.editMenuDetail.orderSeq;
			 maintain.menuData.menuStatus = maintain.editMenuDetail.menuStatus;
			 maintain.menuData.styleTypeId = maintain.editMenuDetail.styleTypeId;
			 maintain.menuData.parentMenuId = maintain.editMenuDetail.parentMenuId?maintain.editMenuDetail.parentMenuId:maintain.activeMenu.menuId;
			 maintain.menuData.menuLogoUrl = maintain.editMenuDetail.menuLogoUrl;
		 }else{//新增
			 $("#menuName").focus();
			 maintain.editStatusTip = true;
			 maintain.menuData.menuId = "";
			 maintain.menuData.menuName = "";
			 maintain.menuData.orderSeq = maintain.childrenList.length == 0 ? 1 : Number(maintain.childrenList[maintain.childrenList.length-1].orderSeq) + 1;
			 maintain.menuData.menuStatus = 'ACTIVE';
			 maintain.menuData.styleTypeId = "";
			 maintain.menuData.parentMenuId = maintain.activeMenu.menuId;
			 
		 }
	 },
	 saveData:function(){//保存菜单
		 maintain.menuData.menuName = $.trim(maintain.menuData.menuName);
		 if(maintain.menuData.menuName){
			 var flag = maintain.menuData.menuId ? false : true;
			 $.aAjax({
				 url: flag ? database : database + '/' +maintain.menuData.menuId,
				 type: flag ? 'POST':'PUT',
				 data: JSON.stringify(maintain.menuData.$model),
				 success:function(data){
					 //location.reload()
					 if(maintain.activeMenu.menuId){
						 location.href =  '${ctx}/helpMaintain.htm?activeMenuId='+ maintain.activeMenu.menuId;
					 }else{
						 location.href =  '${ctx}/helpMaintain.htm';
					 }					 
				 },
				 error:function(data){
					 console.log("error");
				 }
			 })
		 }		 	 
	 },
	 deleteMenu:function(id){//删除菜单
		 var menuNode = treeObj.getNodeByParam('menuId',id);
		 if(menuNode.children){
			 layer.alert("该分类下已有子分类，无法删除。请先删除分类下的所有子分类才能删除此分类。",{
				 offset: "auto",
					btn: ['确      认'], //按钮
					title: " ",	
					area: 'auto',
					maxWidth:'500px',
					move: false,
					skin: "up_skin_class",
					closeBtn: false,
					})
		 }else{
			 $.aAjax({
				 url:ykyUrl.product + '/v1/news',
				 type:'GET',
				 data:{
					 categoryTypeIdStr:'HELP',
					 categoryId:id
				 },
				 success:function(data){
					 //var list = JSON.parse(data).list;
					 var list = data.list;
					 if(list.length == 0){
						 layer.alert("确认是否删除？",{
							 offset: "auto",
								btn: ['确      认','取      消'], //按钮
								title: " ",	
								area: 'auto',
								maxWidth:'500px',
								move: false,
								skin: "up_skin_class",
								closeBtn: false,
								yes:function(){
									console.log("删除成功")
									 $.aAjax({
										 url:database +'/'+ id,
										 type:"DELETE",
										 success:function(data){
											 //location.reload();
											 location.href =  '${ctx}/helpMaintain.htm?activeMenuId='+ maintain.activeMenu.menuId;
										 },
										 error:function(data){
											 console.log("error");
										 }
									 })
								}
						 })
					 }else{
						 var flag = true;
						 $.each(list,function(index,ele){
							 if(ele.status == "PUBLISHED"){
								 flag = false;
								 layer.alert("该分类已发布，无法删除。请先停用已发布的帮助文案才能删除此分类。",{
									 offset: "auto",
										btn: ['确      认'], //按钮
										title: " ",	
										area: 'auto',
										maxWidth:'500px',
										move: false,
										skin: "up_skin_class",
										closeBtn: false,										
								 })
							 }
						 });
						 if(flag){
							 layer.alert("该分类下有待发布的文案信息，请确认是否删除？",{
								 offset: "auto",
									btn: ['确      认','取      消'], //按钮
									title: " ",	
									area: 'auto',
									maxWidth:'500px',
									move: false,
									skin: "up_skin_class",
									closeBtn: false,
									yes:function(){
										console.log("删除成功")
										$.aAjax({
											 url:database +'/'+ id,
											 type:"DELETE",
											 success:function(data){
												 //location.reload();
												 location.href =  '${ctx}/helpMaintain.htm?activeMenuId='+ maintain.activeMenu.menuId;
											 },
											 error:function(data){
												 console.log("error");
											 }
										 })
									}
							 })
						 }
					 }
				 },
				 error:function(data){
					 console.log("error");
				 }					 
			 })
		 }
	 },
	 newContent:function(){
		 var pathName1,pathName2,pathName3;
    	 pathName1 = pathList[1]?pathList[1].menuName:'';
    	 pathName2 = pathList[2]?pathList[2].menuName:'';
    	 pathName3 = pathList[3]?pathList[3].menuName:'';
    	 window.location.href='${ctx}/helpMaintain/edit.htm?categoryId=' +  maintain.activeMenu.menuId + '&pathName1='+ pathName1+ '&pathName2='+ pathName2+ '&pathName3='+ pathName3;
	 },
	 editContent:function(id){
		 var pathName1,pathName2,pathName3;
    	 pathName1 = pathList[1]?pathList[1].menuName:'';
    	 pathName2 = pathList[2]?pathList[2].menuName:'';
    	 pathName3 = pathList[3]?pathList[3].menuName:'';
    	 window.location.href='${ctx}/helpMaintain/edit.htm?categoryId=' +  maintain.activeMenu.menuId + '&pathName1='+ pathName1+ '&pathName2='+ pathName2+ '&pathName3='+ pathName3+'&contentId='+id;
	 },
     editStatus:function(status,contentId){   	    	 
    	 $.aAjax({
    		 url:ykyUrl.product + '/v1/news/' + contentId + '/' + status,
    		 type:'PUT',   		 
    		 success:function(data){
    			 if(status=='PUBLISHED'){
    				 layer.msg("发布成功！",{
        				 offset: "auto",
        					//btn: ['确      认'], //按钮
        					//title: " ",	
        					//area: ['350px'],
        					maxWidth:'500px',
        					move: false,
        					skin: "up_skin_class",
        					closeBtn: false,
        					yes:function(){
        						
        					}								
        			 })
    				 //location.reload()
    				 setTimeout(function(){
    					 location.href =  '${ctx}/helpMaintain.htm?activeMenuId='+ maintain.activeMenu.menuId;
    				 },1000)
        			 
    			 }
    			 if(status=='HOLD'){
    				 layer.msg("停用成功！",{
        				 offset: "auto",
        					maxWidth:'500px',
        					move: false,
        					skin: "up_skin_class",
        					closeBtn: false,
        					yes:function(){
        						
        					}								
        			 })
    				 //location.reload()
        			 setTimeout(function(){
    					 location.href =  '${ctx}/helpMaintain.htm?activeMenuId='+ maintain.activeMenu.menuId;
    				 },1000)
    			 }
    		 },
    		 error:function(data){
    			 if(data.status == 500 && data.responseJSON.errCode == "EXIST_OTHER_PUBLISH"){
    				 layer.alert("该位置已经存在发布！",{
        				 offset: "auto",
        					btn: ['确      认'], //按钮
        					title: " ",	
        					//area: ['350px'],
        					maxWidth:'500px',
        					move: false,
        					skin: "up_skin_class",
        					closeBtn: false,
        			 })
    			 }
    		 }
    	 })
     },
     deleteContent:function(contentId,status){ 
    	 layer.alert("确定删除？删除后不可恢复哦~",{
			 offset: "auto",
				btn: ['确      认','取      消'], //按钮
				title: " ",	
				area: ['350px'],
				maxWidth:'500px',
				move: false,
				skin: "up_skin_class",
				closeBtn: false,
				yes:function(){
					$.aAjax({
			    		 url:ykyUrl.product + '/v1/news/' + contentId,
			    		 type:'DELETE',
			    		 contentType:"application/json",
			    		 dataType:"text",
			    		 success:function(data){
			    			 location.href =  '${ctx}/helpMaintain.htm?activeMenuId='+ maintain.activeMenu.menuId;
			    		 },
			    		 error:function(data){
			    			 console.log("error");
			    		 }
			    	 })
				}								
		 })
    	 
     },
     preveiwContent:function(ele){
    	 window.open(ykyUrl.portal+'/help/'+ele.categoryId+'.htm?newsId='+ele.newsId);
     }
})
maintain.menuData = menuTep;
$.aAjax({
	 url:database + '/helpcenter',
	 type:'GET',
	 /* data:{
		 menuTypeId:'HELP_CENTER'
	 }, */
	 success:function(data){
		 
		 zNodes = data;
		 zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, zNodes);
		 treeObj = $.fn.zTree.getZTreeObj("treeDemo");
		 var nodes = treeObj.getNodes();
		 maintain.dataList = data;
		 if (nodes.length>0 && !activeMenuId){
		 	treeObj.selectNode(nodes[0]);//选中默认节点
		 	treeObj.expandNode(nodes[0]);//展开默认节点
		 	maintain.clickMenu(nodes[0].menuId,nodes[0].level);
		 	}else{
			 	$.each(zNodes,function(i,e){
			 		if(e.menuId == activeMenuId){
			 			var a_nodes = treeObj.getNodeByParam('menuId',activeMenuId);
			 			treeObj.selectNode(a_nodes);//选中指定节点
			 			treeObj.expandNode(a_nodes);//展开指定节点
			 			pathList = treeObj.getSelectedNodes()[0].getPath();
			 			getPathList(pathList);
			 			maintain.clickMenu(a_nodes.menuId,a_nodes.level);
			 		}
			 	})
			 }
		 //$(".load_complete").removeClass("dn");
	 },
	 error:function(data){
		 console.log('error');
	 }
});

</script>
</html>
