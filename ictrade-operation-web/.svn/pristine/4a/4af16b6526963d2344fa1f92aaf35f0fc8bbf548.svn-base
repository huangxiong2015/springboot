<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
	<%-- <link rel="stylesheet" href="${ctx}/css/app/goods.css"> --%>
	<title>物料上传</title>
	<style>
	.upload_area .upload_btn {
	    width: 68px;
	    height: 28px;
	    line-height: 28px;
	    border: solid 1px #ddd;
	    color: #333;
	    cursor: pointer;
	}
	.upload_area .upload_btn:hover{
		border: solid 1px #b1191a;
	    color: #b1191a;
	}
	.progressBar{
	    display: none;
	    width: 100px;
	    height: 8px;
	    background: #ddd;
	    border: 0 !important;
	    border-radius: 0;
	}	
	.ui-widget-header {
	    background: #87b848;
	    border-radius: 0;
	}
	#saveBtn.save_btn {
	    display: inline-block;
	    width: 110px;
	    height: 35px;
	    line-height: 35px;
	    background: #b1191a;
	    color: #fff;
	}
	#saveBtn.disable {
	    background-color: #b4b4b4;
	    cursor: default;
	}
	.operation_explain {
	    padding: 15px;
	    background-color: #fafafa;
	    border: solid 1px #eee;
	}
	.dn{
		display:none;
	}
	.g_blue{
		color:#0100ff !important;
	}
	.mt15{
		margin-top:15px;
	}
	.ml65{
		margin-left:65px;
	}
	.ui-progressbar .ui-progressbar-value{
		margin:0px;
	}
	div.msg_skin_class .layui-layer-content{
		line-height:78px;
	}
	</style>

	
</head>

<body id="loadType" class="hold-transition skin-blue sidebar-mini basic_material">
<div class="wrapper">

	<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->
	  	    	   
	   <!-- 物料信息 -->
	   <div class="content-wrapper" >
			<section class="content-header">
				<a href="javascript:;" class="header_tab pitch_tab">添加物料-上传文件</a>
			</section>			
			<section class="content container-fluid ms-controller" ms-controller="upload">
				<div class="mt20 upload_area rel">
					<span class="mr5">上传文件：</span>					
					<span href="javascript:;" class="upload_btn dib tc init_tips" id="file">选择文件</span>
					<span class="ml8 g9 init_tips">支持扩展名为xls、xlsx、csv的Excel文件 ，大小不能超过10MB</span>					
					<div class="dib">
						<div class="doing_tips dn">
							<span class="mr20 g3" id="fileName"></span>
							<div class="progressBar" id="progressBar"></div>
							<span class="ml5 g9" id="showPercent"></span>
						</div>
					</div>
				</div>
				<a href="${ctx}/template/BasicMaterial_template.xlsx" class="g_blue mt10 ml65 db g9 upload_tips init_tips">点击下载标准Excel文件范本</a>
				<span href="javascript:;" class="mt10 ml65 db g9 upload_tips dn doing_tips">正在上传文件，请勿刷新或关闭页面...</span>
				<span href="javascript:;" class="mt10 ml65 db g9 upload_tips dn finish_tips">文件上传成功</span>
				<a href="javascript:;" id="saveBtn" :class="['save_btn','mt30','tc',(@btnStatus?'':'disable')]":click="@basismaterialUpload">确认保存</a>
				<div class="operation_explain mt15 mb15 g9">
					<p class="b mb10">操作说明：</p>
					<p class="mb8">1.当物料型号、制造商这2列内容完全相同时，此类物料默认为相同物料；</p>
					<p class="mb8">2.在此上传库存文件将采用程序自动处理，文件内容严格按照标准格式，否则转换时可能产生错误；</p>
					<p class="mb8">3.如果您已经上传了物料文件，请点击<a class="g_blue" href="${ctx }/basicMaterial/history.htm">查看上传文件的处理状态</a></p>
				</div>
			</section>
		</div>
	<script type="text/javascript">
		var selectCatid = "2991,298";
	</script>
	<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->

</div>	    
<!-- ./wrapper -->
<script type="text/javascript" src="${ctx}/js/oss/common.js"></script>
<script type="text/javascript" src="${ctx}/js/lib/plupload-2.1.2/js/plupload.full.min.js"></script>
<script type="text/javascript" src="${ctx}/js/oss/register/oss_register.js"></script>
<script>
	var uploader,fileName='',_fileUrl='';
	var materialUpload = avalon.define({
		$id:'upload',
		btnStatus:false,
		basismaterialUpload:function(){
			if(!this.btnStatus){
				return;
			}
			
			$.aAjax({
				type : "POST",
				url : ykyUrl.product + '/v1/basicmaterial/notification/upload', 
				data :JSON.stringify({
					fileUrl:_fileUrl,
					oriFileName:fileName
				}),
				contentType : "application/json",
				async : false,
				success : function(msg) {
					materialUpload.btnStatus = false;
					$("#saveBtn").css("cursor","default");
					layer.msg("<p class='g3'><i class='icon-right-c' style='font-size:24px;font-weight:bold;color:#87b848;margin-right:15px;position:relative;top:3px;'></i>物料资料已保存成功！</p>", {							
						area:["500px","120px"],
						offset : 120,
						skin: "msg_skin_class"
					});
					setTimeout(function(){
						location.href = ykyUrl._this + '/basicMaterial/history.htm';
						},2000);
				},
				error : function() {
					layer.msg("上传文件失败,请重新上传！", {
						icon : 2,
						offset : 120
					});
					layer.close(index);
				}
			});
		}
	})
	uploader = createUploader2('file','productUpload.basicMaterialUpload',false);
	uploader.init();
	function updateProgressBar(percent){
		$( "#progressBar" ).progressbar({
		      value: Number(percent)
		    });
		$("#showPercent").text(percent+'%');
	}
	function beforeUpload(_fileName){
		$(".init_tips").addClass("dn");
		$("#fileName").text(_fileName);
		$("#progressBar").css("display","inline-block");
		$(".doing_tips").removeClass("dn");
		updateProgressBar('0')
	}
	function fileUploaded(){
		$(".finish_tips").prev().addClass("dn");
		$(".finish_tips").removeClass("dn");
		materialUpload.btnStatus = true;		
	}
</script>

 
</body>
</html>