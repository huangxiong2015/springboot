<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
   <%--  <link rel="stylesheet" href="${ctx}/css/app/goods.css"> --%>
	<title>文件上传历史记录</title>
	<c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
	<style>
	/* 文件上传历史  */
    .table{
	    width: 96%;
	    max-width: 100%;
	    margin: 20px;
    }
	.mb7{margin-bottom:7px;}
	.mt13{margin-top:13px;}
	.mt15{margin-top:15px;}
	.mb13{margin-bottom:13px;}
	.mb15{margin-bottom:15px;}
	.ml65{margin-left:65px;}
	.w170{width:170px;height:14px;}
	.g9,.g9:visited,.g9:link,.g9:active{color:#999;}
	.g9:hover{color:#999;}
	.g_green{color:#87b848;}
	.g_red{color:#b1191a;}
	.g_blue{color:#3377aa}
	.g_blue:hover,.g_blue:link,.g_blue:active,.g_blue:visited{color:#3377aa}
	.float_r .r_nav {height: 60px;padding-left: 20px;margin-bottom: 10px;width: 958px;line-height: 60px;font-size: 16px;color:#333;font-weight:bold;background-color: #fff;border: solid 1px #eeeeee;}
	.float_r .r_content {width: 938px;background-color: #fff;min-height: 492px;padding-bottom: 25px;padding:0px 20px;border: solid 1px #eeeeee;}  
   
   /* 商品上传结果页 */
	.r_content .history_tlt{height:60px;line-height:60px;border-bottom:1px solid #ddd;}
	.history_table thead tr{height:36px;background-color: #f8f8f8;text-}
	.history_table th{font-weight:normal;}
	.history_table tbody tr{height:60px;}
	.history_table tbody td{border-bottom:1px solid #eee;vertical-align:top;padding-top:15px;text-align: center;}
	.history_table tbody td ul li{overflow: hidden;text-overflow: ellipsis;white-space: nowrap;width: 100px;height: 14px;}
	.history_table tbody td .reason{display:inline-block;width:120px;height:20px;}
   /* 增加  */
   .over_tw{
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    width: 15em;
    }
    .history_table{
     width:96%;
     margin:0px auto;
     }
    .history_table th{
       background-color:#eeeeee;
       text-align: center;
     }
	.item_page .showpages {
	    height: 120px;
	    margin-bottom: 30px;
	}
	</style>
</head>

<body class="hold-transition skin-blue sidebar-mini">
<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->
 <div class="content-wrapper ms-controller" style="min-height: 406px;" ms-controller=list >
     <!-- Content Header (Page header) -->
	    <section class="content-header">
			<a href="#" class="header_tab pitch_tab">文件上传历史</a>
		</section>  
		<section >
	   <!-- 表格 -->
	  <div class="row mt20">
		<div class="col-xs-12" id="data_table" >
	     <table class="history_table" cellspacing="0" cellpadding="0">
	    		<thead>
		    		<tr>
		    			<th width="18%">上传时间</th>
						<th width="24%">文件名称</th>
						<th width="16%">处理结果</th>
						<th width="16%">原因</th>
						<th width="16%">操作</th>	
						<th width="10%">操作人</th>
		    		 </tr>
	    		</thead>
	    		<tbody >	 
	    		 	<tr ms-for="(index,ele) in @historyList.list"  >
		    			<td class="g3" >{{ele.createdDate}}</td>
		    			<td class="g3">
		    				<span class="dib over_tw w170" :attr="{title:ele.documentName?ele.documentName:'--'}" :text="ele.documentName?ele.documentName:'--'"></span>
		    			</td>
		    			<td class="g3" >
		    			    <span class="g_green" :if="ele.statusId=='DOC_PRO_SUCCESS'">全部成功</span>
		    				<span class="g_red" :if="ele.statusId=='DOC_PRO_PART_SUCCESS'">部分成功</span>
		    				<span class="g_red" :if="ele.statusId=='DOC_PRO_FAILED'">全部失败</span>
		    				<span class="g_red" :if="ele.statusId=='DOC_CREATED'">正在处理</span>
		    				<span class="g_red" :if="ele.statusId=='DOC_IN_PROCESS'">正在处理</span>
		    				<span class="g_red" :if="ele.statusId=='DOC_LOCKED'">正在处理</span>
		    				
		    			</td>
		    			<td>
			    			<!-- <span :class="['over_tw','reason',(ele.comments?'g3':'g9')]" :attr="{title:ele.comments?ele.comments:''}" :text="ele.comments?ele.comments:'--'"></span> -->
			    		   <span :class="['over_tw','reason',(ele.comments?'g3':'g9')]" :click="@errorTips(ele.comments)" :text="ele.comments?ele.comments:'--'"></span>
			    		</td>
		    			<td class="g3" >
		    				<span class="g9" :if="ele.statusId=='DOC_PRO_SUCCESS'">--</span>
		    				<a href="javascript:;" class="g_blue" :if="ele.statusId=='DOC_PRO_PART_SUCCESS'" :click="@downloadErrorFile(ele.id)">下载错误文件</a>		    				
		    				<a href="javascript:;" class="g_blue" :if="ele.statusId=='DOC_PRO_FAILED'" :click="@downloadErrorFile(ele.id)">下载错误文件</a>
		    				<span class="g9" :if="ele.statusId=='DOC_CREATED'">--</span>
		    				<span class="g9" :if="ele.statusId=='DOC_IN_PROCESS'">--</span>
		    				<span class="g9" :if="ele.statusId=='DOC_LOCKED'">--</span>
		    			</td>
		    			<td><span :class="['over_tw','reason',(ele.creator?'g3':'g9')]" :attr="{title:ele.creator}" :text="ele.creator?ele.creator:'--'"></span></td>
	    			 <tr  :if="!@isLoading && @historyList.list.length == 0">
	    				<td colspan="7" class="tc">
					    		<p style="margin-bottom:160px;">暂无数据</p>
	    				</td>
	    			</tr> 
	    		</tbody>
	    	</table>
			</div>	
		 </div>	
		</section>
		<section >
			<div class="item_page" >
					<div class="title_lf showpages" style="margin-left:2%;float:left;">
						<span class="l ml15 mr5">每页显示</span>
						<div class="show_number_extrude l">
	            		<span class="spn" :text="@size?@size:20"></span><i class="icon-down"></i><i class="icon-upward dn"></i>
		            	<div class="show_number_cont">
		            		<ul>
	 	            		    
		            		    <li><a href="javascript:;" :click="@setPageSize(10);">10</a></li>
		            		    
		            		    <li><a href="javascript:;" :click="@setPageSize(20);">20</a></li>
	 	            			
		            			<li><a href="javascript:;" :click="@setPageSize(50);">50</a></li>
		            											
		            			<li><a href="javascript:;" :click="@setPageSize(100);">100</a></li>
		            			
		            		</ul>
		            	</div>
	            	</div>
						<span>条</span>
					</div>
					<div id="pager">
						<div id="kkpager"></div>			        
					</div>
			        <input type="hidden" value="" id="total">
					<input type="hidden" value="" id="pageSize">
		  </div>
		</section>
 
		    
     <form id="exportForm" action="excel/down.htm" method="POST" target="_blank" style="display:none;">
			<input type="hidden" name="Authorization" value="Basic <shiro:principal property="loginName" />"/>
			<input id="docId" type="hidden" name="docId" value=""/>
	</form> 
	<script type="text/javascript">
		var selectCatid = "239,298";
	</script>
<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->
<!-- wrapper -->
<script src="${ctx}/js/lib/kkpager.js"></script>
<script src="${ctx}/js/common/ykypage.js"></script> 
<script type="text/javascript" src="${ctx}/js/lib/layer/layer.js"></script>
<script type="text/javascript">

  	//分页
 var page = getQueryString("page")?getQueryString("page"):1,size = getQueryString("size")?getQueryString("size"):20;

 $(function(){ 
	  getHistoryData();  //获取列表数据 
	 });
	
 var uploadHistory = avalon.define({
  	$id:'list',
  	size:size,
  	historyList:[],
  	isLoading:true,
  	setPageSize:function(size){
		location.href='${ctx}/basicMaterial/history.htm?size='+size
	},
    downloadErrorFile:function(id){
  		$("#docId").val(id);
  		$("#exportForm").submit();  
  	},
  	errorTips:function(text){
    	a=text;
    	if(text){
    		layer.msg(text, {time: 3000});
    	}
  	}  
	
  }) 
   var a;
function getHistoryData(){
	 $.aAjax({
			url:ykyUrl.product+"/v1/imports/history?docTypeId=VENDOR_SPU_DOCUMENT",
			type:"GET",	
			data:{
				page:page,
				pageSize:size
			},
			success:function(data){
				uploadHistory.historyList = data;
				a=uploadHistory.historyList;
				setPageOption(data);
				var seachPar = GetRequestWithout(window.location.search,"page");
		    	loadPage(window.location.pathname+(seachPar? seachPar : "")); 
		    	uploadHistory.isLoading = false; 
		    
			},
			error:function(data){
				
			}
		})
	 
  }

 </script>
</body>
</html>