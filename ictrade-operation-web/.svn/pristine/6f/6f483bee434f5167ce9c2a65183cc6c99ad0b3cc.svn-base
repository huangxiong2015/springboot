<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<!-- jQuery 1.11.3 -->
  <c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
  <title>订单列表</title>
  <link rel="stylesheet" href="${ctx}/js/credenceUpload/credenceUpload.css?20161229" />
  <link rel="stylesheet" href="${ctx}/css/app/orderList.css" />
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
	<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->	  
	  <!-- 右边内容显示 -->
	  <div class="content-wrapper ms-controller"  ms-controller=list>
		<!-- Content Header (Page header) -->
		<section class="content-header">
			<a href="#" class="header_tab pitch_tab">订单管理</a>
			<input type="hidden" id="orderId" value="237" />
		</section>
	    <!-- Main content -->
		<section class="content container-fluid">
			<div class="row mt20" ms-controller="search" id=searchFrom>
				<div class="col-xs-10 m-btn" >
						<div class="col-xs-6 col_bt">
							<label>订单编号：</label>						
							<input class="col_input_3" type="text" name="orderNumber" data-duplex="@parameter.orderNumber" ms-attr="{value:@parameter.orderNumber}" >
							<label class="ml5">状态：</label>						
							<select id="status" name="status" ms-duplex="@parameter.status">
								<option value="">全部</option>
								<option  ms-for="el in @statusSelected" ms-attr="{value:el.value}" >{{el.optionVal}}</option>
							</select>
							<label class="ml5">总价：</label>
							<input class="col_input_3" type="text" name="totalPriceBegin" data-duplex="@parameter.totalPriceBegin" ms-attr="{value:@parameter.totalPriceBegin}">
							<span class="ml5 mr5">-</span>
							<input class="col_input_3" type="text" name="totalPriceEnd" data-duplex="@parameter.totalPriceEnd" ms-attr="{value:@parameter.totalPriceEnd}">
						</div>
						<div class="col-xs-6 col_bt_time">
							<label class="">创建时间：</label>
							<span class="rel">
								<input id="createDateBegin" name="createDateBegin" class="y_main_head_input"  type="text" data-duplex="@parameter.createDateBegin" ms-attr="{value:@parameter.createDateBegin}">
				                <span class="y_timer"><i class="cc1 icon-calendar"></i></span>
							</span>
							<span>至</span>
							<span class="rel">
				                <input id="createDateEnd" name="createDateEnd" class="y_main_head_input ml10"  type="text" data-duplex="@parameter.createDateEnd" ms-attr="{value:@parameter.createDateEnd}">
				                  <span class="y_timer"><i class="cc2 icon-calendar"></i></span>
							</span>
							<span class="content_top_close" onclick="showDiv();"></span>
						</div>
						<div class="col-xs-6 col_bt">
							<label>支付号：</label>
							<input class="col_input_2" type="text" name="paymentNo" data-duplex="@parameter.paymentNo" ms-attr="{value:@parameter.paymentNo}">
							<label>账号：</label>
							<input class="col_input_2" type="text" name="account" data-duplex="@parameter.account" ms-attr="{value:@parameter.account}">
							<label>支付平台：</label>
							<select id="payment" name="payment" ms-duplex="@parameter.payment" class="m-btn-1">
								<option value="">全部</option>
								<option  ms-for="el in @paymentSelected" ms-attr="{value:el.value}" >{{el.optionVal}}</option>
							</select>
							<label>币种：</label>						
							<select id="currency" name="currency" ms-duplex="@parameter.currency" class="m-btn-1">
								<option value="">全部</option>
								<option value="CNY">RMB</option>
								<option value="USD">USD</option>
							</select>
						</div>
						<div class="col-xs-6 col_bt_time">
							<label class="">支付时间：</label>
							<span class="rel">
								<input id="paymentBegin" name="paymentBegin" class="y_main_head_input"  type="text" data-duplex="@parameter.paymentBegin" ms-attr="{value:@parameter.paymentBegin}">
				                <span class="y_timer"><i class="cc3 icon-calendar"></i></span>
							</span>
							<span>至</span>
							<span class="rel">
				                <input id="paymentEnd" name="paymentEnd" class="y_main_head_input ml10"  type="text" data-duplex="@parameter.paymentEnd" ms-attr="{value:@parameter.paymentEnd}">
				                  <span class="y_timer"><i class="cc4 icon-calendar"></i></span>
							</span>
							<span class="content_top_close" onclick="showDiv();"></span>
						</div>
				</div>
				
				<div class="col-xs-2 mt25">
					<a href="javascript:;" class="condition_inquery" ms-click="@goSearch()">
						<span ><i class="icon-sousuo mr5"></i>查询</span>
					</a>
				</div>				
				
			</div>
			
			<!-- 表格 -->
			<div class="row mt20">
				<div class="col-xs-12" id="result_table">
					<table class="table">
						<thead>
							<tr>
								<th ms-if="@audited!=1" width="30px">
									<input type="checkbox"  id="checkbox_a1" ms-duplex-checked="@allchecked" 
                           data-duplex-changed="@checkAll" class="chk_1"/>
									<label for="checkbox_a1"></label>
								</th>
								<th width="50px">序号</th>
								<th width="11%">订单编号</th>
								<th width="11%">支付号</th> 
								<th width="10%">创建时间</th>
								<th width="10%">支付时间</th>
								<th width="9%">总价</th>
								<th width="8%">币种</th>
								<th width="14%">账号</th>
								<th width="8%">支付平台</th>
 								<th width="6%">状态</th>
								<th width="8%">转账凭证</th>
								<th width="8%">客户备注</th>
								<th width="100px">操作</th>
							</tr>
						</thead>
						<tbody >
							<tr :if="@isfirst || !@list.list.length" >
								<td colspan="14" class="g-load"  id="loadingData" ms-html="@isLoading">数据加载中</td>
							</tr>
							<tr ms-for="($index, el) in @list.list">
								<td ms-if="@audited!=1">
									<input type="checkbox" ms-duplex-checked="el.checked" data-duplex-changed="@checkOne" ms-attr="{id:'checkbox_'+$index}"  class="chk_1"/>
									<label ms-attr="{for:'checkbox_'+$index}" ></label>
								</td>
								<td>{{$index + 1}}</td>
								<td ms-attr="{title:el.id}"><i :if="el.isInquiryOrder == '1'" class="colc11">★</i>{{el.id}}</td>
								<td ms-attr="{title:el.orderPay.id}">{{el.orderPay.id}}</td>
								<td ms-attr="{title:el.orderDate}">{{@toHtml(el.orderDate)}}</td>
								<td ms-attr="{title:typeof(el.orderPay.createdDate) == 'undefined' ? '' : el.orderPay.createdDate}">{{@toHtml(el.orderPay.createdDate)}}</td>
								<td ms-attr="{title:el.orderPay.amount}">{{el.orderPay.amount|number(2)}}</td>
								<td :if="el.currency == 'CNY'" ms-attr="{title:'RMB'}" >RMB</td>
								<td :if="el.currency != 'CNY'" ms-attr="{title:el.currency}" >{{el.currency}}</td>
								<td ms-attr="{title:typeof(el.purchaserName) == 'undefined' ? '' : el.purchaserName}">{{@toHtml(el.purchaserName)}}</td>
								<td class="titleClass">
									<span ms-attr="{title:'支付宝'}" :if="el.orderPay.paymentMethodId == 'ALIPAY'">支付宝</span>
									<span ms-attr="{title:'银行汇款'}"  :if="el.orderPay.paymentMethodId == 'EXT_OFFLINE'">银行汇款</span>
									<span ms-attr="{title:'企业网银'}"  :if="el.orderPay.paymentMethodId == 'UNIONPAY_B2B'">企业网银</span>
									<span ms-attr="{title:'银联'}"  :if="el.orderPay.paymentMethodId == 'UNIONPAY_B2C'">银联</span>
									<span ms-attr="{title:'微信'}"  :if="el.orderPay.paymentMethodId == 'WECHATPAY'">微信</span>
									<span ms-attr="{title:'测试支付'}"  :if="el.orderPay.paymentMethodId == 'TEST'">测试支付</span></td>
								
								<td class="titleClass">
									<span ms-attr="{title:'未支付'}" :if="el.orderStatus == 'WAIT_PAID'">未支付</span>
									<span ms-attr="{title:'待审核'}" :if="el.orderStatus == 'WAIT_APPROVE'">待审核</span>
									<span ms-attr="{title:'审核不通过'}" :if="el.orderStatus == 'REJECTED'">审核不通过</span>
									<!-- <span :if="el.orderStatus == 'WAIT_RECEIVE'">待收货</span> -->
									<span ms-attr="{title:'待发货'}" :if="el.orderStatus == 'WAIT_SHIP'">待发货</span>
									<span ms-attr="{title:'已发货'}" :if="el.orderStatus == 'WAIT_RECEIVE'">已发货</span>
									<span ms-attr="{title:'交易完成'}" :if="el.orderStatus == 'COMPLETED'">交易完成</span>
									<span ms-attr="{title:'交易关闭'}" :if="el.orderStatus == 'CANCELLED'">交易关闭</span>
									<span ms-attr="{title:'平台确认失败'}" :if="el.orderStatus == 'PSENT_RT_FAIL'">平台确认失败</span>
									<span ms-attr="{title:'支付失败'}" :if="el.orderStatus == 'PAY_FAILED'">支付失败</span>
									<span ms-attr="{title:'支付失败'}" :if="el.orderStatus == 'REFUNDED'">已退款</span>
									<span ms-attr="{title:'平台确认中'}" :if="el.orderStatus == 'WAIT_CON_PSENT'">平台确认中</span>
								<td ms-attr="{}">
									<!-- 未支付 -->
									<span :if="(el.orderStatus == 'WAIT_PAID' && el.orderPay.paymentMethodId == 'EXT_OFFLINE')">
										<a class="cred_up_btn" ms-attr="{'data-index':$index,'data-isupload':0}" >上传凭证</a></span>
									<!-- 平台确认中  -->
									<!-- 平台确认成功：待发货 、交易成功、交易失败： 如果上传了凭证，才显示 -->
									<span :if="(el.orderStatus != 'WAIT_PAID' && el.orderStatus != 'CANCELLED' && el.orderPay.paymentMethodId == 'EXT_OFFLINE') ">
										<a  class="cred_up_btn" ms-attr="{'data-index':$index,'data-isupload':1}">查看凭证</a></span>
									<!-- 平台确认失败 -->
									<span :if="el.orderStatus == 'PSENT_RT_FAIL'">
										<a class="cred_up_btn" ms-attr="{'data-index':$index,'data-isupload':-1}">重新上传</a></span></td>
									
								<td ms-attr="{title:el.orderNote.noteInfo}">{{@toHtml(el.orderNote.noteInfo)}}</td>
								<td>
									<span :if="el.orderStatus == 'WAIT_CON_PSENT'" >
										<a class="db lh25" href="javascript:;" ms-click="@auditClick(el, $event,el.orderPay.id,true)">收款成功</a>
										<a class="db lh25" href="javascript:;" ms-click="@auditClick(el, $event,el.orderPay.id,false)">收款失败</a>
									</span>
									<a class="db lh25" ms-attr="{href:'${ctx}/order.htm?action=detail&id='+el.id}" target="_blank">详情</a>
								</td>
							</tr>
						</tbody>
					</table>
					<div class="operation">
						<div  class="m-btn-allChecked">
							<input type="checkbox"  id="checkbox_a1" ms-duplex-checked="@allchecked" 
                           data-duplex-changed="@checkAll" class="chk_1"/>
							<label for="checkbox_a1"></label>
						</div>
						<label clas="ml10">全选</label>
						<span class="inputBtn ml30" ms-click="@exportClick('');">导出转账汇款</span>
						<span class="inputBtn ml10" ms-click="@exportClick('all');">导出全部转账汇款</span>						
					</div>
				</div>
			</div>
		</section>
		<!-- /.content -->
		
		<div class="item_page pl30">
			<div class="l showpages">
	            <span class="l mr5">每页显示数量</span>
	            <div class="show_number_extrude l">
	            	<span class="spn">{{showList.list.pageSize}}</span><i class="icon-down"></i><i class="icon-upward dn"></i>
	                <div class="show_number_cont">
	                
	                    <ul>
	                     <li ms-for="item in [10,20,30,40,50]" :visible="showList.list.pageSize != item" ms-click="@onChangSizeClick(item)">
	                  		<a href="javascript:;">{{item}}</a>
	                     </li>
	                    </ul>
	                </div>
	        	</div>
			</div>
			<!-- 分页 -->
			<div id="pager" class="r">
				  <div id="kkpager"></div>
			</div>
			<input type="hidden" value="" id="total">
			<input type="hidden" value="" id="pageSize">
		</div>
	  </div>
	 
	   
	<script type="text/javascript">
		var selectCatid = "237,238";
	</script>
	<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->

<script src="${ctx}/js/lib/plupload-2.1.2/js/plupload.full.min.js"></script>
<script src="${ctx}/js/credenceUpload/credenceUpload.js?a=20170109"></script>
<script src="${ctx}/js/credenceUpload/oss_credence.js?b=20170100600"></script>
<script src="${ctx}/js/lib/jquery.validate.js"></script>
<script src="${ctx}/js/common/add.validate.js"></script>
<script src="${ctx}/js/app/orderList.js"></script>
</div>	    

</body>
</html>
