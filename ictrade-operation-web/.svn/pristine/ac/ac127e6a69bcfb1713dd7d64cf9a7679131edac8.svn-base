<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<!-- jQuery 1.11.3 -->
  <c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
  <title>订单列表</title>

 <style type="text/css">
 	.condition_inquery{background-color:#c11f2e;color:#fff;padding:10px 10px;font-size:14px;border-radius:3px;}
	.col_bt_time input{width:37%;}
  	.col_bt label,.col_bt_time label{text-align:right;}
  	.col_input_2{width:12%;}
  	.col_input_3{width:15%;}
  	.mt25{margin-top:25px;}
  	.table img{width: 32px;height: 32px;}
  	.ui-selectmenu-button.ui-button {width: 14%;margin: 0px;margin-top: -3px;height: 30px;line-height: 30px;}
  	#status-button{width: 16%;}
  	.content-wrapper .content-header .pitch_tab{border-top: 0px;}
  	.item_page .showpages {height: 120px;margin-bottom: 30px;}
  	
  	.up_skin_class .y_prompt_content {width: 330px;margin-top: 25px;}
  	.operation {margin-bottom: 20px;}
  	.w340{width: 340px;height: 100px;padding: 5px 10px;resize: none;}
  	
  	.table td a{padding-right: 0px;}
  	.lh25{line-height:25px;}
  	.titleClass span{display: inline-block;width: 100%;}
  	
  	.ms-controller{visibility: hidden;}
  	.col_bt{height:32px;}
  	.bred{border-color:#b1191a;}
  	.ui-widget.ui-widget-content{word-wrap: break-word;}
  	
  	.colc11{color:#C11F2E;}
 </style>
  <link rel="stylesheet" href="${ctx}/js/credenceUpload/credenceUpload.css?20161229" />
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

	<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->
	  
	  <!-- 右边内容显示 -->
	  <div class="content-wrapper ms-controller"  ms-controller=list>
		<!-- Content Header (Page header) -->
		<section class="content-header">
			<a href="#" class="header_tab pitch_tab">订单管理</a>
			<input type="hidden" id="orderId" value="237" />
		</section>
	    <!-- Main content -->
		<section class="content container-fluid">
			<div class="row mt20" ms-controller="search" id=searchFrom>
				<div class="col-xs-10"  style="border-right:1px solid #e2e2e2">
						<div class="col-xs-6 col_bt pl0 pr0 mb10">
							<label>订单编号：</label>						
							<input class="col_input_3" type="text" name="orderNumber" data-duplex="@parameter.orderNumber" ms-attr="{value:@parameter.orderNumber}" >
							<label class="ml5">状态：</label>						
							<select id="status" name="status" ms-duplex="@parameter.status">
								<option value="">全部</option>
								<option  ms-for="el in @statusSelected" ms-attr="{value:el.value}" >{{el.optionVal}}</option>
							</select>
							<label class="ml5">总价：</label>
							<input class="col_input_3" type="text" name="totalPriceBegin" data-duplex="@parameter.totalPriceBegin" ms-attr="{value:@parameter.totalPriceBegin}">
							<span class="ml5 mr5">-</span>
							<input class="col_input_3" type="text" name="totalPriceEnd" data-duplex="@parameter.totalPriceEnd" ms-attr="{value:@parameter.totalPriceEnd}">
						</div>
						<div class="col-xs-6 col_bt_time pr0 mb10">
							<label class="">创建时间：</label>
							<span class="rel">
								<input id="createDateBegin" name="createDateBegin" class="y_main_head_input ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.createDateBegin" ms-attr="{value:@parameter.createDateBegin}">
				                <span class="y_timer"><i class="cc1 icon-calendar"></i></span>
							</span>
							<span>至</span>
							<span class="rel">
				                <input id="createDateEnd" name="createDateEnd" class="y_main_head_input ml10 ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.createDateEnd" ms-attr="{value:@parameter.createDateEnd}">
				                  <span class="y_timer"><i class="cc2 icon-calendar"></i></span>
							</span>
							<span class="content_top_close" onclick="showDiv();"></span>
						</div>
						<div class="col-xs-6 col_bt pl0 pr0">
							<label>支付号：</label>
							<input class="col_input_2" type="text" name="paymentNo" data-duplex="@parameter.paymentNo" ms-attr="{value:@parameter.paymentNo}">
							<label>账号：</label>
							<input class="col_input_2" type="text" name="account" data-duplex="@parameter.account" ms-attr="{value:@parameter.account}">
							<label>支付平台：</label>
							<select id="payment" name="payment" ms-duplex="@parameter.payment" style="width: 12%;">
								<option value="">全部</option>
								<option  ms-for="el in @paymentSelected" ms-attr="{value:el.value}" >{{el.optionVal}}</option>
							</select>
							<label>币种：</label>						
							<select id="currency" name="currency" ms-duplex="@parameter.currency" style="width: 12%;">
								<option value="">全部</option>
								<option value="CNY">RMB</option>
								<option value="USD">USD</option>
							</select>
						</div>
						<div class="col-xs-6 col_bt_time pr0">
							<label class="">支付时间：</label>
							<span class="rel">
								<input id="paymentBegin" name="paymentBegin" class="y_main_head_input ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.paymentBegin" ms-attr="{value:@parameter.paymentBegin}">
				                <span class="y_timer"><i class="cc3 icon-calendar"></i></span>
							</span>
							<span>至</span>
							<span class="rel">
				                <input id="paymentEnd" name="paymentEnd" class="y_main_head_input ml10 ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.paymentEnd" ms-attr="{value:@parameter.paymentEnd}">
				                  <span class="y_timer"><i class="cc4 icon-calendar"></i></span>
							</span>
							<span class="content_top_close" onclick="showDiv();"></span>
						</div>
				</div>
				
				<div class="col-xs-2 mt25">
					<a href="javascript:;" class="condition_inquery" ms-click="@goSearch()">
						<span ><i class="icon-sousuo mr5"></i>查询</span>
					</a>
				</div>				
				
			</div>
			
			<!-- 表格 -->
			<div class="row mt20">
				<div class="col-xs-12" id="result_table">
					<table class="table">
						<thead>
							<tr>
								<th ms-if="@audited!=1" width="30px">
									<input type="checkbox"  id="checkbox_a1" ms-duplex-checked="@allchecked" 
                           data-duplex-changed="@checkAll" class="chk_1"/>
									<label for="checkbox_a1"></label>
								</th>
								<th width="50px">序号</th>
								<th width="11%">订单编号</th>
								<th width="11%">支付号</th> 
								<th width="10%">创建时间</th>
								<th width="10%">支付时间</th>
								<th width="9%">总价</th>
								<th width="8%">币种</th>
								<th width="14%">账号</th>
								<th width="8%">支付平台</th>
 								<th width="6%">状态</th>
								<th width="8%">转账凭证</th>
								<th width="8%">客户备注</th>
								<th width="100px">操作</th>
							</tr>
						</thead>
						<tbody >
							<tr :if="@isfirst || !@list.list.length" >
								<td colspan="14" style="padding:20px" id="loadingData" ms-html="@isLoading">数据加载中</td>
							</tr>
							<tr ms-for="($index, el) in @list.list">
								<td ms-if="@audited!=1">
									<input type="checkbox" ms-duplex-checked="el.checked" data-duplex-changed="@checkOne" ms-attr="{id:'checkbox_'+$index}"  class="chk_1"/>
									<label ms-attr="{for:'checkbox_'+$index}" ></label>
								</td>
								<td>{{$index + 1}}</td>
								<td ms-attr="{title:el.id}"><i :if="el.isInquiryOrder == '1'" class="f14 colc11 mr5">★</i>{{el.id}}</td>
								<td ms-attr="{title:el.orderPay.id}">{{el.orderPay.id}}</td>
								<td ms-attr="{title:el.orderDate}">{{@toHtml(el.orderDate)}}</td>
								<td ms-attr="{title:typeof(el.orderPay.createdDate) == 'undefined' ? '' : el.orderPay.createdDate}">{{@toHtml(el.orderPay.createdDate)}}</td>
								<td ms-attr="{title:el.orderPay.amount}">{{el.orderPay.amount|number(2)}}</td>
								<td :if="el.currency == 'CNY'" ms-attr="{title:'RMB'}" >RMB</td>
								<td :if="el.currency != 'CNY'" ms-attr="{title:el.currency}" >{{el.currency}}</td>
								<td ms-attr="{title:typeof(el.purchaserName) == 'undefined' ? '' : el.purchaserName}">{{@toHtml(el.purchaserName)}}</td>
								<td class="titleClass">
									<span ms-attr="{title:'支付宝'}" :if="el.orderPay.paymentMethodId == 'ALIPAY'">支付宝</span>
									<span ms-attr="{title:'银行汇款'}"  :if="el.orderPay.paymentMethodId == 'EXT_OFFLINE'">银行汇款</span>
									<span ms-attr="{title:'企业网银'}"  :if="el.orderPay.paymentMethodId == 'UNIONPAY_B2B'">企业网银</span>
									<span ms-attr="{title:'银联'}"  :if="el.orderPay.paymentMethodId == 'UNIONPAY_B2C'">银联</span>
									<span ms-attr="{title:'微信'}"  :if="el.orderPay.paymentMethodId == 'WECHATPAY'">微信</span>
									<span ms-attr="{title:'测试支付'}"  :if="el.orderPay.paymentMethodId == 'TEST'">测试支付</span></td>
									
								<td class="titleClass">
									<span ms-attr="{title:'未支付'}" :if="el.orderStatus == 'WAIT_PAID'">未支付</span>
									<span ms-attr="{title:'待审核'}" :if="el.orderStatus == 'WAIT_APPROVE'">待审核</span>
									<span ms-attr="{title:'审核不通过'}" :if="el.orderStatus == 'REJECTED'">审核不通过</span>
									<!-- <span :if="el.orderStatus == 'WAIT_RECEIVE'">待收货</span> -->
									<span ms-attr="{title:'待发货'}" :if="el.orderStatus == 'WAIT_SHIP'">待发货</span>
									<span ms-attr="{title:'已发货'}" :if="el.orderStatus == 'WAIT_RECEIVE'">已发货</span>
									<span ms-attr="{title:'交易完成'}" :if="el.orderStatus == 'COMPLETED'">交易完成</span>
									<span ms-attr="{title:'交易关闭'}" :if="el.orderStatus == 'CANCELLED'">交易关闭</span>
									<span ms-attr="{title:'平台确认失败'}" :if="el.orderStatus == 'PSENT_RT_FAIL'">平台确认失败</span>
									<span ms-attr="{title:'支付失败'}" :if="el.orderStatus == 'PAY_FAILED'">支付失败</span>
									<span ms-attr="{title:'支付失败'}" :if="el.orderStatus == 'REFUNDED'">已退款</span>
									<span ms-attr="{title:'平台确认中'}" :if="el.orderStatus == 'WAIT_CON_PSENT'">平台确认中</span>

								<td ms-attr="{}">
									<!-- 未支付 -->
									<span :if="(el.orderStatus == 'WAIT_PAID' && el.orderPay.paymentMethodId == 'EXT_OFFLINE')">
										<a class="cred_up_btn poi db lh25" ms-attr="{'data-index':$index,'data-isupload':0}" >上传凭证</a></span>
									<!-- 平台确认中  -->
									<!-- 平台确认成功：待发货 、交易成功、交易失败： 如果上传了凭证，才显示 -->
									<span :if="(el.orderStatus != 'WAIT_PAID' && el.orderStatus != 'CANCELLED' && el.orderPay.paymentMethodId == 'EXT_OFFLINE') ">
										<a  class="cred_up_btn poi db lh25" ms-attr="{'data-index':$index,'data-isupload':1}">查看凭证</a></span>
									<!-- 平台确认失败 -->
									<span :if="el.orderStatus == 'PSENT_RT_FAIL'">
										<a class="cred_up_btn poi db lh25" ms-attr="{'data-index':$index,'data-isupload':-1}">重新上传</a></span></td>
									
								<td ms-attr="{title:el.orderNote.noteInfo}">{{@toHtml(el.orderNote.noteInfo)}}</td>
								<td>
									<span :if="el.orderStatus == 'WAIT_CON_PSENT'" >
										<a class="db lh25" href="javascript:;" ms-click="@auditClick(el, $event,el.orderPay.id,true)">收款成功</a>
										<a class="db lh25" href="javascript:;" ms-click="@auditClick(el, $event,el.orderPay.id,false)">收款失败</a>
									</span>
									<a class="db lh25" ms-attr="{href:'${ctx}/order.htm?action=detail&id='+el.id}" target="_blank">详情</a>
								</td>
							</tr>
						</tbody>
					</table>
					<div class="operation">
						<div style="width: 32px;" class="tc l">
							<input type="checkbox"  id="checkbox_a1" ms-duplex-checked="@allchecked" 
                           data-duplex-changed="@checkAll" class="chk_1"/>
							<label for="checkbox_a1"></label>
						</div>
						<label clas="ml10">全选</label>
						<span class="inputBtn ml30" ms-click="@exportClick('');">导出转账汇款</span>
						<span class="inputBtn ml10" ms-click="@exportClick('all');">导出全部转账汇款</span>
						<!-- <span class="inputBtn ml10">导出对账单</span>
						<span class="inputBtn ml10">导出全部对账单</span> -->
					</div>
				</div>
			</div>
		</section>
		<!-- /.content -->
		
		<div class="item_page pl30">
			<div class="l showpages">
	            <span class="l mr5">每页显示数量</span>
	            <div class="show_number_extrude l">
	            	<span class="spn">{{showList.list.pageSize}}</span><i class="icon-down"></i><i class="icon-upward dn"></i>
	                <div class="show_number_cont">
	                    <ul>
	                        <li ms-if="showList.list.pageSize != '10'" onclick="changeSize(10);"><a href="javascript:;">10</a></li>
	                        <li ms-if="showList.list.pageSize != '20'" onclick="changeSize(20);"><a href="javascript:;">20</a></li>
	                        <li ms-if="showList.list.pageSize != '30'" onclick="changeSize(30);"><a href="javascript:;">30</a></li>
	                        <li ms-if="showList.list.pageSize != '40'" onclick="changeSize(40);"><a href="javascript:;">40</a></li>
	                        <li ms-if="showList.list.pageSize != '50'" onclick="changeSize(50);"><a href="javascript:;">50</a></li>
	                    </ul>
	                </div>
	        	</div>
			</div>
			<!-- 分页 -->
			<div id="pager" class="r">
				  <div id="kkpager"></div>
			</div>
			<input type="hidden" value="" id="total">
			<input type="hidden" value="" id="pageSize">
		</div>
	  </div>
	 
	   
	<script type="text/javascript">
		var selectCatid = "237,238";
	</script>
	<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->

<script src="${ctx}/js/lib/plupload-2.1.2/js/plupload.full.min.js"></script>
<script src="${ctx}/js/credenceUpload/credenceUpload.js?a=20170109"></script>
<script src="${ctx}/js/credenceUpload/oss_credence.js?b=20170100600"></script>
<script src="${ctx}/js/lib/jquery.validate.js"></script>
<script src="${ctx}/js/common/add.validate.js"></script>

</div>	    
	<script type="text/javascript">
		function desLen(){
			var val = $("#description")[0].value;
			$('#des')[0].innerHTML= val.length+'/100';
		}
		
	    function changeSize(count){
	    	showList.list.pageSize = count;
	    	showList.list.pageNum = 1;
	    	$(".condition_inquery")[0].click();
	    }
	    
	    /* search */
	    
	    var getParameters = function(){
        	var arr = ["orderNumber","status","payment","totalPriceBegin","totalPriceEnd","createDateBegin","createDateEnd",
        	           "account","paymentNo","currency","paymentBegin","paymentEnd"],
    		par ={};
    	
	    	for(var i=0; i< arr.length; i++){
	    		par[arr[i]] = decodeURI(getQueryString(arr[i]));
	    	}
	    	return par;
	    }
	    
	    var search = avalon.define({
	        $id: "search",
	        parameter: getParameters(),
	        goSearch:function(){
	        	var wrap = $("#searchFrom");
	        	var inputList = wrap.find("input"),
	        		selectList = wrap.find("select"),
	        		parStr = "?",
	        		par = getQueryString("type"),
	        		parObj = {};
	        	
	        	if(par)
	        		parObj["type"] = par;
	        	
	        	function toUrl(pArr){
	        		for(var k in pArr){
	        			console.log(k)
	        			parStr += k + "=" + pArr[k] +"&";
	        		}
	        	}
	        	$.each(inputList,function(i,input){
	        		var val = input.value;
	        		if(val !== ""){
	        			parObj[input.name] = encodeURI($.trim(input.value));
	        		}
	        	})
	        	console.log(selectList)
	        	$.each(selectList,function(i,select){
	        		var val = "",
	        			selectObj = $(select,"option:selected");
	        		console.log(selectObj.val());
	        		if(selectObj.val()){
	        			parObj[select.name] = select.value;	        			
	        		}
	        	})
	        	
	        	toUrl(parObj);
	        	parStr = parStr.substring(0,parStr.length-1);
	        	
	         	var str = "?"
	        	if(parStr != ""){
	        		str = "&"
	        	}
				
	        	window.location.href=window.location.pathname+parStr+str+"page=1&size="+showList.list.pageSize;//"+showList.list.pageNum+"
	        	
	        }
	    })
	
	 
	 var showList = avalon.define({
 	    $id: "list",
 	    list: [],
 	    toHtml: function(data){
			if(data=='undefined' || !data){
				return "--";
			}else{
				return data;
			}
		},
 	    paymentSelected: [{
				"value": ykyStatus.paymentStatus.WECHATPAY,
				"optionVal": "微信支付"
			},{
				"value": ykyStatus.paymentStatus.ALIPAY,
				"optionVal": "支付宝"
			},{
				"value": ykyStatus.paymentStatus.UNIONPAY_B2B,
				"optionVal": "在线支付（企业）"   //"企业网银支付"
			},{
				"value": ykyStatus.paymentStatus.UNIONPAY_B2C,
				"optionVal": "在线支付"   //"银联支付"
			},{
				"value": ykyStatus.paymentStatus.EXT_OFFLINE,
				"optionVal": "银行汇款"
			}],
		statusSelected: [{
				"value": ykyStatus.status.WAIT_PAID,
				"optionVal": "未支付"
			},{
				"value": ykyStatus.status.WAIT_APPROVE,
				"optionVal": "待审核"
			},{
				"value": ykyStatus.status.WAIT_SHIP,
				"optionVal": "待发货"
			},{
				"value": ykyStatus.status.WAIT_RECEIVE,
				"optionVal": "已发货"
			},{
				"value": ykyStatus.status.WAIT_CON_PSENT,
				"optionVal": "平台确认中"
			},{
				"value": ykyStatus.status.PSENT_RT_FAIL,
				"optionVal": "平台确认失败"
			},{
				"value": ykyStatus.status.PAY_FAILED,
				"optionVal": "支付失败"
			},{
				"value": ykyStatus.status.COMPLETED,
				"optionVal": "交易完成"
			},{
				"value": ykyStatus.status.CANCELLED,
				"optionVal": "交易关闭"
			},{
                "value": ykyStatus.status.REFUNDED,
                "optionVal": "已退款"
            }],
 	   	isLoading:"数据加载中...",
 	   	isfirst:true,
 	    allchecked: false,
 	   	audited:getQueryString("type"),
        checkAll: function (e) {
           var checked = e.target.checked;
           showList.list.list.forEach(function (el) {
               el.checked = checked;
           })
        },
        checkOne: function (e) {
           var checked = e.target.checked
           if (checked === false) {
        	   showList.allchecked = false
           } else {//avalon已经为数组添加了ecma262v5的一些新方法
        	   showList.allchecked = showList.list.list.every(function (el) {
                   return el.checked
               })
           }
        },
 	    auditClick:function(el,e,id,flag){
 	    	var _this = this,
 	    	auditType = 1;
 	    	var _html = "<img class='y_prompt_box'  src='${ctx}/js/lib/layer/skin/default/y_warning.png' />"+
 	    				"<div class='y_prompt_content' ><span class='sp1'>确认收到汇款吗？</span>"+
 	    				"<span>请确认财务部已经收到相应转账汇款再进行本操作</span></div>";
 	    	var _title = " ";
 	    	
 	    	if(!flag){
 	    		_html = "<div class='y_prompt_content_des' >"+
		 	    		"<span class='l'>异常原因：</span>"+
		 	    		"<textarea type='text' class='w340' id='description' name='description'  maxlength='100' onkeyup='desLen();' onblur='validateVal()'></textarea>"+
		 	    		"<span id='des' class='ml10'>0/100</span></div>";
 	    		_title = "汇款异常";
 	    	}
 	    	var l = layer.confirm(_html, {
				offset: "auto",
				btn: ['确      认', '取      消'], //按钮
				title: _title,
				area: ['550px', '280px'],
				move: false,
				skin: "up_skin_class",
				yes:function(){
					var result = 1;
					if($("#des")[0]){   //如果存在输入框
						result = 0;
						if($("#description").val() == ""){
							$("#description").addClass('bred');
							return;
						}
					}
					var reason = "1";
	 	  	    	var des = $("#des")[0];
	 	  	    	if(des){   //如果存在输入框
	 	  	    		reason = $("#description").val();
					}
					$.aAjax({
						//url: ykyUrl.transaction+"/v1/orders/"+id+"/status",+ statusId
						url:  ykyUrl.pay + "/v1/payment?paymentPreferenceId="+id+"&result="+result+"&reason="+reason,
						type:"PUT",
			 	  	    success: function(data){
			 	  	    	/* 	var reason = "1";
			 	  	    	var des = $("#des")[0];
			 	  	    	if(des){   //如果存在输入框
			 	  	    		reason = $("#description").val();
							}
		 	  	    		$.aAjax({
								url: ykyUrl.transaction + "/v1/notifies/payment/results?orderPaymentId="+data.paymentPreferenceId+"&paymentStatus="+data.statusId+"&reason="+reason,
								type:"POST",
					 	  	    success: function(data) {
					 	  	    	layer.close(l);
					 	  	    	location.reload()
					 	  	    },
					 	  	    error:function(){
					 	  	    	layer.closeAll('loading');
					 	  	    	layer.alert('系统错误，审批失败，请联系系统管理员',{skin: "up_skin_class",area: ['300px', '210px']});
					 	  	    }
							}); */
			 	  	    	layer.close(l);
			 	  	    	location.reload()
			 	  	    },
			 	  	    error:function(e){
			 	  	    	layer.closeAll('loading');
			 	  	    	console.log("系统错误，审批失败，请联系系统管理员："+e);
			 	  	    	//layer.alert('系统错误，审批失败，请联系系统管理员',{skin: "up_skin_class",area: ['300px', '210px']});
			 	  	    }
					});
				}
			})
 	    },
        exportClick:function(status){
        	var flag = false;
	    	var idList="";	    	
	    	showList.list.list.forEach(function (el) {
	           if(el.checked || status != ""){
	        	   if(el.orderStatus == "WAIT_CON_PSENT"){	        		   
		        	   idList+=el.id+","
	        	   }else{
	        		   flag =  true;
	        	   }
	           }
	        })
	    	idList = idList.slice(0,-1);
	    	
	    	var _html = "";
	    	
	    	if(idList=="" && status == ""){
	    		if(flag){
	    			_html = "选择项中包含非银行汇款类型订单，请重新选择";
	    		}else{	    			
		    		_html = "请选择需要导出的订单";
	    		}
	    	}else if(flag){	    		
    			_html = "选择项中包含非银行汇款类型订单，请重新选择";
	    	}
	    	
	    	if((idList=="") || flag){
	    		 layer.alert(_html,{
		    		offset: "auto",
					btn: false, //按钮
					title: " ",
					area: ['350px', '150px'],
					move: false,
					skin: "up_skin_class"
		    	})
		    	//layer.msg("请检查数据，存在不能导出的数据");
		    	 
	    		return false;
	    	}
	    	
	    	var tempData = "";
	    	
			if(status == "all"){  // 导出全部转账汇款
				var d = window.location.search
				if(d != ""){
					tempData = "?"+d.split("?")[1];
				}
        	}else{
        		tempData = "?ids="+idList;
        	}
	    	
			window.location.href = ykyUrl.transaction+"/v1/bills" + tempData;
			
	    }
 	})

 	var queryPage = 0,querySize = 0;
 	if(!showList.list.pageNum){
 		queryPage = 1;
 	}else{
 		queryPage = showList.list.pageNum
 	}
 	if(!showList.list.pageSize){
 		querySize = 10;
 	}else{
 		querySize = showList.list.pageSize;
 	}
 	
 	var queryPage = getQueryString("page"),
 	querySize = getQueryString("size"),
	listPage = queryPage ? queryPage : 1,
	listSize = querySize ? querySize : 10;
 	
	listUrl = ykyUrl.transaction+"/v1/orders/search";
 	 
	var tempData = "";
	if(window.location.search.indexOf("?") != -1){
		tempData = "?"+window.location.search.split("?")[1];
	}else{
		tempData = "?page="+listPage+"&size="+listSize;
	}
	/* 请求商品列表数据 */
 	 $.aAjax({
	     url: listUrl+tempData,
	     type:"GET",
	     success: function(data) {
	    	 //var ck = {checked: false};
	    	 for(var i = 0; i< data.list.length; i++){
	    		 data.list[i].checked = false;
	    	 }
	    	 if( data.list.length == 0)
		    	 	showList.isLoading = "暂无数据";
	    	 
	    	 showList.list=data;
	    	 showList.isfirst = false;
	    	 
	    	 setPageOption(data);
	    	 loadPage(window.location.pathname+GetRequestWithout(window.location.search,"page"));
	    	 
	     },
	     error:function(e){
  	    	layer.closeAll('loading');
	  	    console.log("系统错误，审批失败，请联系系统管理员："+e);
		}
	})
	
	//收款失败，输入框必填
  	function validateVal(){
  		if($("#description").val() == ""){
  			$("#description").addClass('bred');
  		}else{
  			$("#description").removeClass('bred');
  		}
  	}
	 
</script>


<script type="text/javascript">
  	$(function(){
  		  			
  		//日期控件
  		var start = {
			elem: '#createDateBegin',
			format: 'YYYY-MM-DD hh:mm:ss',
			// min: laydate.now(),    //设定最小日期为当前日期
			istime: true, //是否显示时间
			istoday: false,
			isclear: false, //是否显示清空
			//选择好日期的回调
			choose: function(dates) {
				$(this.elem).trigger("blur");
				var startTime = $('#createDateBegin').val();
				var endTime = $('#createDateEnd').val();
				var arr1 = startTime.split('-');
				var sdate = new Date(arr1[0], parseInt(arr1[1] - 1), arr1[2]);
				var arr2 = endTime.split('-');
				var edate = new Date(arr2[0], parseInt(arr2[1] - 1), arr2[2]);
				if(sdate > edate) {
					layer.tips('开始时间不能大于结束时间', '#createDateEnd', {
						tips: 1,
						time: 1000,
					});
					$('#createDateBegin').val('');
				};
			}
		};
		var end = {
			elem: '#createDateEnd',
			format: 'YYYY-MM-DD hh:mm:ss',
			// min: laydate.now(),    //设定最小日期为当前日期
			istime: true, //是否显示时间
			istoday: false,
			isclear: false, //是否显示清空
			//选择好日期的回调
			choose: function(dates) {
				$(this.elem).trigger("blur");
				var startTime = $('#createDateBegin').val();
				var endTime = $('#createDateEnd').val();
				var arr1 = startTime.split('-');
				var sdate = new Date(arr1[0], parseInt(arr1[1] - 1), arr1[2]);
				var arr2 = endTime.split('-');
				var edate = new Date(arr2[0], parseInt(arr2[1] - 1), arr2[2]);
				if(sdate > edate) {
					layer.tips('开始时间不能大于结束时间', '#createDateEnd', {
						tips: 1,
						time: 1000,
					});
					$('#createDateEnd').val('');
				};
			}
		};
  		$("#createDateBegin").on("click", function() {
			laydate(start);
		});
		$(".cc1").on("click", function() {
			laydate(start);
		});
		$("#createDateEnd").on("click", function() {
			laydate(end);
		});
		$(".cc2").on("click", function() {
			laydate(end);
		});
		
		var start2 = {
				elem: '#paymentBegin',
				format: 'YYYY-MM-DD hh:mm:ss',
				// min: laydate.now(),    //设定最小日期为当前日期
				istime: true, //是否显示时间
				istoday: false,
				isclear: false, //是否显示清空
				//选择好日期的回调
				choose: function(dates) {
					$(this.elem).trigger("blur");
					var startTime = $('#paymentBegin').val();
					var endTime = $('#createDateEnd').val();
					var arr1 = startTime.split('-');
					var sdate = new Date(arr1[0], parseInt(arr1[1] - 1), arr1[2]);
					var arr2 = endTime.split('-');
					var edate = new Date(arr2[0], parseInt(arr2[1] - 1), arr2[2]);
					if(sdate > edate) {
						layer.tips('开始时间不能大于结束时间', '#createDateEnd', {
							tips: 1,
							time: 1000,
						});
						$('#paymentBegin').val('');
					};
				}
			};
			var end2 = {
				elem: '#paymentEnd',
				format: 'YYYY-MM-DD hh:mm:ss',
				// min: laydate.now(),    //设定最小日期为当前日期
				istime: true, //是否显示时间
				istoday: false,
				isclear: false, //是否显示清空
				//选择好日期的回调
				choose: function(dates) {
					$(this.elem).trigger("blur");
					var startTime = $('#paymentBegin').val();
					var endTime = $('#paymentEnd').val();
					var arr1 = startTime.split('-');
					var sdate = new Date(arr1[0], parseInt(arr1[1] - 1), arr1[2]);
					var arr2 = endTime.split('-');
					var edate = new Date(arr2[0], parseInt(arr2[1] - 1), arr2[2]);
					if(sdate > edate) {
						layer.tips('开始时间不能大于结束时间', '#paymentEnd', {
							tips: 1,
							time: 1000,
						});
						$('#paymentEnd').val('');
					};
				}
			};
	  		$("#paymentBegin").on("click", function() {
				laydate(start2);
			});
			$(".cc3").on("click", function() {
				laydate(start2);
			});
			$("#paymentEnd").on("click", function() {
				laydate(end2);
			});
			$(".cc4").on("click", function() {
				laydate(end2);
			});
  		
  		$("#payment").selectmenu()
  		.selectmenu( "menuWidget" )
  	    .addClass( "overflow" );
  		
  		$("#status").selectmenu()
  		.selectmenu( "menuWidget" )
  	    .addClass( "overflow" );
  		
  		$("#currency").selectmenu()
  		.selectmenu( "menuWidget" )
  	    .addClass( "overflow" );
  		
  	});
  	
</script>

</body>
</html>
