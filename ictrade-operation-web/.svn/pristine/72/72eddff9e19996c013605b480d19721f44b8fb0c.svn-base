


var vm = new Vue({
	el: '#vendorManageList',
	data: {
		loseDescribe: '',
		url: ykyUrl.party+'/v1/vendorManage/getVendorManageList',
		queryParams : { //请求接口参数 
			size : 10, //分页参数
			page : 1, //当前页
			defaultStatus : true //监测参数变化标识
		},
		gridColumns : [{
			key : 'partyCode',
			name : '供应商编码',
			default : '-',
			cutstring: true,	//字符串太长只显示前4个
		},{
			key : 'groupName',
			name : '供应商名称',
			default : '-',
			cutstring: true 
		},{
			key : 'category',
			name : '分类',
			default : '-',
			cutstring: true
		},{
			key : 'region',
			name : '所在地区',
			default : '-',
			cutstring: true
		},{
			key : 'isCore',
			name : '核心供应商',
			width: '80px',
			text : {
				Y : {
					'value': '是'
				},
				N : {
					'value': '否'
				}
			}
		},{
			key : 'payType',
			name : '付款方式',
			default : '-',
			cutstring: true
		},{
			key : 'enquiryName',
			name : '询价员',
			default : '-',
			cutstring: true
		},{
			key : 'creater',
			name : '创建人',
			default : '-',
			cutstring: true
		},{
			key : 'status',
			name : '状态',
			width: '80px',
			text : {
				PARTY_ENABLED : {
					'value': '启用'
				},
				PARTY_DISABLED : {
					'value': '停用'
				}
			}	
		},{
			key : 'createDate',
			name : '创建时间',
			default : '-',
			cutstring: true
		},{
			key : 'operate',
			align : 'center',
			name : '操作',
			items: [{
				className : 'btn-detail ml5',
				show : true,
				text : '详情',
				href : ykyUrl._this + '/vendor/detail.htm?partyId='+ '{partyId}'
			},{
				className : 'btn-detail ml5',
				show : true,
				text : '编辑',
				href : ykyUrl._this + '/vendor/edit.htm?partyId='+ '{partyId}'
			},{
				className : 'btn-detail ml5',
				show : "'{status}' === 'PARTY_DISABLED'",
				text : '启用',
				callback: {
					action : 'startStatus',
					params : [ '{partyId}','PARTY_ENABLED']
				}
			},{
				className : 'btn-detail ml5',
				show : "'{status}' === 'PARTY_ENABLED'",
				text : '失效',
				callback: {
					action : 'loseStatus',
					params : [ '{partyId}','PARTY_DISABLED']
				}
			}]
		}],
		pageflag : true, //是否显示分页
		refresh : false, //重载
		
		formData:{
			id:'formId',
			columnCount:3,
			fields: [
				{
	                "keyname": "供应商编码",
	                "type": "text",
	                "key": "partyCode", 
	                "name": "partyCode"
	          }, {
	                "keyname": "供应商名称",
	                "type": "text",
	                "key": "groupName", 
	                "name": "groupName"
	          }, {
	                "keyname": "核心供应商",
	                "type": "select",
	                "key": "isCore",
	                "name": "isCore",
	                "optionId":"value",        //控件option的value对应的接口字段
	                "optionName":"text",    //控件option的Text对应的接口字段,
	                "options": [
						{
						    "value": "",
						    "text": "全部"
						},       
	                    {
	                        "value": "Y",
	                        "text": "是"
	                    },
	                    {
	                        "value": "N",
	                        "text": "否"
	                    }
	                ]
	            },{
	                "keyname": "所在地区",
	                "type": "select",
	                "key": "region",
	                "name": "region",
	                "inputClass":"",
	                "optionId":"categoryId",        //控件option的value对应的接口字段
	                "optionName":"categoryName",    //控件option的Text对应的接口字段,
	                "url": ykyUrl.database+"/v1/category/companylist?categoryTypeId=VENDOR_THE_REGION", //接口
	                "attr":{
	                	"placeholder":'全部'
	                }
	           },{
	                "keyname": "分类",
	                "type": "select",
	                "key": "category",
	                "name": "category",
	                "inputClass":"",
	                "optionId":"categoryId",        //控件option的value对应的接口字段
	                "optionName":"categoryName",    //控件option的Text对应的接口字段,
	                "url": ykyUrl.database+"/v1/category/companylist?categoryTypeId=VENDOR_THE_TYPE", //接口
	                "attr":{
	                	"placeholder":'全部'
	                }
	           },{
	                "keyname": "付款方式",
	                "type": "text",
	                "key": "payType", 
	                "name": "payType"
	            },{
	                "keyname": "询价员",
	                "type": "text",
	                "key": "enquiryName", 
	                "name": "enquiryName"
	            },{
                    "keyname": "日期区间",
                    "type": "daterange",        //时间区间类型
                    "startkey": "beginTime",  //star id
                    "endkey": "endTime",        //end id
                    "startname": "beginTime",    //star name
                    "endname": "endTime"         //end name
                },{
	                "keyname": "创建人",
	                "type": "text",
	                "key": "creater", 
	                "name": "creater"
	            }        
		],
		buttons:[
			{
                "text": '查询',
                "type": 'button',
                "id": '',
                "name": '',
                "inputClass": 'btn btn-danger',
            	"callback": {
                    action: 'on-search',        //方法名
                }
            }
		]
	}
	},
	methods: {
		//搜索方法
		searchData: function(searchParam){		
			var queryParams = this.queryParams
            queryParams.pageSize = 10
            queryParams.page = 1
            queryParams.defaultStatus = !queryParams.defaultStatus

            for (var key in searchParam) {
                queryParams[key] = searchParam[key] ? searchParam[key] : undefined
            }
		},
	}
})

function loseStatus(index,params){
	console.log(index,params);
	
	layer.open({
		type: 1,
		title: '确认提交',
		area: '500px',
		offset: '300px',
		move: false,
		skin: "s_select_data",
		content: $('.lose-describe'),
		btn: ['确定', '取消'],
		yes: function(i, layero) {
			if(!_this.creditDescribe){
				layer.msg('失效原因不能为空');
				return false;
			}
			
			if(_this.creditDescribe.length > 100){
				layer.msg('失效原因长度不能超过100个字符');
				return false;
			}
			postData.describe = _this.creditDescribe;
			syncData(ykyUrl.party + "/v1/vendorManage/startOrLose?partyId="+params[0]+"&startOrLose=LOSE&describe="+vm.loseDescribe, 'POST', null, function(res, err) {
				if (!err) {
					layer.msg('信用信息提交成功！')
				}
			});
			layer.close(i);
		},
		cancel: function(i, layero) {
		}
	})
}

function init(){
	//创建时间
	$('#registerDate .input-daterange').datepicker({
	    format: config.dateFormat,
	    autoclose: true
	});
}

init();
