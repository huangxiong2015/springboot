<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>审核管理</title>
  
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  
  <link rel="stylesheet" href="../../css/lib/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../js/lib/jquery-ui-1.20.0/jquery-ui.css"></link>
  <link rel="stylesheet" type="text/css" href="../../css/lib/kkpager_red.css" />
  <link rel="stylesheet" href="../../css/common/common.css">
  
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  
  <style type="text/css">
 	.condition_inquery{background-color:#c11f2e;color:#fff;padding:10px 10px;font-size:14px;border-radius:3px;}
	.col_bt_time input{width:37%;}
  	.col_bt label,.col_bt_time label{width: 60px;text-align:right;}
  	.col_input_1{width:76%;}
  	.mt25{margin-top:25px;}
  	.ui-selectmenu-button.ui-button {width: 72%;margin: 0px;}
  	.content-wrapper .content-header .pitch_tab{border-top: 0px;}
 </style>
</head>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
  <!-- 首部导航 -->
  <header class="main-header">
    <!-- Logo -->
    <a href="#" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><b>YKY</b></span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>YKY</b><p>运营管理后台</p></span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <a href="#" class="icon-switch" data-toggle="offcanvas" role="button"></a>
      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
          <li class="dropdown">
              <span>欢迎您,11222231</span>
          </li>       
          <li class="dropdown"> 
              <a href="#" class="rel"><i class="icon-out f16"></i>退出</a>
		  </li>  
        </ul>
      </div>
    </nav>
  </header>
  
  
  <!-- 左边导航  -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
		<li>
			<a href="#">
				<i class="fa icon-home"></i> <span>首<span style="margin-left:24px;">页</span></span>
			</a>
		</li>
		<li class="treeview">
			<a href="#">
				<i class="fa icon-vip"></i> <span class="first-menu">会员管理</span><i class="fa fa-angle-left pull-right"></i>
			</a>
			<ul class="treeview-menu">
				<li><a href="#">注册用户</a></li>
				<li><a href="#">初级会员</a></li>
				<li><a href="#">认证会员</a></li>
			</ul>
		</li>
		<li class="treeview">
			<a href="#">
				<i class="fa icon-audit"></i> <span class="first-menu">审核管理</span><i class="fa fa-angle-left pull-right"></i>
			</a>
			<ul class="treeview-menu">
				<li><a href="#">认证会员管理</a></li>
				<li><a href="#">初级会员审核</a></li>
				<li><a href="#">公司名称变更审核</a></li>
			</ul>				
		</li>
		<li class="treeview pitch-on active">
			<a href="#">
				<i class="fa icon-commodity"></i> <span class="first-menu">商品管理</span><i class="fa fa-angle-left pull-right"></i>
			</a>
			<ul class="treeview-menu">
				<li class="selected"><a href="#">商品管理</a></li>
				<li><a href="#">商品运营</a></li>
				<li><a href="#">库存管理</a></li>
			</ul>			
		</li>
		<li class="treeview">
			<a href="#">
				<i class="fa icon-deal"></i> <span class="first-menu">交易管理</span><i class="fa fa-angle-left pull-right"></i>
			</a>
			<ul class="treeview-menu">
				<li><a href="#">库存管理</a></li>
				<li><a href="#">采购需求管理</a></li>
				<li><a href="#">询报价管理</a></li>
			</ul>
		</li>
		<li class="treeview">
			<a href="#">
				<i class="fa icon-dingdan"></i> <span class="first-menu">订单管理</span><i class="fa fa-angle-left pull-right"></i>
			</a>
			<ul class="treeview-menu">
				<li><a href="#">订单管理</a></li>
			</ul>
		</li>	
		<li class="treeview">
			<a href="#">
				<i class="fa icon-operation"></i> <span class="first-menu">运营管理</span><i class="fa fa-angle-left pull-right"></i>
			</a>
			<ul class="treeview-menu">
				<li><a href="#">广告咨询管理</a></li>
				<li><a href="#">招聘管理</a></li>
				<li><a href="#">帮助中心管理</a></li>
				<li><a href="#">意见反馈管理</a></li>
				<li><a href="#">分类目录管理</a></li>
			</ul>
		</li>	
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  
	<!-- 右边内容显示 -->
	  <div class="content-wrapper ms-controller"  ms-controller=list>
		<!-- Content Header (Page header) -->
		<section class="content-header">
			<a href="#" class="header_tab pitch_tab">企业账号审核</a>
		</section>
	    <!-- Main content -->
		<section class="content container-fluid">
			<div class="row mt20" ms-controller="search" id=searchFrom>
				<div class="col-xs-10"  style="border-right:1px solid #e2e2e2">
						<div class="col-xs-4 col_bt pl0 pr0 mb10">
							<label>邮箱：</label>						
							<input class="col_input_1" type="text" name="id" data-duplex="@parameter.id" ms-attr="{value:@parameter.id}" >
						</div>
						<div class="col-xs-4 col_bt pr0 mb10">	
							<label>公司名称：</label>						
							<input class="col_input_1" type="text" name="brand" data-duplex="@parameter.brand" ms-attr="{value:@parameter.brand}">
						</div>	
						<div class="col-xs-4 col_bt pr0 mb10">
							<label >状态：</label>
							<select id="city" name="city" ms-duplex="@secondSelected2">
								<option value="">全部</option>
								<option value="">通过</option>
								<option value="">驳回</option>
								<option value="">待审核</option>	
							</select>
						</div>
						<div class="col-xs-6 col_bt_time pr0 pl0 mb10">
							<label class="">申请时间：</label>
							<span class="rel">
								<input id="beginTime" name="beginDateStr" class="y_main_head_input ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.beginDateStr" ms-attr="{value:@parameter.beginDateStr}">
				                <span class="y_timer"><i class="cc1 icon-calendar"></i></span>
							</span>
							<span>至</span>
							<span class="rel">
				                <input id="endTime" name="endDateStr" class="y_main_head_input ml10 ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.endDateStr" ms-attr="{value:@parameter.endDateStr}">
				                  <span class="y_timer"><i class="cc2 icon-calendar"></i></span>
							</span>
							<span class="content_top_close" onclick="showDiv();"></span>								
						</div>
						<div class="col-xs-6 col_bt_time pr0">
							<label class="">审核时间：</label>
							<span class="rel">
								<input id="beginTime" name="beginDateStr" class="y_main_head_input ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.beginDateStr" ms-attr="{value:@parameter.beginDateStr}">
				                <span class="y_timer"><i class="cc1 icon-calendar"></i></span>
							</span>
							<span>至</span>
							<span class="rel">
				                <input id="endTime" name="endDateStr" class="y_main_head_input ml10 ovh" style="padding-right:46px;" type="text" data-duplex="@parameter.endDateStr" ms-attr="{value:@parameter.endDateStr}">
				                  <span class="y_timer"><i class="cc2 icon-calendar"></i></span>
							</span>
							<span class="content_top_close" onclick="showDiv();"></span>								
						</div>
				</div>
				
				<div class="col-xs-2 mt25">
					<a href="javascript:;" class="condition_inquery" ms-click="@goSearch()">
						<span ><i class="icon-sousuo mr5"></i>查询</span>
					</a>
				</div>				
				
			</div>
			
			<!-- 表格 -->
			<div class="row mt20">
				<div class="col-xs-12" id="result_table">
					<table class="table mb10">
						<thead>
							<tr>
								<th width="50px">序号</th>
								<th width="9%">公司名称</th>
								<th width="9%">公司类型</th>
								<th width="15%">公司联系人</th>
								<th width="15%">联系电话</th> 
								<th width="8%">状态</th>
								<th width="6%">申请时间</th>
								<th width="6%">审核时间</th>
								<th width="100px">操作</th>
							</tr>
						</thead>
						<tbody >
							<tr :if="@isfirst || !@list.list.length" class="dn">
								<td colspan="9" style="padding:20px" id="loadingData" ms-html="@isLoading">数据加载中</td>
							</tr>
							<tr>
								<td>1</td>
								<td>易库易有限公司</td>
								<td>互联网</td>
								<td>易库易</td>
								<td>075512345678</td>
								<td>状态</td>
								<td>2017-1-11</td>
								<td>2017-1-13</td>
								<td>
									<!-- <a ms-attr="{href:'${ctx}/goods.htm?action=detail&id='+el.id}" target="_blank">详情</a> -->
									<a href="./enterpriseDetails.html">审核</a>
									<a href="./enterpriseDetails.html">详情</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</section>
		<!-- /.content -->
		
		<div class="item_page pl30">
			<div class="l showpages">
	            <span class="l mr5">每页显示数量</span>
	            <div class="show_number_extrude l">
	            	<span class="spn">20</span><i class="icon-down"></i><i class="icon-upward dn"></i>
	                <div class="show_number_cont">
	                    <ul>
	                        <li><a href="javascript:;" onclick="changeSize(10);">10</a></li>
	                        <li><a href="javascript:;" onclick="changeSize(50);">50</a></li>
	                        <li><a href="javascript:;" onclick="changeSize(100);">100</a></li>
	                    </ul>
	                </div>
	        	</div>
			</div>
			<!-- 分页 -->
			<div id="pager" class="r">
				  <div id="kkpager"></div>
			</div>
			<input type="hidden" value="" id="total">
			<input type="hidden" value="" id="pageSize">
		</div>		
	  </div>
</div>
<!-- ./wrapper -->


<script src="../../js/lib/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="../../js/lib/avalon/avalon.js"></script>
<script type="text/javascript">

	var ykyUrl = {
		main : 'http://localhost:8080/ictrade-main-web',
		admin : 'http://localhost:8080/ictrade-admin-web',
		quotation : 'http://192.168.1.253:9093',
		_this : 'http://localhost:8080/ictrade-operation-web'
	};
	
</script>
<script src="../../js/common/common.js"></script>
<script src="../../js/lib/jquery-ui-1.20.0/jquery-ui.js"></script>
<script src="../../js/lib/bootstrap.min.js"></script>
<script src="../../js/common/app.min.js"></script>
<script src="../../js/component/leftMenu.js"></script>
<script type="text/javascript" src="../../js/lib/laydate/laydate.js"></script>

<script type="text/javascript" src="../../js/lib/kkpager_test.js"></script>
<script type="text/javascript" src="../../js/common/ykypage.js"></script>
<script>
	$(function(){
		$("#city").selectmenu({
  			change: function( event, ui ) {
  				$(this).trigger("change")
  			}
  		})
  		.selectmenu( "menuWidget" )
  	    .addClass( "overflow" );
  		$("#city-button")[0].style.marginLeft="0px";
	})

 		//获取当前url参数
 		function getQueryString(name) { 
 			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
 			var r = window.location.search.substr(1).match(reg); 
 			if (r != null){
 				return decodeURI(r[2]);
 			}else{
 				return "";
 			}
 		} 
 		
	    /* search */
	    
	    var getParameters = function(){
        	var arr = ["id","brand","materialPartNo","name","beginDateStr","endDateStr","enterpriseName","createName","category1Id","category2Id","category3Id"],
    		par ={};
    	
	    	for(var i=0; i< arr.length; i++){
	    		//par[arr[i]] = decodeURI(getQueryString(arr[i]));
	    	}
	    	return par;
	    }
	    
	    var search = avalon.define({
	        $id: "search",
	        parameter: getParameters(),
	        catList:[],
	        first:[],
	 	    second:[],
	 	    third:[],
	 	    firstSelected: "",
            secondSelected: "",
            thirdSelected: "",            
	        goSearch:function(){
	        	var wrap = $("#searchFrom");
	        	var inputList = wrap.find("input"),
	        		selectList = wrap.find("select"),
	        		parStr = "?",
	        		par = getQueryString("type"),
	        		parObj = {};
	        	
	        	if(par)
	        		parObj["type"] = par;
	        	
	        	function toUrl(pArr){
	        		for(var k in pArr){
	        			console.log(k)
	        			parStr += k + "=" + pArr[k] +"&";
	        		}
	        		
	        	}
	        	
	        	$.each(inputList,function(i,input){
	        		var val = input.value;
	        		if(val !== ""){
	        			parObj[input.name] = encodeURI(input.value);
	        		}
	        	})
	        	console.log(selectList)
	        	$.each(selectList,function(i,select){
	        		var val = "",
	        			selectObj = $(select,"option:selected");
	        		console.log(selectObj.val());
	        		if(selectObj.val()){
	        			parObj[select.name] = select.value;	        			
	        		}
	        	})
	        	
	        	toUrl(parObj);
	        	parStr = parStr.substring(0,parStr.length-1);

	        	window.location.href=window.location.pathname+parStr;
	        	
	        }

	    })
	 
	 var showList = avalon.define({
 	    $id: "list",
 	    list: [],
 	   	isLoading:"数据加载中...",
 	   	isfirst:true,
 	    allchecked: false,
 	   	audited:getQueryString("type"),
        checkAll: function (e) {
           var checked = e.target.checked;
           showList.list.list.forEach(function (el) {
               el.checked = checked
           })
        },
        checkOne: function (e) {
           var checked = e.target.checked
           if (checked === false) {
        	   showList.allchecked = false
           } else {//avalon已经为数组添加了ecma262v5的一些新方法
        	   showList.allchecked = showList.list.list.every(function (el) {
                   return el.checked
               })
           }
        },
 	    project : ykyUrl._this,
 	    auditUrl : ykyUrl.admin+"/rest/goods/checkBasicInfo",
 	    auditFun : function(id,type,remark,load){
 	    	var _this = this;
 	    	$.aAjax({
 	  	     url: _this.auditUrl,
 	  	     type:"GET",
 	  	     data:{type : type,id : id, remark : remark}, //去掉数据模型中的所有函数
 	  	     success: function(data) {
 	  	    	 //console.log(data);
 	  	    	 layer.close(load);
 	  	    	 if(data.code == 200){
	 	  	    	layer.msg(data.message, {time: 2000});
	 	  	    	setTimeout(function(){
	 	  	    		location.reload()
	 	  	    	},2000);
 	  	    	 }else{
 	  	    		layer.alert('<br/>' + data.message,{skin: "up_skin_class",area: ['300px', '210px']}); 
 	  	    	 }
 	  	     },
 	  	     error:function(){
 	  	    	layer.closeAll('loading');
 	  	    	layer.alert('系统错误，审批失败，请联系系统管理员',{skin: "up_skin_class",area: ['300px', '210px']});
 	  	     }
 	  	 })
 	    },
 	    auditClick:function(el,e,id){
 	    	var _this = this,
 	    	auditType = 1;
 	    	layer.confirm("<img class='y_prompt_box'  src='${ctx}/js/lib/layer/skin/default/y_ask.png'></i><div class='y_prompt_content' ><span class='sp1'>确认通过吗？</span><span>确认通过后，此商品将流转至运营部</span></div>", {
				offset: "auto",
				btn: ['确      认', '取      消'], //按钮
				title: " ",
				area: ['450px', '280px'],
				move: false,
				skin: "up_skin_class",
				yes:function(){
					//console.log(_this.project);
					var index = layer.load();
					_this.auditFun(id,auditType,"",index);
				}

			})
 	    },
 	    unAuditClick:function(el,e,id){
 	    	var _this = this,
 	    	auditType = 2;
	    	layer.confirm("<div class='y_unpass_tlt'>确认不通过吗？</div><div class='warn'><i class='icon-plaint'></i>理由不能为空</div><textarea class='y_unpass_content unpass_reason' placeHolder='请在此输入不通过的理由' maxlength='200'  onkeyup='calcWordsCount()'></textarea>", {
				offset: "auto",
				btn: ['确      认', '取      消'], //按钮
				title: " ",
				area: ['480px', '340px'],
				move: false,
				skin: "up_skin_class",
				yes:function(){
					if(!$.trim($(".unpass_reason").val())){						
						$(".warn").show();													
						return false;
					}else{
						var index = layer.load();
						_this.auditFun(id,auditType,$(".unpass_reason").val(),index);
					}
				}

			})
	    },
	    allAuditClick:function(){
	    	var idList="";	    	
	    	showList.list.list.forEach(function (el) {
	           if(el.checked)
	        	   idList+=el.id+","
	        })
	    	idList = idList.slice(0,-1);
	    	if(idList==""){
	    		return false;
	    	}
	    	var _this = this,
	    	auditType = 3;
	    	layer.confirm("<img class='y_prompt_box'  src='${ctx}/js/lib/layer/skin/default/y_ask.png'></i><div class='y_prompt_content' ><span class='sp1'>确认通过吗？</span><span>确认通过后，此商品将流转至运营部</span></div>",{
	    		offset: "auto",
				btn: ['确      认', '取      消'], //按钮
				title: "审核",
				area: ['450px', '280px'],
				move: false,
				skin: "up_skin_class",
				yes:function(){
					//console.log(_this.project);
					var index = layer.load();
					_this.auditFun(idList,auditType,"",index);
				}
	    	})
	    }
 	 })
 	 
 	 
 	 var queryType = getQueryString("type"),
 	 	 queryPage = getQueryString("page"),
  		listType = queryType ? queryType : 0,
		listPage = queryPage ? queryPage : 1,
		listUrl = ykyUrl.admin+"/rest/goods/list",
		typeUrl = ykyUrl.admin+"/rest/goods/toolsClassify";
 	 
	var setTab = function (index){
		var tabs = $(".content-header .header_tab"),
			status = {s0:0,s1:1};
		
		if(tabs.length)
			tabs.eq(status["s"+index]).addClass("pitch_tab");
	}
	
	setTab(listType);
	/* 请求商品列表数据 */
 	 $.aAjax({
	     url: "../data/list.json",  //listUrl+window.location.search,
	     //data:{type : listType,page:listPage}, //去掉数据模型中的所有函数
	     success: function(data) {
	    	 //var ck = {checked: false};
	    	 for(var i = 0; i< data.list.length; i++){
	    		 data.list[i].checked = false;
	    	 }
	    	 if( data.list.length == 0)
		    	 	showList.isLoading = "暂无数据";
	    	 
	    	 showList.list=data;
	    	 showList.isfirst = false;
	    	 

	    	 setPageOption(data);
	    	 loadPage(window.location.pathname+GetRequestWithout(window.location.search,"page"));
	    	 
	     }
	 })
	 /* 请求类型数据 */
	 
	 $.aAjax({
		 url: typeUrl,
		 success:function(data){
			 $.each(data,function(i,e){
				 if(e.cateId==99958){					 
					 search.catList = e;
					 setTimeout(function(){
						 setCatdefault()
					 }, 300);
					 /* search.first.push(e) */
				 }
			 })	
		 }
	 })
	 
	 function setCatdefault(e){
        var e = search.catList;
        if(getQueryString("category1Id") == e.cateId){
        	search.first.push(e);
            search.firstSelected = e.cateId;
            search.second= e.subList;
            $.each(search.second,function(i,ele){
                if(getQueryString("category2Id") == ele.cateId){
                    search.secondSelected = ele.cateId;
                    $.each(search.second[i].subList,function(index,data){
                        if(getQueryString("category3Id") == data.cateId){
                            search.third = search.second[i].subList;
                            search.thirdSelected = data.cateId;
                        }
                    })
                }
            })
        }else{
        	search.first.push(e);
            search.firstSelected = '';
        }
        $("select").selectmenu("refresh");
    }
	
	function calcWordsCount(){
		var valueLength = $(".unpass_reason")[0].value.length;		
		if(valueLength){
			$(".warn").hide();
		}else{
			$(".warn").show();
		}
	}
	 
	  $("#city").on("change",function(){
		 search.secondSelected = $(this, "option:selected").val();
		 $("#town").selectmenu("refresh")
	 })
	 
	 search.$watch("firstSelected", function (a) {
		 search.second = search.catList.subList;
		 search.secondSelected='';
     })
     search.$watch("secondSelected", function (a) {
    	 $.each(search.catList.subList,function(i,sub){
    		 if(sub.cateId == a)
    			 search.third = sub.subList;
    		 	 search.thirdSelected=''
    	 })
     })

        </script>


<script type="text/javascript">
  	$(function(){
  		//日期控件
  		var start = {
				elem: '#beginTime',
				format: 'YYYY-MM-DD hh:mm:ss',
				// min: laydate.now(),    //设定最小日期为当前日期
				istime: true, //是否显示时间
				istoday: false,
				isclear: false, //是否显示清空
				//选择好日期的回调
				choose: function(dates) {
					$(this.elem).trigger("blur");
					var startTime = $('#beginTime').val();
					var endTime = $('#endTime').val();
					var arr1 = startTime.split('-');
					var sdate = new Date(arr1[0], parseInt(arr1[1] - 1), arr1[2]);
					var arr2 = endTime.split('-');
					var edate = new Date(arr2[0], parseInt(arr2[1] - 1), arr2[2]);
					if(sdate > edate) {
						layer.tips('开始时间不能大于结束时间', '#beginTime', {
							tips: 1,
							time: 1000,
						});
						$('#beginTime').val('');
					};
				}
			};
			var end = {
				elem: '#endTime',
				format: 'YYYY-MM-DD hh:mm:ss',
				// min: laydate.now(),    //设定最小日期为当前日期
				istime: true, //是否显示时间
				istoday: false,
				isclear: false, //是否显示清空
				//选择好日期的回调
				choose: function(dates) {
					$(this.elem).trigger("blur");
					var startTime = $('#beginTime').val();
					var endTime = $('#endTime').val();
					var arr1 = startTime.split('-');
					var sdate = new Date(arr1[0], parseInt(arr1[1] - 1), arr1[2]);
					var arr2 = endTime.split('-');
					var edate = new Date(arr2[0], parseInt(arr2[1] - 1), arr2[2]);
					if(sdate > edate) {
						layer.tips('开始时间不能大于结束时间', '#endTime', {
							tips: 1,
							time: 1000,
						});
						$('#endTime').val('');
					};
				}
			};
  		$("#beginTime").on("click", function() {
			laydate(start);
		});
		$(".cc1").on("click", function() {
			laydate(start);
		});
		$("#endTime").on("click", function() {
			laydate(end);
		});
		$(".cc2").on("click", function() {
			laydate(end);
		});
  		
  		var url = ykyUrl.main+"/myEnterpriseMaterial.htm?status=1&condition=&size=20";
  		//加载分页
  		//loadPage(url);
  		
  	});
  	
  	
  	
</script>
</body>
</html>
