


var vm = new Vue({
	el: '#vendorManageList',
	data: {
		url: ykyUrl.party+'/v1/vendorManage/getVendorManageList',
		queryParams : { //请求接口参数 
			size : 10, //分页参数
			page : 1, //当前页
			defaultStatus : true //监测参数变化标识
		},
		gridColumns : [{
			key : 'partyCode',
			name : '供应商编码',
			default : '-',
			cutstring: true,	//字符串太长只显示前4个
		},{
			key : 'groupName',
			name : '供应商名称',
			default : '-',
			cutstring: true 
		},{
			key : 'category',
			name : '分类',
			default : '-',
			cutstring: true
		},{
			key : 'region',
			name : '所在地区',
			default : '-',
			cutstring: true
		},{
			key : 'isCore',
			name : '核心供应商',
			width: '80px',
			text : {
				Y : {
					'value': '是'
				},
				N : {
					'value': '否'
				}
			}
		},{
			key : 'payType',
			name : '付款方式',
			default : '-',
			cutstring: true
		},{
			key : 'enquiryName',
			name : '询价员',
			default : '-',
			cutstring: true
		},{
			key : 'creater',
			name : '创建人',
			default : '-',
			cutstring: true
		},{
			key : 'status',
			name : '状态',
			width: '80px',
			text : {
				PARTY_ENABLED : {
					'value': '启用'
				},
				PARTY_DISABLED : {
					'value': '停用'
				}
			}	
		},{
			key : 'createDate',
			name : '创建时间',
			default : '-',
			cutstring: true
		},{
			key : 'operate',
			align : 'center',
			name : '操作',
			items: [{
				className : 'btn-detail ml5',
				show : true,
				text : '详情',
				href : ykyUrl._this + '/bill.htm?action=detail&enterpriseId='+ '{partyId}'
			},{
				className : 'btn-detail ml5',
				show : true,
				text : '编辑',
				href : ykyUrl._this + '/bill.htm?action=detail&enterpriseId='+ '{partyId}'
			},{
				className : 'btn-detail ml5',
				show : "'{status}' === 'PARTY_DISABLED'",
				text : '启用',
				callback: {
					action : 'operatePromotion',
					params : [ '{partyId}','PARTY_ENABLED']
				}
			},{
				className : 'btn-detail ml5',
				show : "'{status}' === 'PARTY_ENABLED'",
				text : '停用',
				callback: {
					action : 'operatePromotion',
					params : [ '{partyId}','PARTY_DISABLED']
				}
			}]
		}],
		pageflag : true, //是否显示分页
		refresh : false, //重载
		
		formData:{
			id:'formId',
			columnCount:2,
			fields: [
				{
	                "keyname": "供应商编码",
	                "type": "text",
	                "key": "partyCode", 
	                "name": "partyCode"
	          }, {
	                "keyname": "供应商名称",
	                "type": "text",
	                "key": "groupName", 
	                "name": "groupName"
	          }, {
	                "keyname": "分类",
	                "type": "select",
	                "key": "category",
	                "name": "category",
	                "inputClass":"",
	                "optionId":"categoryId",        //控件option的value对应的接口字段
	                "optionName":"categoryName",    //控件option的Text对应的接口字段,
	                "url": ykyUrl.database+"/v1/category/companylist?categoryTypeId=VENDOR_THE_TYPE", //接口
	                "attr":{
	                	"placeholder":'全部'
	                }
	           },{
	                "keyname": "所在地区",
	                "type": "select",
	                "key": "region",
	                "name": "region",
	                "inputClass":"",
	                "optionId":"categoryId",        //控件option的value对应的接口字段
	                "optionName":"categoryName",    //控件option的Text对应的接口字段,
	                "url": ykyUrl.database+"/v1/category/companylist?categoryTypeId=VENDOR_THE_REGION", //接口
	                "attr":{
	                	"placeholder":'全部'
	                }
	           },{
	                "keyname": "核心供应商",
	                "type": "select",
	                "key": "isCore",
	                "name": "isCore",
	                "optionId":"value",        //控件option的value对应的接口字段
	                "optionName":"text",    //控件option的Text对应的接口字段,
	                "options": [
						{
						    "value": "",
						    "text": "全部"
						},       
	                    {
	                        "value": "Y",
	                        "text": "是"
	                    },
	                    {
	                        "value": "N",
	                        "text": "否"
	                    }
	                ]
	            },{
	                "keyname": "付款方式：",
	                "type": "text",
	                "key": "payType", 
	                "name": "payType"
	            },{
	                "keyname": "询价员：",
	                "type": "text",
	                "key": "enquiryName", 
	                "name": "enquiryName"
	            },{
                    "keyname": "日期区间",
                    "type": "daterange",        //时间区间类型
                    "startkey": "beginTime",  //star id
                    "endkey": "endTime",        //end id
                    "startname": "beginTime",    //star name
                    "endname": "endTime"         //end name
                },{
	                "keyname": "创建人",
	                "type": "text",
	                "key": "creater", 
	                "name": "creater"
	            }        
		],
		buttons:[
			{
                "text": '查询',
                "type": 'button',
                "id": '',
                "name": '',
                "inputClass": 'btn btn-danger',
            	"callback": {
                    action: 'on-search',        //方法名
                }
            },
            {
                "text": '新增',
                "type": 'button',
                "id": '',
                "name": '',
                "inputClass": 'btn btn-danger',
            	"callback": {
                    action: 'on-add',        //方法名
                }
            },
		]
	}
	},
	methods: {
		//搜索方法
		searchData: function(searchParam){		
			var queryParams = this.queryParams
            queryParams.pageSize = 10
            queryParams.page = 1
            queryParams.defaultStatus = !queryParams.defaultStatus

            for (var key in searchParam) {
                queryParams[key] = searchParam[key] ? searchParam[key] : undefined
            }
		},
	}
})


function operatePromotion(index,params){
	console.log(index,params);
	var description = '';
	var partyStatus = params[1] == 'PERIOD_ENABLED' ? 'PERIOD_ENABLED' : 'PERIOD_DISABLED';
	layer.confirm(
			  partyStatus =='PERIOD_DISABLED' ? '确定停用 ？' : '确定启用  ？',
					  {
		offset: "auto",
		closeBtn: false,
		btn: ['确      定','取      消'], //按钮
		title: " ",
		area: 'auto',			
		move: false,
		skin: "up_skin_class",
		yes:function(){
			$.aAjax({
				url: ykyUrl.party+"/v1/vendorManage/enableOrlose"+params[0]+"/"+params[1],
				//url: 'http://localhost:27082'+"/v1/vendorManage/enableOrlose/"+params[0]+"/"+params[1]+"/"+description,
				type:"PUT",
				dataType: 'text',
				contentType:'application/json',
			    success: function(data) {
			    	vm.queryParams.defaultStatus = !vm.queryParams.defaultStatus
			    	location.reload();
			    },
			    error:function(e){
			    	layer.msg("操作失败，请重试 ！")
			    }
			})
		}
	})
}

function init(){
	//创建时间
	$('#registerDate .input-daterange').datepicker({
	    format: config.dateFormat,
	    autoclose: true
	});
	
}



init();
