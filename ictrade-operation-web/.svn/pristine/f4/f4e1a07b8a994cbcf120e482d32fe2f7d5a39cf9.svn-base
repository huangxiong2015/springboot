/*分页组件*/
Vue.component('pagination', {
    template: `  <div v-if="all >= 1">
        <ul class="pagination">
            <li v-if="showFirst"><a href="javascript:" @click="cur--">上一页</a></li>
            <li v-for="index in indexes"  :class="{ 'active': cur == index}">
                <a @click="btnClick(index)" href="javascript:">{{ index }}</a>
            </li>
            <li v-if="showLast"><a @click="cur++" href="javascript:">下一页</a></li>
            <li> <input type="text" v-model="curPage" @keyup.13="tunrnPage(cur)" class="page-input"></li>
            <li><span>共<i>{{all}}</i>页</span></li>
        </ul>
    </div>`,
    replace: true,
    props:{
        params: Object
    },
    data: function () {
        return {
            pageCur: 0,
            all: 0,
            pageNum: 0,
            cur: this.params.pageCur,
            curPage : this.params.pageCur
        }
    },
    methods:{
        //页码点击事件
        btnClick : function(index){
            if(index != this.cur){
                this.cur = this.curPage = index;
            }
        },
        tunrnPage : function () {
            this.cur = this.curPage;
        }
    },
    watch:{
        cur : function(val, oldVal) {
            this.query.cur = val
            this.query.defaulestatus = !this.query.defaulestatus;
            this.$emit('page-to', this.query);
        }
    },
    computed:{
        indexes : function(){
            console.log(666)
            var list = [];
            //计算左右页码
            var mid = parseInt(this.pageNum / 2);//中间值
            var left = Math.max(this.cur - mid,1);
            var right = Math.max(this.cur + this.pageNum - mid -1,this.pageNum);
            if (right > this.all ) { right = this.all}
            while (left <= right){
                list.push(left);
                left ++;
            }
            return list;
        },
        showLast: function(){
            return this.cur != this.all;
        },
        showFirst: function(){
            return this.cur != 1;
        }
    }
});
