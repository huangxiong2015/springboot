<!DOCTYPE html>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath }" scope="request" />

<!--[if IE 8 ]>    <html class="ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="zh-CN"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="zh-CN">
<!--<![endif]-->

<head>
	<!-- jQuery 1.11.3 -->
<script src="${ctx}/js/lib/jquery-1.11.3.min.js"></script>
  <c:import url ="/WEB-INF/jsp/include/main/constants.jsp"/>
  <link rel="stylesheet" href="${ctx}/js/lib/zTree/zTreeStyle.css"/>
  <link rel="stylesheet" href="${ctx}/css/app/helpMaintain.css"/>
  <title>运营后台</title>
 
</head>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

	<!---index header  start   ---->
	<jsp:directive.include file="../include/main/header.jsp" />
	<!---index header  end   ---->
	 <!---index nav  start   ---->
	<jsp:directive.include file="../include/main/menu.jsp" />
	<!---index nav  end   ---->
	  
	  <!-- 右边内容显示 -->
	  <div class="content-wrapper" >
	  <input type="hidden" id="id" name="id" value="<c:if test='${news!=null }'>${news.id }</c:if>" />
	  <input type="hidden" id="iframeUrl_Id" value="<spring:eval expression="@appProps.getProperty('ueditor.iframeUrl')"/>" /> 
		<section class="content-header">
			<a href="#" class="header_tab pitch_tab">模块维护</a>
		</section>
		<section ms-controller="detail" class="content container-fluid">						
			<div class="row mt30 dn">
				<div class="col-xs-1 tr pl0">
					<label>类型：</label>
				</div>
				<div class="col-xs-11 c5e">
					<span id="pathName1"></span>
				</div>
			</div>
			<div class="row mt30 dn">
				<div class="col-xs-1 tr">
					<label>子类型：</label>
				</div>
				<div class="col-xs-11 c5e">
					<span id="pathName2"></span>
				</div>
			</div>
			<div class="row mt30 dn">
				<div class="col-xs-1 tr">
					<label>次类型：</label>
				</div>
				<div class="col-xs-11 c5e">
					<span id="pathName3"></span>
				</div>
			</div>
			<div class="row mt30">
				<div class="col-xs-1 tr">
					<label><i class="gred">*</i>内容：</label>
				</div>
				<div class="col-xs-11 c5e">
					<div class="ueditor_wrapper">
					    <iframe class="ueditor_iframe"  src="<spring:eval expression="@appProps.getProperty('ueditor.iframeUrl')"/>" scrolling="no" allowTransparency="true">
					    </iframe>
					</div>
					<div id="contentEdit" style="display:none"></div>
	                <input type="hidden" id="contents" name="content"  value> 
				</div>
			</div>			
			<div class="row mt30 mb50">
				<div class="col-xs-1 tr"></div>
				<div class="col-xs-11 c5e">
					<span id="save_btn" class="condition_inquery" style="cursor:pointer;padding:10px 20px;">保&nbsp;&nbsp;存</span><span id="cancel_btn" href="javascript:;" class="ml20 return_btn">取&nbsp;&nbsp;消</span>
				</div>
			</div>			
		</section>
		<script type="text/javascript">
			var selectCatid = "242,297";
		</script>
	<!---footer  start   ---->
	<jsp:directive.include file="../include/main/footer.jsp" />
	<!---footer  end   ---->
</div>	    
</body>
<script>
var categoryId = getQueryString("categoryId"),contentId = getQueryString("contentId"),
pathName1 = getQueryString("pathName1"),pathName2 = getQueryString("pathName2"),pathName3 = getQueryString("pathName3");
$(function(){	
	if(pathName1){
		$("#pathName1").text(pathName1);
		$("#pathName1").parents('.row').removeClass('dn');
	}else{
		$("#pathName1").parents('.row').addClass('dn');
	}
	if(pathName2){
		$("#pathName2").text(pathName2);
		$("#pathName2").parents('.row').removeClass('dn');
	}else{
		$("#pathName2").parents('.row').addClass('dn');	
	}
	if(pathName3){
		$("#pathName3").text(pathName3);
		$("#pathName3").parents('.row').removeClass('dn');
	}else{
		$("#pathName3").parents('.row').addClass('dn');
	}
	
	if(window.addEventListener){  
		window.addEventListener('message',function(e){
        save(e.data);
     	},false);
	}else if(window.attachEvent){   
		window.attachEvent('message',function(e){
        save(e.data);
     	},false);
	}
	$('#save_btn').click(function(){
		window.frames[0].postMessage('save_btn',$("#iframeUrl_Id").val());
	});
	$("#cancel_btn").on("click",function(){
		location.href = ykyUrl._this + '/helpMaintain.htm?activeMenuId=' + categoryId;
	})
})
window.onload=function(){
	setTimeout(function(){
		window.frames[0].postMessage('loadContent'+$("#contentEdit").html(),$("#iframeUrl_Id").val());
	},300);
}
/* 修改获取内容详情 */
if(contentId){
	$.aAjax({
		url:ykyUrl.product + '/v1/news/' + contentId,
		type:'GET',
		success:function(data){
			$("#contentEdit").html(data.newsContent.content);
		},
		error:function(data){
			console.log("error");
		}
	})
}
/* 保存编辑内容 */
function save(contentMsg){
	$("#contents").val(contentMsg);
	var content = $("#contents").val();
	if(content==""){
		return;
	}	
	$.aAjax({
		url:contentId ? ykyUrl.product + '/v1/news/' + contentId : ykyUrl.product + '/v1/news/',
		type:contentId ? 'PUT' : 'POST',
		data:JSON.stringify({
			"categoryTypeId":"HELP",
			"categoryId":categoryId,
			"content":content,
			"title":""
		}),
		success:function(data){
			location.href = ykyUrl._this + '/helpMaintain.htm?activeMenuId=' + categoryId;
		},
		error:function(data){
			console.log("error");
		}
	})
}
</script>
</html>
