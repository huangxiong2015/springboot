var vm = '';
$(function() {

	function getFormData () {
	    var searchingFlag = sessionStorage.getItem('searchingFlag')
		var searchString = sessionStorage.getItem('searching')
        var result = {}

		if (searchString && searchingFlag) {
			try {
                result = JSON.parse(searchString)
			} catch (e) {}
		}

        sessionStorage.removeItem('searchingFlag')
        sessionStorage.removeItem('searching')
        if (!searchingFlag) {
            sessionStorage.removeItem('searching')
        }
       // result['categoryTypeIdStr']='NOTICE,INFORMATION,MEDIAREPORT';
		return result
	}

	vm = new Vue(
			{
				el : '#material-review',
				data : function () {
					return 	{
                        formData: {
                            url:'',    //form提交请求接口，可选
                            id:'seachForm',
                            data: getFormData(),            //初始化数据
                            columnCount: 3,
                            fields:[            //配置控件
                                 {
                                    keyname: "型号 ",           //控件文本
                                    type: "text",             //控件类型
                                    key: "manufacturerPartNumber",          //控件名
                                    name: "manufacturerPartNumber"         //控件name
                                },{
                                    keyname: "原厂  ",          
                                    type: "text",             
                                    key: "manufacturer",         
                                    name: "manufacturer"        
                                },
                                {
                                    "keyname": "分类 ",        //分类使用城市组件 
                                    "type": "city", 
                                    "styleObject": '',					//设置style
                                    "validate": {
                                        "citySel": false
                                    },
                                    "items": {
                                        "province": {			//设置一级属性
                                            id: 'cate1Name',
                                            name: 'cate1Name' 
                                        },
                                        "city": {				//设置二级属性
                                            id: 'cate2Name',
                                            name: 'cate2Name' 
                                        },
                                        "district": {			//设置三级属性
                                            id: 'cate3Name',
                                            name: 'cate3Name' 
                                        }
                                    },
                                    "url": ykyUrl.product + "/v1/products/categories/children",    //分类接口 
                                 "attr":{
                                        "disabled":true
                                     },
                                    "optionId":"_id",
                                    "optionName":"cateName",
                                    "parentId":"parentCateId"
                                },
                               {
                                    "keyname": "时间区间",
                                    "type": "daterange",   		//区间类型
                                    "startkey": "startDate",   //star id
                                    "endkey": "endDate",  		//end id
                                    "startname": "startDate",  //star name
                                    "endname": "endDate" , 		//end name
                                    "dateRange":{}
                                },
                                /*{
                                    keyname: "状态",           //控件文本
                                    type: "select",             //控件类型
                                    key: "status",          //控件名
                                    name: "status",         //控件name
                                    options: [{
                                        value: '',
                                        text: '全部'
                                    },{
                                        value: '0',
                                        text: '有效 '
                                    },{
                                        value: '1',
                                        text: '失效'
                                    }]
                                },{
                                    keyname: "提交人  ",          
                                    type: "text",             
                                    key: "auditUserName",         
                                    name: "auditUserName"        
                                },*/
                                {
                                    keyname: "审核状态",           //控件文本
                                    type: "select",             //控件类型
                                    key: "auditStatus",          //控件名
                                    name: "auditStatus",         //控件name
                                    options: [{
                                        value: '',
                                        text: '全部'
                                    },{
                                        value: '0',
                                        text: '待审核  '
                                    },{
                                        value: '1',
                                        text: '未通过  '
                                    },{
                                        value: '2',
                                        text: '通过  '
                                    }]
                                }
                            ],
                            buttons:[{
                                "text": '查询',
                                "type": 'submit',
                                "id": '',
                                "name": '',
                                "inputClass": 'btn btn-danger',
                                "callback": {
                                    action: 'on-search'
                                }
                            }]
                        },
                        url : ykyUrl.product + "/v1/products/standaudit", //访问数据接口  
                        queryParams : { //请求接口参数
                            pageSize : 20, //分页参数
                            page : 1, //当前页
                            status:'',
                            manufacturerPartNumber:'',   //型号 
                            manufacturer : '' ,   //原厂 
                            defaultStatus : true, 
                            //监测参数变化标识
                        },
                        gridColumns : [ //表格列
                          {
                                key : 'id',  //物料id  
                                name : 'id',
                                hide : 'true'
                             },{
                                key : 'manufacturerPartNumber',
                                name : '型号',
                                align : 'center',
                                cutstring: true
                            }, {
                                key : 'manufacturer',
                                name : '原厂 '
                            },{
                                key : 'cateName',     	//次小类有问题  
                                align : 'center',
                                cutstring: true,
                                name : '次小类 '
                            },{
                                key : 'auditStatus',    //审核状态  
                                align : 'center',
                                name : '状态',
                                align : 'center',
                                width: '120px',
                                text : {
                                    0 : {
                                        'value' : '有效 '
                                    },
                                    1 : {
                                        'value' : '失效 '
                                    }
                                }
                            },{
                                key : 'restrictMaterialType',    //限制物料 
                                align : 'center',
                                name : '限制物料 ',
                                align : 'center',
                                width: '120px',
                                text : {
                                   N: {
                                        'value' : '否  '
                                       },
                                   P: {
                                        'value' : '特殊包装 '
                                    } ,
                                   F: {
                                        'value' : '特殊文件  '
                                    }
                                }
                            }, {
                                key : 'auditUserName',
                                name : '提交人 ',
                                align : 'center',
                                cutstring: true
                            }, {
                                key : 'lastUpdateDate',
                                name : '提交时间  ',
                                align : 'center',
                                cutstring: true
                            },{
                                key : 'auditStatus',    //限制物料 
                                align : 'center',
                                name : '审核状态  ',
                                align : 'center',
                                width: '120px',
                                text : {
                                   0 : {
                                        'value' : '待审核   '
                                    },
                                   1: {
                                        'value' : '未通过  '
                                    } ,
                                   2: {
                                        'value' : '通过  '
                                    }
                                 }
                             },{
                                 key : 'operate',
                                 name : '操作',
                                 align : 'center',
                                 items : [  {
                                	 className : 'btn-detail',
                                     text: '详情',
                                     show : true,
                                     href : ykyUrl._this + '/basicMaterial/detail.htm?id={id}',  //物料详情链接  
                                     target: '_self'
                                 } ]
                             }],
                        pageflag : true, //是否显示分页
                        refresh : false, //重载 
                        checkflag :true,
                        descr:''    //不通过审核的描述  

                    }
				},
				mounted: function () {
				  setTimeout(() => this.onSearchClick(this.formData.data), 500)
				},
				methods : {
                    onAddNewClick: function (e) {
                        sessionStorage.setItem('searchingFlag', '1')
                    },
                    onSearchClick: function (formdata) {
						var queryParams = this.queryParams
                        queryParams.pageSize = 10;
                        queryParams.page = 1;
                        queryParams.defaultStatus = !queryParams.defaultStatus
                        

                        for (var key in formdata) {
                        	queryParams[key] = formdata[key]
						}

                        LS.set("bulletinPageQueryParams",JSON.stringify(queryParams));

                        sessionStorage.setItem('searching', JSON.stringify(formdata))
					}
				}
			});
 
		var queryParams  = LS.get("bulletinPageQueryParams");
		if(queryParams && LS.get("bulletinEditCancel")){
			var params = JSON.parse(queryParams);	
			vm.queryParams= $.extend({},vm.queryParams, params);
			vm.queryParams.pageSize = params.pageSize;
			vm.queryParams.page = params.page;
			vm.queryParams.status = params.status || "";
			vm.queryParams.manufacturerPartNumber = params.manufacturerPartNumber || "";
			vm.queryParams.defaultStatus = !vm.queryParams.defaultStatus;	
		}
		LS.remove("bulletinPageQueryParams");
		LS.remove("bulletinEditCancel");
		
		
		 
		 
		 
		
});
