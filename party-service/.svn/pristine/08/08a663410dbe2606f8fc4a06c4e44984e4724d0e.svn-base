package com.yikuyi.party.person.api.impl;




import java.util.List;

import org.apache.ibatis.session.RowBounds;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.alibaba.fastjson.JSON;
import com.framewrok.springboot.web.RequestHelper;
import com.github.pagehelper.PageInfo;
import com.yikuyi.party.contact.vo.UserExtendVo;
import com.yikuyi.party.contact.vo.UserVo;
import com.yikuyi.party.person.api.IPersonResource;
import com.yikuyi.party.person.model.Person;
import com.yikuyi.party.userLogin.bll.UserLoginManager;

/**
 * 定义收货地址的相关接口
 * 
 * @author zr.aoxianbing@yikuyi.com
 *
 */


@RestController
@RequestMapping("v1/person")
public class PersonResource implements IPersonResource {

	@Autowired
	private UserLoginManager userLoginManager;

	/**
	 * 查询账号列表
	 * @param name
	 * @return
	 * @since 2017年3月17日
	 * @author zr.aoxianbing@yikuyi.com
	 */
	@Override
	@RequestMapping(value="/search",method=RequestMethod.GET)
	public PageInfo<UserVo> search(@RequestParam(value ="name", required = false) String name,
			@RequestParam(value = "page", required = false, defaultValue = "1") int page,
			@RequestParam(value = "size", required = false, defaultValue = "10") int size) {
		RowBounds rowBouds = new RowBounds((page-1)*size, size);
		String userId = RequestHelper.getLoginUserId();
		return userLoginManager.search(name,rowBouds,userId,page,size);
	}
	
	@Override
	@RequestMapping(value="/all",method=RequestMethod.GET)
	public List<Person> getEmailListByRoleType(
			@RequestParam(value = "roleType", required = true) String roleType) {
		return userLoginManager.getEmailListByRoleType(roleType);
	}
	
	/**
	 * 新增账号
	 * @param userVo
	 * @return
	 * @since 2017年3月17日
	 * @author zr.aoxianbing@yikuyi.com
	 */
	@Override
	@RequestMapping(value="/user",method=RequestMethod.POST)
	public String save(@RequestBody UserVo userVo) {
		String userId = RequestHelper.getLoginUserId();
		userVo.setId(userId);
		return userLoginManager.save(userVo);
	}
	/**
	 * 修改账号
	 * @param userVo
	 * @return
	 * @since 2017年3月17日
	 * @author zr.aoxianbing@yikuyi.com
	 */
	@Override
	@RequestMapping(value="/user",method=RequestMethod.PUT)
	public String update(@RequestBody UserVo userVo) {
		String userId = RequestHelper.getLoginUserId();
		userVo.setPartyId(userId);
		return userLoginManager.update(userVo);
	}

	/**
	 * 根据id查询用户
	 * @param id
	 * @return
	 * @since 2017年3月20日
	 * @author zr.aoxianbing@yikuyi.com
	 */
	@Override
	@RequestMapping(value="/{id}",method=RequestMethod.GET)
	public UserVo getPerson(@PathVariable("id") String id) {
		return userLoginManager.getPerson(id);
	}
	/**
	 * 重置密码
	 * @param userVo
	 * @return
	 * @since 2017年3月20日
	 * @author zr.aoxianbing@yikuyi.com
	 */
	@Override
	@RequestMapping(value="/{id}",method=RequestMethod.PUT)
	public String updatePwd(@PathVariable("id") String id,@RequestParam(value ="passWord", required = true)String passWord) {
		String userId = RequestHelper.getLoginUserId();
		return userLoginManager.updatePwd(userId,passWord,id);
	}
	/**
	 * 查询供应商可分配人员
	 */
	@Override
	@RequestMapping(value="/reportsto" , method = RequestMethod.GET)
	public List<UserExtendVo> getReportsTo(@RequestParam(value = "partyId" , required = true)String partyId) {
		return userLoginManager.getReportsTo(partyId);
	}

	@Override
	@RequestMapping(value ="/batch", method = RequestMethod.GET)
	public List<UserVo> getPartyByIds(@RequestParam(value = "ids" , required = true) String ids) {
			List<String> idss =JSON.parseArray(ids,String.class);
		return userLoginManager.getPartyByIds(idss);
	}
	
}
