<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yikuyi.party.vendor.dao.VendorDao">
   <resultMap id="BaseResultVendorInfoMap" type="com.yikuyi.party.vendor.vo.VendorInfoVo">
		<id column="PARTY_ID" property="partyId"/>
		<result column="GROUP_NAME_FULL" property="groupNameFull"/>
		<result column="GROUP_NAME" property="groupName"/>
		<result column="PARTY_CODE" property="partyCode"/>
		<result column="CATEGORY" property="category"/>
		<result column="IS_CORE" property="isCore"/>
		<result column="LOGO_IMAGE_URL" property="logoImageUrl"/>
		<result column="REGION" property="region"/>
		<result column="GENERAL_HEADQUARTERS" property="generalHeadquarters"/>
		<result column="GENRE" property="genre"/>
		<result column="LISTED" property="listed"/>
		<result column="STOCK_CODE" property="stockCode"/>
</resultMap>

  <!-- 供应商基本信息 -->
  <select id="getVendorInfo" resultMap="BaseResultVendorInfoMap" parameterType="java.lang.String">
	    select 
		  p.`PARTY_ID`,
		  pg.`GROUP_NAME_FULL`,
		  pg.`GROUP_NAME`,
		  p.`PARTY_CODE`,
		  ps.`CATEGORY`,
		  ps.`IS_CORE`,
		  pg.`LOGO_IMAGE_URL`,
		  ps.`REGION`,
		  ps.`GENERAL_HEADQUARTERS`,
		  ps.`GENRE`,
		  ps.`LISTED`,
		  ps.`STOCK_CODE` 
		from
		  PARTY p,
		  PARTY_GROUP pg,
		  PARTY_SUPPLIER ps 
		where p.`PARTY_ID` = pg.`PARTY_ID` 
		and p.`PARTY_ID` = ps.`PARTY_ID`
		  and p.`PARTY_ID` = #{partyId}
  </select>
  
  
  <resultMap id="BaseResultVendorSupplierMap" type="com.yikuyi.party.vendor.vo.VendorSaleInfoVo">
		<id column="PARTY_ID" property="partyId"/>
		<result column="ORDER_VERIFY" property="orderVerify"/>
		<result column="IS_SHOW_NAME" property="isShowName"/>
		<result column="SUPPORT_CURRENCY" property="supportCurrency"/>
		<result column="MIN_ORDER_AMOUNT_CNY" property="minOrderPriceCNY"/>
		<result column="MIN_ORDER_AMOUNT_USD" property="minOrderPriceUSD"/>
		<result column="DESCRIPTION" property="description"/>
		<result column="VENDOR_MOV_STATUS" property="vendorMovStatus"/>
		<result column="SKU_MOV_STATUS" property="skuMovStatus"/>
		<result column="REALTIME_CREDIT_QUOTA" property="surplusQuota"/>
</resultMap>
  
  <!-- 供应商销售信息 -->
  <select id="getVendorSaleInfoVo" resultMap="BaseResultVendorSupplierMap" parameterType="java.lang.String">
  	SELECT 
	  p.`PARTY_ID`,
	  p.`ORDER_VERIFY`,
	  p.`IS_SHOW_NAME`,
	  p.`SUPPORT_CURRENCY`,
	  p.`MIN_ORDER_AMOUNT_CNY`,
	  p.`MIN_ORDER_AMOUNT_USD`,
	  p.`DESCRIPTION`,
	  p.`VENDOR_MOV_STATUS`,
	  p.`SKU_MOV_STATUS`,
	  pc.`REALTIME_CREDIT_QUOTA`
	FROM
	  PARTY_SUPPLIER p,
	  PARTY_CREDIT pc 
	WHERE p.`PARTY_ID` = pc.`PARTY_ID` 
	and p.`PARTY_ID` = #{partyId}
  </select>
  
    
 <resultMap id="BaseResultVendorPersonMap" type="com.yikuyi.party.vendor.vo.ContactPersonInfo">
		<id column="PARTY_ID" property="partyId"/>
		<result column="LAST_NAME_LOCAL" property="lastNameLocal"/>
		 <result column="PERSONAL_TITLE" property="personalTitle"/> 
		<result column="OCCUPATION" property="occupation"/>
		<result column="MAIL" property="mail"/>
		<result column="TEL" property="tel"/>
		<result column="FIXEDTEL" property="fixedtel"/>
		<result column="IS_DEFAULT" property="isDefault"/>
		<result column="ADDRESS" property="address"/>
	</resultMap>  

  <!-- 供应商 销售信息联系人 -->
  <select id="getVendorPersonList" resultMap="BaseResultVendorPersonMap" parameterType="java.lang.String">
		SELECT p.*
		FROM
		  PERSON p 
		WHERE p.`PARTY_ID`=#{partyId}
 </select>
 
 <resultMap id="BaseVendorManageMap" type="com.yikuyi.party.vendor.vo.VendorResponVo">
		<id column="PARTY_ID" property="partyId"/>
		<result column="PARTY_CODE" property="partyCode"/>
		<result column="GROUP_NAME" property="groupName"/>
		<result column="CATEGORY" property="category"/>
		<result column="REGION" property="region"/>
		<result column="IS_CORE" property="isCore"/>
		<result column="COMMON" property="payType"/>
		<result column="ENQUIRYNAME" property="enquiryName"/>
		<result column="CREATOR" property="creater"/>
		<result column="STATUS_ID" property="status"/>
		<result column="CREATED_DATE" property="createDate"/>
		<result column="CREATOR_NAME" property="creatorName"/>
		<result column="ACCOUNT_STATUS" property="accountStatus"/>
		<result column="VERIFY_STATUS_ID" property="verifyStatusId"/>
		<!-- <result column="" property="lastDealDate"/> -->
</resultMap>
 <!-- 供应商管理列表 -->
 <select id="getVendorManageList" resultMap="BaseVendorManageMap" parameterType="com.yikuyi.party.vendor.vo.VendorQueryVo">
	SELECT
	p.CREATOR,
	p.PARTY_ID,
	p.PARTY_CODE,
	pg.GROUP_NAME_FULL as GROUP_NAME,
	ps.CATEGORY,
	ps.REGION,
	ps.IS_CORE,
	pc.PAYMENT_TERMS COMMON,
	per.LAST_NAME_LOCAL CREATOR_NAME,
	pg.ACCOUNT_STATUS,
	pg.VERIFY_STATUS_ID,
	DATE_FORMAT(p.CREATED_DATE, '%Y-%m-%d') CREATED_DATE,	
	per2.LAST_NAME_LOCAL ENQUIRYNAME
	FROM
	PARTY p
	LEFT JOIN PERSON per ON p.CREATOR = per.PARTY_ID
	LEFT JOIN PARTY_GROUP pg ON p.PARTY_ID = pg.PARTY_ID
	LEFT JOIN PARTY_SUPPLIER ps ON p.PARTY_ID = ps.PARTY_ID
	LEFT JOIN PARTY_CREDIT pc ON p.PARTY_ID = pc.PARTY_ID
	LEFT JOIN PARTY_RELATIONSHIP prs ON prs.PARTY_ID_FROM = p.PARTY_ID AND prs.PARTY_RELATIONSHIP_TYPE_ID = 'VENDOR_ENQUIRY_REL'
	LEFT JOIN PERSON per2 ON per2.PARTY_ID = prs.PARTY_ID_TO 
	where p.`PARTY_TYPE_ID`='SUPPLIER'
		<if test="partyId !=null and partyId !=''">
			and p.PARTY_ID = #{partyId}
		</if>
		<if test="partyCode !=null and partyCode !=''">
			and p.PARTY_CODE like concat('%',#{partyCode},'%')  
		</if>
		<if test="groupName !=null and groupName !=''">
			and pg.GROUP_NAME_FULL like concat('%',#{groupName},'%') 
		</if>
		<if test="category !=null and category !=''">
			and ps.CATEGORY = #{category}
		</if>
		<if test="region !=null and region !=''">
			and ps.REGION = #{region}
		</if>
		<if test="isCore !=null and isCore !=''">
			and ps.IS_CORE = #{isCore}
		</if>
		<if test="payType !=null and payType !=''">
			and pc.PAYMENT_TERMS like concat('%',#{payType},'%') 
		</if>
		<if test="enquiryName !=null and enquiryName !=''">
			and per2.LAST_NAME_LOCAL like concat('%',#{enquiryName},'%')  
		</if>
		<if test="beginTime !=null and beginTime !=''">
			and  DATE_FORMAT(p.CREATED_DATE,'%Y-%m-%d') &gt;= DATE_FORMAT(#{beginTime},'%Y-%m-%d')
		</if>
		<if test="endTime !=null and endTime !=''">
			and  DATE_FORMAT(p.CREATED_DATE,'%Y-%m-%d') &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d')
		</if>

		<if test="creatorName !=null and creatorName !=''">
			and  per.LAST_NAME_LOCAL like concat('%',#{creatorName},'%') 
		</if>
	
		<if test="isSys ==null and creatorName == null">
			and  (p.PARTY_ID in
			<foreach item="id" collection="partyIds" separator="," open="(" close=")" index="">    
	      		#{id}
	    	</foreach>
	    		<if test="createrPartyIds != null and createrPartyIds.size() > 0">
			 		or p.CREATOR in
					<foreach item="item" index="index" collection="createrPartyIds" open="(" separator="," close=")">
		            	#{item}  
			    	</foreach>
			 	</if>
	    	 )
		</if>		
	    order by p.CREATED_DATE desc
	
 </select>

</mapper>