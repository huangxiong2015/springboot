<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yikuyi.product.promotion.dao.PromotionModuleDraftDao">
  	 <resultMap id="BaseResultMap" type="com.yikuyi.promotion.model.PromotionModuleDraft" >
	    <id column="PROMO_MODULE_ID" property="promoModuleId" jdbcType="VARCHAR" />
	    <result column="PROMOTION_ID" property="promotionId" jdbcType="VARCHAR" />
	    <result column="PROMO_MODULE_TYPE" property="promoModuleType" jdbcType="VARCHAR" />
	    <result column="PROMO_MODULE_STATUS" property="promoModuleStatus" jdbcType="VARCHAR" />
	    <result column="ORDER_SEQ" property="orderSeq" />
	    <result column="CREATOR" property="creator" jdbcType="TIMESTAMP" />
	    <result column="CREATOR_NAME" property="creatorName" jdbcType="VARCHAR" />
	    <result column="CREATED_DATE" property="createdDate" jdbcType="TIMESTAMP" />
	    <result column="LAST_UPDATE_USER" property="lastUpdateUser" jdbcType="VARCHAR" />
	    <result column="LAST_UPDATE_USER_NAME" property="lastUpdateUserName" jdbcType="VARCHAR" />
	    <result column="LAST_UPDATE_DATE" property="lastUpdateDate" jdbcType="TIMESTAMP" />
	  </resultMap>
  		
  	<sql id="Base_Column_List" >
	    PROMO_MODULE_ID,PROMOTION_ID,PROMO_MODULE_TYPE,PROMO_MODULE_STATUS,ORDER_SEQ,CREATOR,
		CREATOR_NAME,CREATED_DATE,LAST_UPDATE_USER,LAST_UPDATE_USER_NAME,LAST_UPDATE_DATE
	</sql>
  	
  	<select id="getPromotionModuleDraft" parameterType="java.lang.String" resultMap="BaseResultMap">
  		SELECT <include refid="Base_Column_List"/> FROM PROMOTION_MODULE_DRAFT WHERE PROMO_MODULE_ID = #{promoModuleId}
  	</select>
  	
  	<!-- 根据参数查询相应list -->
  	<select id="getPromotionModuleDraftList" parameterType="com.yikuyi.promotion.model.PromotionModuleDraft" resultMap="BaseResultMap">
  		SELECT d.`PROMO_MODULE_ID`,d.`PROMOTION_ID`,d.`PROMO_MODULE_TYPE`,d.`PROMO_MODULE_STATUS`,
			   d.`ORDER_SEQ`,d.`CREATOR`,d.`CREATED_DATE`,d.`LAST_UPDATE_USER`,d.`LAST_UPDATE_DATE`,d.`LAST_UPDATE_USER_NAME`
		FROM PROMOTION_MODULE_DRAFT d  WHERE d.`PROMO_MODULE_STATUS` != 'DELETE'
		<if test="promotionId != null ">
			And d.`PROMOTION_ID` =#{promotionId}
		</if>
		<if test="promoModuleType != null ">
			And d.`PROMO_MODULE_TYPE` =#{promoModuleType}
		</if>
		<if test="promoModuleStatus != null ">
			And d.`PROMO_MODULE_STATUS` =#{promoModuleStatus}
		</if>
		<choose>
			<when test='orderSeq !=null and orderSeq== "99999999"'>
				ORDER BY d.`ORDER_SEQ` ASC
			</when>
			<otherwise>
				ORDER BY d.`LAST_UPDATE_DATE` DESC
			</otherwise>
		</choose>		
  	</select>
  
  	<!-- 根据促销模块id修改促销模块草稿相关信息 -->
	<update id="updatePromotionModuleDraft" parameterType="com.yikuyi.promotion.model.PromotionModuleDraft">
  	update `PROMOTION_MODULE_DRAFT` 
  		<set>
  			<if test="promoModuleType != null">
  				PROMO_MODULE_TYPE = #{promoModuleType},
  			</if>
  			<if test="promoModuleStatus != null">
  				PROMO_MODULE_STATUS = #{promoModuleStatus},
  			</if>
  			<if test="orderSeq != null" >
	        	ORDER_SEQ = #{orderSeq},
	      	</if>
	      	<if test="creatorName != null" >
	       	 	CREATOR_NAME = #{creatorName},
	      	</if>
	      	<if test="lastUpdateUserName != null" >
	       	 	LAST_UPDATE_USER_NAME = #{lastUpdateUserName},
	      	</if>
	      	<if test="createdDate != null" >
	       		 CREATE_DATE = #{createdDate},
	      	</if>
	      	<if test="creator != null" >
	       		 CREATOR = #{creator},
	      	</if>
	      	<if test="lastUpdateDate != null" >
	       		 LAST_UPDATE_DATE = #{lastUpdateDate},
	      	</if>
	      	<if test="lastUpdateUser != null" >
	       		 LAST_UPDATE_USER = #{lastUpdateUser},
	      	</if>
  		</set>
  	WHERE PROMO_MODULE_ID = #{promoModuleId}
  </update>

	<!-- 创建活动 -->
	<insert id="insert" parameterType="com.yikuyi.promotion.model.PromotionModuleDraft">
		insert into PROMOTION_MODULE_DRAFT
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="promoModuleId != null">
				PROMO_MODULE_ID,
			</if>
			<if test="promotionId != null">
				PROMOTION_ID,
			</if>
			<if test="promoModuleType != null">
				PROMO_MODULE_TYPE,
			</if>
			<if test="promoModuleStatus != null">
				PROMO_MODULE_STATUS,
			</if>
			<if test="orderSeq != null">
				ORDER_SEQ,
			</if>
			<if test="creator != null">
				CREATOR,
			</if>
			<if test="creatorName != null">
				CREATOR_NAME,
			</if>
			<if test="createdDate != null">
				CREATED_DATE,
			</if>
			<if test="lastUpdateUser != null">
				LAST_UPDATE_USER,
			</if>
			<if test="lastUpdateDate != null">
				LAST_UPDATE_DATE,
			</if>
			<if test="lastUpdateUserName != null">
				LAST_UPDATE_USER_NAME,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="promoModuleId != null">
				#{promoModuleId,jdbcType=VARCHAR},
			</if>
			<if test="promotionId != null">
				#{promotionId,jdbcType=VARCHAR},
			</if>
		
			<if test="promoModuleType != null">
				#{promoModuleType,jdbcType=VARCHAR},
			</if>
			<if test="promoModuleStatus != null">
				#{promoModuleStatus,jdbcType=VARCHAR},
			</if>
			<if test="orderSeq != null">
				#{orderSeq,jdbcType=TIMESTAMP},
			</if>
			<if test="creator != null">
				#{creator,jdbcType=VARCHAR},
			</if>
			<if test="creatorName != null">
				#{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="createdDate != null">
				#{createdDate,jdbcType=TIMESTAMP},
			</if>
			<if test="lastUpdateUser != null">
				#{lastUpdateUser,jdbcType=VARCHAR},
			</if>
			<if test="lastUpdateDate != null">
				#{lastUpdateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="lastUpdateUserName != null">
				#{lastUpdateUserName,jdbcType=VARCHAR},
			</if>
		</trim>
   </insert>
</mapper>