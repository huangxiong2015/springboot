<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yikuyi.product.promotion.dao.PromotionModuleDao">

	<resultMap id="BaseResultMap" type="com.yikuyi.promotion.model.PromotionModule" >
	    <id column="PROMO_MODULE_ID" property="promoModuleId" jdbcType="VARCHAR" />
	    <result column="PROMOTION_ID" property="promotionId" jdbcType="VARCHAR" />
	    <result column="PROMO_MODULE_TYPE" property="promoModuleType" jdbcType="VARCHAR" />
	    <result column="PROMO_MODULE_STATUS" property="promoModuleStatus" jdbcType="VARCHAR" />
	    <result column="ORDER_SEQ" property="orderSeq"/>
	    <result column="CREATOR" property="creator" jdbcType="TIMESTAMP" />
	    <result column="CREATOR_NAME" property="creatorName" jdbcType="VARCHAR" />
	    <result column="CREATED_DATE" property="createdDate" jdbcType="TIMESTAMP" />
	    <result column="LAST_UPDATE_USER" property="lastUpdateUser" jdbcType="VARCHAR" />
	    <result column="LAST_UPDATE_USER_NAME" property="lastUpdateUserName" jdbcType="VARCHAR" />
	    <result column="LAST_UPDATE_DATE" property="lastUpdateDate" jdbcType="TIMESTAMP" />
	  </resultMap>
  		
  	<sql id="Base_Column_List" >
	    PROMO_MODULE_ID,PROMOTION_ID,PROMO_MODULE_TYPE,PROMO_MODULE_STATUS,ORDER_SEQ,CREATOR,
		CREATOR_NAME,CREATED_DATE,LAST_UPDATE_USER,LAST_UPDATE_USER_NAME,LAST_UPDATE_DATE
	</sql>
	
	<!-- Copy草稿数据 -->
	<insert id="copyDraftByPromoId" parameterType="java.lang.String">
		INSERT INTO
		PROMOTION_MODULE
		SELECT * FROM PROMOTION_MODULE_DRAFT WHERE PROMOTION_ID = #{promoId} AND
		PROMO_MODULE_STATUS != 'DELETE'
	</insert>
	
	<delete id="deleteByPromoId" parameterType="java.lang.String">
		DELETE FROM PROMOTION_MODULE WHERE PROMOTION_ID = #{promoId}
	</delete>
  	
  	<select id="getPromotionModule" parameterType="java.lang.String" resultMap="BaseResultMap">
  		SELECT <include refid="Base_Column_List"/> FROM PROMOTION_MODULE WHERE PROMO_MODULE_ID = #{promoModuleId}
  	</select>
	
	<!-- 根据促销模块id修改促销模块相关信息 -->
	<update id="updatePromotionModule" parameterType="com.yikuyi.promotion.model.PromotionModule">
  	update `PROMOTION_MODULE` 
  		<set>
  			<if test="promoModuleType != null">
  				PROMO_MODULE_TYPE = #{promoModuleType},
  			</if>
  			<if test="promoModuleStatus != null">
  				PROMO_MODULE_STATUS = #{promoModuleStatus},
  			</if>
  			<if test="orderSeq != null" >
	        	ORDER_SEQ = #{orderSeq},
	      	</if>
	      	<if test="creatorName != null" >
	       	 	CREATOR_NAME = #{creatorName},
	      	</if>
	      	<if test="lastUpdateUserName != null" >
	       	 	LAST_UPDATE_USER_NAME = #{lastUpdateUserName},
	      	</if>
	      	<if test="createdDate != null" >
	       		 CREATE_DATE = #{createdDate},
	      	</if>
	      	<if test="creator != null" >
	       		 CREATOR = #{creator},
	      	</if>
	      	<if test="lastUpdateDate != null" >
	       		 LAST_UPDATE_DATE = #{lastUpdateDate},
	      	</if>
	      	<if test="lastUpdateUser != null" >
	       		 LAST_UPDATE_USER = #{lastUpdateUser},
	      	</if>
  		</set>
  	WHERE PROMO_MODULE_ID = #{promoModuleId}
  </update>
  

  
  	<!-- 根据参数查询相应list -->
  	<select id="getPromotionModuleList" parameterType="com.yikuyi.promotion.model.PromotionModuleDraft" resultMap="BaseResultMap">
  		SELECT d.`PROMO_MODULE_ID`,d.`PROMOTION_ID`,d.`PROMO_MODULE_TYPE`,d.`PROMO_MODULE_STATUS`,
			   d.`ORDER_SEQ`,d.`CREATOR`,d.`CREATED_DATE`,d.`LAST_UPDATE_USER`,d.`LAST_UPDATE_DATE`,d.`LAST_UPDATE_USER_NAME`
		FROM PROMOTION_MODULE d  WHERE d.`PROMO_MODULE_STATUS` != 'DELETE'
		<if test="promotionId != null ">
			And d.`PROMOTION_ID` =#{promotionId}
		</if>
		<if test="promoModuleType != null ">
			And d.`PROMO_MODULE_TYPE` =#{promoModuleType}
		</if>
		<if test="promoModuleStatus != null ">
			And d.`PROMO_MODULE_STATUS` =#{promoModuleStatus}
		</if>
		<choose>
			<when test='orderSeq !=null and orderSeq== "99999999"'>
				ORDER BY d.`ORDER_SEQ` ASC
			</when>
			<otherwise>
				ORDER BY d.`LAST_UPDATE_DATE` DESC
			</otherwise>
		</choose>		
  	</select>
  
</mapper>