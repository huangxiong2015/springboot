<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yikuyi.product.promotion.dao.PromoModuleProductDao">

	<resultMap id="BaseEntityResultMap" type="com.yikuyi.promotion.model.PromoModuleProduct">
		<id column="PROMO_MODULE_ID" property="promoModuleId" jdbcType="VARCHAR" />
		<result column="PROMO_MODULE_PRODUCT_ID" property="promoModuleProductId"
			jdbcType="VARCHAR" />
		<result column="PRODUCT_ID" property="productId" jdbcType="VARCHAR" />
		<result column="PROMOTION_ID" property="promotionId" jdbcType="VARCHAR" />
		<result column="MANUFACTURER_PART_NUMBER" property="manufacturerPartNumber"
			jdbcType="VARCHAR" />
		<result column="MANUFACTURER" property="manufacturer" jdbcType="VARCHAR" />
		<result column="SOURCE_ID" property="sourceId" jdbcType="VARCHAR" />
		<result column="SOURCE_NAME" property="sourceName" jdbcType="VARCHAR" />
		<result column="VENDOR_ID" property="vendorId" jdbcType="VARCHAR" />
		<result column="VENDOR_NAME" property="vendorName" jdbcType="VARCHAR" />
		<result column="DISCOUNT" property="discount" jdbcType="FLOAT" />
		<result column="CURRENCY_UOM_ID" property="currencyUomId"
			jdbcType="VARCHAR" />
		<result column="QTY_BREAK_1" property="qtyBreak1" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_1" property="priceBreak1" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_2" property="qtyBreak2" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_2" property="priceBreak2" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_3" property="qtyBreak3" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_3" property="priceBreak3" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_4" property="qtyBreak4" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_4" property="priceBreak4" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_5" property="qtyBreak5" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_5" property="priceBreak5" jdbcType="VARCHAR" />
		<result column="ORIGINAL_UNIT_PRICE" property="originalUnitPrice"
			jdbcType="VARCHAR" />
		<result column="RESALE_UNIT_PRICE" property="resaleUnitPrice"
			jdbcType="VARCHAR" />
		<result column="TITLE" property="title" jdbcType="VARCHAR" />
		<result column="SUB_TITLE" property="subTitle" jdbcType="VARCHAR" />
		<result column="IMAGE_1" property="image1" jdbcType="VARCHAR" />
		<result column="IMAGE_2" property="image2" jdbcType="VARCHAR" />
		<result column="IMAGE_3" property="image3" jdbcType="VARCHAR" />
		<result column="IMAGE_4" property="image4" jdbcType="VARCHAR" />
		<result column="IMAGE_5" property="image5" jdbcType="VARCHAR" />
		<result column="DESCRIPTION" property="description" jdbcType="VARCHAR" />
		<result column="TOTAL_QTY" property="totalQty" jdbcType="VARCHAR" />
		<result column="QTY" property="qty" jdbcType="VARCHAR" />
		<result column="CREATOR" property="creator" jdbcType="TIMESTAMP" />
		<result column="CREATED_DATE" property="createdDate" jdbcType="TIMESTAMP" />
		<result column="LAST_UPDATE_USER" property="lastUpdateUser"
			jdbcType="VARCHAR" />
		<result column="LAST_UPDATE_DATE" property="lastUpdateDate"
			jdbcType="TIMESTAMP" />
		<result column="CATEGORY_3_ID" property="category3Id" jdbcType="VARCHAR" />
		<result column="CATEGORY_3_NAME" property="category3Name"
			jdbcType="VARCHAR" />
		<result column="PROCESS_ID" property="processId" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="BaseEntityResultMap1" type="com.yikuyi.promotion.vo.PromotionProductVo">
		<id column="PROMO_MODULE_ID" property="promoModuleId" jdbcType="VARCHAR" />
		<result column="PROMO_MODULE_PRODUCT_ID" property="promoModuleProductId"
			jdbcType="VARCHAR" />
		<result column="PRODUCT_ID" property="productId" jdbcType="VARCHAR" />
		<result column="PROMOTION_ID" property="promotionId" jdbcType="VARCHAR" />
		<result column="MANUFACTURER_PART_NUMBER" property="manufacturerPartNumber"
			jdbcType="VARCHAR" />
		<result column="MANUFACTURER" property="manufacturer" jdbcType="VARCHAR" />
		<result column="SOURCE_ID" property="sourceId" jdbcType="VARCHAR" />
		<result column="SOURCE_NAME" property="sourceName" jdbcType="VARCHAR" />
		<result column="VENDOR_ID" property="vendorId" jdbcType="VARCHAR" />
		<result column="VENDOR_NAME" property="vendorName" jdbcType="VARCHAR" />
		<result column="DISCOUNT" property="discount" jdbcType="FLOAT" />
		<result column="CURRENCY_UOM_ID" property="currencyUomId"
			jdbcType="VARCHAR" />
		<result column="QTY_BREAK_1" property="qtyBreak1" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_1" property="priceBreak1" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_2" property="qtyBreak2" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_2" property="priceBreak2" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_3" property="qtyBreak3" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_3" property="priceBreak3" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_4" property="qtyBreak4" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_4" property="priceBreak4" jdbcType="VARCHAR" />
		<result column="QTY_BREAK_5" property="qtyBreak5" jdbcType="VARCHAR" />
		<result column="PRICE_BREAK_5" property="priceBreak5" jdbcType="VARCHAR" />
		<result column="ORIGINAL_UNIT_PRICE" property="originalUnitPrice"
			jdbcType="VARCHAR" />
		<result column="RESALE_UNIT_PRICE" property="resaleUnitPrice"
			jdbcType="VARCHAR" />
		<result column="TITLE" property="title" jdbcType="VARCHAR" />
		<result column="SUB_TITLE" property="subTitle" jdbcType="VARCHAR" />
		<result column="IMAGE_1" property="image1" jdbcType="VARCHAR" />
		<result column="IMAGE_2" property="image2" jdbcType="VARCHAR" />
		<result column="IMAGE_3" property="image3" jdbcType="VARCHAR" />
		<result column="IMAGE_4" property="image4" jdbcType="VARCHAR" />
		<result column="IMAGE_5" property="image5" jdbcType="VARCHAR" />
		<result column="DESCRIPTION" property="description" jdbcType="VARCHAR" />
		<result column="TOTAL_QTY" property="totalQty" jdbcType="VARCHAR" />
		<result column="QTY" property="qty" jdbcType="VARCHAR" />
		<result column="CREATOR" property="creator" jdbcType="TIMESTAMP" />
		<result column="CREATED_DATE" property="createdDate" jdbcType="TIMESTAMP" />
		<result column="LAST_UPDATE_USER" property="lastUpdateUser"
			jdbcType="VARCHAR" />
		<result column="LAST_UPDATE_DATE" property="lastUpdateDate"
			jdbcType="TIMESTAMP" />
		<result column="CATEGORY_3_ID" property="category3Id" jdbcType="VARCHAR" />
		<result column="CATEGORY_3_NAME" property="category3Name"
			jdbcType="VARCHAR" />
		<result column="PROCESS_ID" property="processId" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="VARCHAR" />
		<result column="ERROR_DESCRIPTION" property="errorDescription"
			jdbcType="VARCHAR" />
	</resultMap>

	<sql id="Base_Column_List">
		`PROMO_MODULE_PRODUCT_ID`,`PROMOTION_ID`,`PROMO_MODULE_ID`,
		`PRODUCT_ID`,`MANUFACTURER_PART_NUMBER`,`MANUFACTURER`,`SOURCE_ID`,`SOURCE_NAME`,`VENDOR_ID`,`VENDOR_NAME`,
		`DISCOUNT`,`CURRENCY_UOM_ID`,`QTY_BREAK_1`,`PRICE_BREAK_1`,`QTY_BREAK_2`,`PRICE_BREAK_2`,`QTY_BREAK_3`,
		`PRICE_BREAK_3`,`QTY_BREAK_4`,`PRICE_BREAK_4`,`QTY_BREAK_5`,`PRICE_BREAK_5`,`ORIGINAL_UNIT_PRICE`,`RESALE_UNIT_PRICE`,
		`TITLE`,`SUB_TITLE`,`IMAGE_1`,`IMAGE_2`,`IMAGE_3`,`IMAGE_4`,`IMAGE_5`,`DESCRIPTION`,`TOTAL_QTY`,
		`QTY`,`CREATOR`,`CREATED_DATE`,`LAST_UPDATE_USER`,`LAST_UPDATE_DATE`,`CATEGORY_3_NAME`,`CATEGORY_3_ID`,`PROCESS_ID`,`STATUS`,ERROR_DESCRIPTION
	</sql>

	<select id="getAllProductByPromoId" parameterType="java.lang.String"
		resultMap="BaseEntityResultMap">
		SELECT
		T1.*
		FROM PROMO_MODULE_PRODUCT T1 LEFT JOIN
		PROMOTION_MODULE T2 ON T1.PROMO_MODULE_ID = T2.PROMO_MODULE_ID WHERE
		T1.PROMOTION_ID = #{promotionId} AND STATUS ='ENABLE' ORDER BY T2.ORDER_SEQ
	</select>

	<!-- Copy草稿数据 -->
	<insert id="copyDraftByPromoId" parameterType="java.lang.String">
		INSERT INTO
		PROMO_MODULE_PRODUCT 
			SELECT t2.* FROM PROMOTION_MODULE_DRAFT t1 LEFT JOIN PROMO_MODULE_PRODUCT_DRAFT t2 ON t1.`PROMO_MODULE_ID` = t2.`PROMO_MODULE_ID` WHERE
		t1.PROMOTION_ID = #{promoId} AND t1.`PROMO_MODULE_STATUS` != 'DELETE' AND t2.STATUS != 'UNABLE'
	</insert>

	<!-- 删除数据 -->
	<delete id="deleteByPromoId" parameterType="java.lang.String">
		DELETE FROM
		PROMO_MODULE_PRODUCT WHERE PROMOTION_ID = #{promoId}
	</delete>

	<select id="listModuleProduct" parameterType="com.yikuyi.promotion.vo.PromotionProductVo"
		resultMap="BaseEntityResultMap1">
		SELECT
		<include refid="Base_Column_List" />
		FROM PROMO_MODULE_PRODUCT
		WHERE 1=1
		<if test="promoModuleId != null ">
			AND `PROMO_MODULE_ID` =#{promoModuleId}
		</if>
		<if test="promotionId != null ">
			AND `PROMOTION_ID` =#{promotionId}
		</if>
		<if test="status != null ">
			AND `STATUS` =#{status}
		</if>
	</select>
</mapper>