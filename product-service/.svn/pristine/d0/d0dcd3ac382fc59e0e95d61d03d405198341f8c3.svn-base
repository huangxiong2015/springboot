<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yikuyi.product.activity.dao.ActivityDraftDao" >
  <resultMap id="BaseResultMap" type="com.yikuyi.activity.model.Activity" >
    <id column="ACTIVITY_ID" property="activityId" jdbcType="VARCHAR" />
    <result column="NAME" property="name" jdbcType="VARCHAR" />
    <result column="TYPE" property="type" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="START_DATE" property="startDate" jdbcType="TIMESTAMP" />
    <result column="END_DATE" property="endDate" jdbcType="TIMESTAMP" />
    <result column="PRODUCT_LIST_CSS" property="productListCss" jdbcType="VARCHAR" />
    <result column="PRODUCT_DETAIL_CSS" property="productDetailCss" jdbcType="VARCHAR" />
    <result column="BRAND_CSS" property="brandCss" jdbcType="VARCHAR" />
    <result column="VENDOR_CSS" property="vendorCss" jdbcType="VARCHAR" />
    <result column="PROMO_DISCOUNT_STATUS" property="promoDiscountStatus" jdbcType="CHAR" />
    <result column="PROMO_DISCOUNT" property="promoDiscount" jdbcType="DOUBLE" />
    <result column="IS_SYSTEM_QTY" property="isSystemQty" jdbcType="CHAR" />
    <result column="ICON_STATUS" property="iconStatus" jdbcType="CHAR" />
	<result column="ICON_SCENES" property="iconScenes" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="BaseProductDraftResultMap" type="com.yikuyi.activity.model.ActivityProductDraft" >
  	<id column="ACTIVITY_PRODUCT_ID" property="activityProductId" jdbcType="VARCHAR" />
  	 <result column="ACTIVITY_ID" property="activityId" jdbcType="VARCHAR" />
  	 <result column="PERIODS_ID" property="periodsId" jdbcType="VARCHAR" />
  	 <result column="PRODUCT_ID" property="productId" jdbcType="VARCHAR" />
  	 <result column="MANUFACTURER_PART_NUMBER" property="manufacturerPartNumber" jdbcType="VARCHAR" />
  	 <result column="MANUFACTURER" property="manufacturer" jdbcType="VARCHAR" />
  	 <result column="SOURCE_ID" property="sourceId" jdbcType="VARCHAR" />
  	 <result column="SOURCE_NAME" property="sourceName" jdbcType="VARCHAR" />
  	 <result column="VENDOR_ID" property="vendorId" jdbcType="VARCHAR" />
  	 <result column="VENDOR_NAME" property="vendorName" jdbcType="VARCHAR" />
  	 <result column="DISCOUNT" property="discount" jdbcType="VARCHAR" />
  	 <result column="CURRENCY_UOM_ID" property="currencyUomId" jdbcType="VARCHAR" />
  	 <result column="QTY_BREAK_1" property="qtyBreak1" jdbcType="VARCHAR" />
  	 <result column="PRICE_BREAK_1" property="priceBreak1" jdbcType="VARCHAR" />
  	 <result column="QTY_BREAK_2" property="qtyBreak2" jdbcType="VARCHAR" />
  	 <result column="PRICE_BREAK_2" property="priceBreak2" jdbcType="VARCHAR" />
  	 <result column="QTY_BREAK_3" property="qtyBreak3" jdbcType="VARCHAR" />
  	 <result column="PRICE_BREAK_3" property="priceBreak3" jdbcType="VARCHAR" />
  	 <result column="QTY_BREAK_4" property="qtyBreak4" jdbcType="VARCHAR" />
  	 <result column="PRICE_BREAK_4" property="priceBreak4" jdbcType="VARCHAR" />
  	 <result column="QTY_BREAK_5" property="qtyBreak5" jdbcType="VARCHAR" />
  	 <result column="PRICE_BREAK_5" property="priceBreak5" jdbcType="VARCHAR" />
  	 <result column="TITLE" property="title" jdbcType="VARCHAR" />
  	 <result column="SUB_TITLE" property="subTitle" jdbcType="VARCHAR" />
  	 <result column="IMAGE_1" property="image1" jdbcType="VARCHAR" />
  	 <result column="IMAGE_2" property="image2" jdbcType="VARCHAR" />
  	 <result column="IMAGE_3" property="image3" jdbcType="VARCHAR" />
  	 <result column="IMAGE_4" property="image4" jdbcType="VARCHAR" />
  	 <result column="IMAGE_5" property="image5" jdbcType="VARCHAR" />
  	 <result column="STATUS" property="status" jdbcType="VARCHAR" />
  	 <result column="DESC" property="desc" jdbcType="VARCHAR" />
  	 <result column="TOTAL_QTY" property="totalQty" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    ACTIVITY_ID, NAME, TYPE, STATUS, START_DATE, END_DATE, PRODUCT_LIST_CSS, PRODUCT_DETAIL_CSS, 
    BRAND_CSS, VENDOR_CSS,PROMO_DISCOUNT_STATUS,PROMO_DISCOUNT,IS_SYSTEM_QTY,ICON_STATUS,ICON_SCENES
  </sql>
  
	<select id="getActivityById" parameterType="java.lang.String" resultMap="BaseResultMap">
		SELECT <include refid="Base_Column_List"/> FROM ACTIVITY_DRAFT WHERE ACTIVITY_ID = #{id}
	</select>
  <insert id="save" parameterType="com.yikuyi.activity.model.Activity" >
    insert into ACTIVITY_DRAFT
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="activityId != null" >
        ACTIVITY_ID,
      </if>
      <if test="name != null" >
        NAME,
      </if>
      <if test="type != null" >
        TYPE,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="startDates != null" >
        START_DATE,
      </if>
      <if test="endDates != null" >
        END_DATE,
      </if>
      <if test="productListCss != null" >
        PRODUCT_LIST_CSS,
      </if>
      <if test="productDetailCss != null" >
        PRODUCT_DETAIL_CSS,
      </if>
      <if test="brandCss != null" >
        BRAND_CSS,
      </if>
      <if test="vendorCss != null" >
        VENDOR_CSS,
      </if>
      <if test="promoDiscountStatus != null" >
        PROMO_DISCOUNT_STATUS,
      </if>
      <if test="promoDiscount != null" >
        PROMO_DISCOUNT,
      </if>
       <if test="isSystemQty != null" >
        IS_SYSTEM_QTY,
      </if>
       <if test="iconStatus != null" >
        ICON_STATUS,
      </if>
       <if test="iconScenes != null" >
        ICON_SCENES,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="activityId != null" >
        #{activityId,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="type != null" >
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="startDates != null" >
         STR_TO_DATE(#{startDates},'%Y-%m-%d'),
      </if>
      <if test="endDates != null" >
        #{endDates},
      </if>
      <if test="productListCss != null" >
        #{productListCss,jdbcType=VARCHAR},
      </if>
      <if test="productDetailCss != null" >
        #{productDetailCss,jdbcType=VARCHAR},
      </if>
      <if test="brandCss != null" >
        #{brandCss,jdbcType=VARCHAR},
      </if>
      <if test="vendorCss != null" >
        #{vendorCss,jdbcType=VARCHAR},
      </if>
      <if test="promoDiscountStatus != null" >
        #{promoDiscountStatus},
      </if>
      <if test="promoDiscount != null" >
        #{promoDiscount},
      </if>
      <if test="isSystemQty != null" >
        #{isSystemQty},
      </if>
      <if test="iconStatus != null" >
        #{iconStatus},
      </if>
      <if test="iconScenes != null" >
        #{iconScenes},
      </if>
    </trim>
  </insert>
  <delete id="deleteById">
  	DELETE FROM ACTIVITY_DRAFT WHERE ACTIVITY_ID = #{id}
  </delete>
  
  
  <resultMap id="ActivityResultMap" type="com.yikuyi.activity.vo.ActivityVo" >
  	<id column="ACTIVITY_ID" property="activityId" jdbcType="VARCHAR" />
	<result column="NAME" property="name" jdbcType="VARCHAR" />
	<result column="TYPE" property="type" jdbcType="VARCHAR" />
	<result column="START_DATE" property="startDates" jdbcType="VARCHAR" />
	<result column="END_DATE" property="endDates" jdbcType="VARCHAR" />
	<result column="PROMO_DISCOUNT_STATUS" property="promoDiscountStatus" jdbcType="CHAR" />
	<result column="PROMO_DISCOUNT" property="promoDiscount" jdbcType="DOUBLE" />
	<result column="IS_SYSTEM_QTY" property="isSystemQty" jdbcType="CHAR" />
	<result column="ICON_STATUS" property="iconStatus" jdbcType="CHAR" />
	<result column="ICON_SCENES" property="iconScenes" jdbcType="VARCHAR" />
	<collection property="periodsList" column="ACTIVITY_ID" select="findAPeriods" ></collection>
  </resultMap>
    <!-- 查询活动草稿详情 -->
  <select id="findActivityById" parameterType="java.lang.String" resultMap="ActivityResultMap">
  		select 
  			ACTIVITY_ID,
  			NAME,
  			TYPE,
  			DATE_FORMAT(START_DATE,'%Y-%m-%d') START_DATE,
  			DATE_FORMAT(END_DATE,'%Y-%m-%d') END_DATE,
  			PROMO_DISCOUNT_STATUS,
  			PROMO_DISCOUNT,
  			IS_SYSTEM_QTY,
  			ICON_STATUS,
  			ICON_SCENES
  		from ACTIVITY_DRAFT where ACTIVITY_ID = #{activityId}
  </select>
  
  <resultMap id="ActivityPeriodsResultMap" type="com.yikuyi.activity.model.ActivityPeriods" >
  	<id column="PERIODS_ID" property="periodsId" jdbcType="VARCHAR" />
	<result column="ACTIVITY_ID" property="activityId" jdbcType="VARCHAR" />
	<result column="START_TIME" property="startTime" jdbcType="TIMESTAMP" />
	<result column="END_TIME" property="endTime" jdbcType="TIMESTAMP" />
	<result column="STATUS" property="status" jdbcType="VARCHAR" />
  </resultMap>
  <!-- 查询活动草稿区间 -->
  <select id="findAPeriods" parameterType="java.lang.String" resultMap="ActivityPeriodsResultMap">
  		select 
  			PERIODS_ID,
	  		ACTIVITY_ID,
	  		START_TIME,
	  		END_TIME,
	  		STATUS 
	  	from ACTIVITY_PERIODS_DRAFT where ACTIVITY_ID = #{activityId} 
  </select>
  
  <select id="findActivityDraftByActivityIdAndPeriodsId" resultMap="BaseProductDraftResultMap">
	select
	`ACTIVITY_PRODUCT_ID`,
	`ACTIVITY_ID`,
	`PERIODS_ID`,
	`PRODUCT_ID`,
	`MANUFACTURER_PART_NUMBER`,
	`MANUFACTURER`,
	`SOURCE_ID`,
	`SOURCE_NAME`,
	`VENDOR_ID`,
	`VENDOR_NAME`,
	`DISCOUNT`,
	`CURRENCY_UOM_ID`,
	`QTY_BREAK_1`,
	`PRICE_BREAK_1`,
	`QTY_BREAK_2`,
	`PRICE_BREAK_2`,
	`QTY_BREAK_3`,
	`PRICE_BREAK_3`,
	`QTY_BREAK_4`,
	`PRICE_BREAK_4`,
	`QTY_BREAK_5`,
	`PRICE_BREAK_5`,
	`TITLE`,
	`SUB_TITLE`,
	`IMAGE_1`,
	`IMAGE_2`,
	`IMAGE_3`,
	`IMAGE_4`,
	`IMAGE_5`,
	`STATUS`,
	`DESC`,
	`TOTAL_QTY`,
	`LAST_UPDATE_DATE`
	from
	`ACTIVITY_PRODUCT_DRAFT` 
	<where>
	<if test="activityId != null">
		and ACTIVITY_ID = #{activityId}
	</if>
	<if test="periodsId != null">
		and PERIODS_ID = #{periodsId}
	</if>
	</where>
  </select>
 
</mapper>